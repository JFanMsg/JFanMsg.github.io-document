(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{383:function(a,s,t){"use strict";t.r(s);var r=t(45),e=Object(r.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"_8-docker之harbor企业级镜像仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-docker之harbor企业级镜像仓库"}},[a._v("#")]),a._v(" 8. docker之Harbor企业级镜像仓库")]),a._v(" "),t("h1",{attrs:{id:"harbor概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#harbor概述"}},[a._v("#")]),a._v(" "),t("strong",[a._v("Harbor概述")])]),a._v(" "),t("ol",[t("li",[a._v("Harbor是由VMWare公司开源的容器镜像仓库，事实上，Harbor是在docker Registry上进行了相应的企业级扩展，从而获得了更加广泛的应用。")]),a._v(" "),t("li",[a._v("这些新的企业级特性包含：管理用户界面，基于角色的访问控制，AD/LDAP集成，审计日志等，足以满足企业的基本需求")]),a._v(" "),t("li",[t("strong",[a._v("官方地址")]),a._v("：https://goharbor.io/")])]),a._v(" "),t("h2",{attrs:{id:"harbor组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#harbor组件"}},[a._v("#")]),a._v(" Harbor组件")]),a._v(" "),t("ol",[t("li",[a._v("harbor-adminserver：配置管理中心")]),a._v(" "),t("li",[a._v("harbor-db：Mysql数据库")]),a._v(" "),t("li",[a._v("harbor-jobservice：负责镜像复制")]),a._v(" "),t("li",[a._v("harbor-log：记录操作日志")]),a._v(" "),t("li",[a._v("harbor-ui：Web管理页面和API")]),a._v(" "),t("li",[a._v("nginx：前端代理，负责前端页面和镜像上传/下载转发")]),a._v(" "),t("li",[a._v("redis：会话保持")]),a._v(" "),t("li",[a._v("registry：镜像存储")])]),a._v(" "),t("h2",{attrs:{id:"harbor安装有3种方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#harbor安装有3种方式"}},[a._v("#")]),a._v(" Harbor安装有3种方式")]),a._v(" "),t("ol",[t("li",[a._v("在线安装：从Docker Hub下载Harbor相关镜像，因此安装软件包非常小")]),a._v(" "),t("li",[a._v("离线安装：安装包包含部署的相关镜像，因此安装包比较大")]),a._v(" "),t("li",[a._v("OVA安装程序：当用户具有vCenter环境时，使用此安装程序，在部署OVA后启动Harbo")])]),a._v(" "),t("h1",{attrs:{id:"安装docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose"}},[a._v("#")]),a._v(" "),t("strong",[a._v("安装docker-compose")])]),a._v(" "),t("p",[a._v("安装harbor需要安装docker三剑客之一docker-compose")]),a._v(" "),t("h2",{attrs:{id:"第一种方式安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一种方式安装"}},[a._v("#")]),a._v(" 第一种方式安装")]),a._v(" "),t("p",[a._v("官方的安装方式：线上安装")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -L "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/docker/compose/releases/download/1.23.2/docker-compose-'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v(" -o /usr/local/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" -s /usr/local/bin/docker-compose /usr/bin/docker-compose\ndocker-compose --version\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##如果网络不好，推荐第二种安装")]),a._v("\n")])])]),t("h2",{attrs:{id:"第二种办法安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二种办法安装"}},[a._v("#")]),a._v(" 第二种办法安装")]),a._v(" "),t("p",[a._v("离线安装，事先下载好")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" -a docker-compose-Linux-x86_64 /usr/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/bin/docker-compose\ndocker-compose --version\n")])])]),t("h1",{attrs:{id:"habor部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#habor部署"}},[a._v("#")]),a._v(" "),t("strong",[a._v("Habor部署")])]),a._v(" "),t("p",[a._v("这边部署是采用离线安装，安装包事先下载好的")]),a._v(" "),t("p",[a._v("Harbor版本：harbor-offline-installer-v1.10.2.tgz")]),a._v(" "),t("h2",{attrs:{id:"解压harbor压缩包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解压harbor压缩包"}},[a._v("#")]),a._v(" 解压harbor压缩包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxf harbor-offline-installer-v1.10.2.tgz \n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" harbor\n")])])]),t("h2",{attrs:{id:"在harbor里面有几个比较重要的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在harbor里面有几个比较重要的文件"}},[a._v("#")]),a._v(" 在harbor里面有几个比较重要的文件")]),a._v(" "),t("ol",[t("li",[t("strong",[a._v("prepare")]),a._v("：部署前的准备工作脚本")]),a._v(" "),t("li",[t("strong",[a._v("install.sh")]),a._v("：安装脚本")]),a._v(" "),t("li",[t("strong",[a._v("harbor.cfg")]),a._v("：harbor的主配置文件")]),a._v(" "),t("li",[t("strong",[a._v("docker-compose.yml")]),a._v("：docker-compose的配置文件，因为harbor需要安装docker-compose，我们在上面已经先安装过了")])]),a._v(" "),t("h2",{attrs:{id:"修改harbor-cfg配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改harbor-cfg配置文件"}},[a._v("#")]),a._v(" 修改harbor.cfg配置文件")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" harbor.cfg\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("hostname")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".31.180  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##修改这行为IP地址或域名")]),a._v("\nharbor_admin_password: Harbor12345  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##默认的登录密码，不用修改，搭建完之后web界面可修改管理员密码，用户名：admin")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 需要注释的行")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#https:")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# https port for harbor, default is 443")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#port: 443")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The path of cert and key files for nginx")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#certificate: /your/certificate/path")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#private_key: /your/private/key/path")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 为什么要注释，因为harbor新版本默认开启https，那么需要相关https证书，如果准备开启https的话，就可以把证书放在相对目录中，那么就不需要注释")]),a._v("\n")])])]),t("h2",{attrs:{id:"安装harbor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装harbor"}},[a._v("#")]),a._v(" 安装harbor")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./prepare  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 校验环境需求")]),a._v("\n./install.sh  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 安装")]),a._v("\n")])])]),t("h2",{attrs:{id:"测试harbor是否成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试harbor是否成功"}},[a._v("#")]),a._v(" 测试harbor是否成功")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker-compose "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n\n      Name                     Command                       State                     Ports          \n------------------------------------------------------------------------------------------------------\nharbor-core         /harbor/harbor_core              Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("                            \nharbor-db           /docker-entrypoint.sh            Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp                 \nharbor-jobservice   /harbor/harbor_jobservice  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".   Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("                            \nharbor-log          /bin/sh -c /usr/local/bin/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".   Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:1514-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10514")]),a._v("/tcp\nharbor-portal       nginx -g daemon off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("             Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("/tcp                 \nnginx               nginx -g daemon off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("             Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:80-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("/tcp     \nredis               redis-server /etc/redis.conf     Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),a._v("/tcp                 \nregistry            /home/harbor/entrypoint.sh       Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5000")]),a._v("/tcp                 \nregistryctl         /home/harbor/start.sh            Up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("health: starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h2",{attrs:{id:"进入harbar的web界面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进入harbar的web界面"}},[a._v("#")]),a._v(" 进入harbar的web界面")]),a._v(" "),t("p",[a._v("本地IP就可以直接进入，默认是80端口")]),a._v(" "),t("p",[a._v("默认账号：admin")]),a._v(" "),t("p",[a._v("默认密码：Harbor12345")]),a._v(" "),t("h1",{attrs:{id:"harbor的简单实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#harbor的简单实例"}},[a._v("#")]),a._v(" "),t("strong",[a._v("harbor的简单实例")])]),a._v(" "),t("h2",{attrs:{id:"创建用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建用户"}},[a._v("#")]),a._v(" 创建用户")]),a._v(" "),t("p",[t("strong",[a._v("用户管理--\x3e创建用户")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s1.ax1x.com/2020/04/16/JkHBff.png",alt:"JkHBff.png"}})]),a._v(" "),t("h2",{attrs:{id:"创建项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[a._v("#")]),a._v(" 创建项目")]),a._v(" "),t("p",[t("strong",[a._v("项目--\x3e新建项目")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s1.ax1x.com/2020/04/16/JkH7X4.png",alt:"JkH7X4.png"}})]),a._v(" "),t("h2",{attrs:{id:"给用户授权新建的项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给用户授权新建的项目"}},[a._v("#")]),a._v(" 给用户授权新建的项目")]),a._v(" "),t("p",[t("strong",[a._v("项目--\x3eqqkj--\x3e成员--\x3e+用户")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s1.ax1x.com/2020/04/16/JkblHs.png",alt:"JkblHs.png"}})]),a._v(" "),t("h1",{attrs:{id:"配置http镜像仓库信任"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置http镜像仓库信任"}},[a._v("#")]),a._v(" "),t("strong",[a._v("配置http镜像仓库信任")])]),a._v(" "),t("p",[a._v("因为docker默认只支持https，所以我们要让docker支持指定链接的http")]),a._v(" "),t("h2",{attrs:{id:"修改daemon-json文件配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改daemon-json文件配置"}},[a._v("#")]),a._v(" 修改daemon.json文件配置")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/docker/daemon.json \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://f1361db2.m.daocloud.io"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"insecure-registries"')]),a._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.0.72"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n或\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"insecure-registries"')]),a._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.0.72"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 第一条，是因为我事先有配置了docker的加速器")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 博主在这里也出了问题，不过把加速器配置删除后，就可以正常使用了")]),a._v("\n")])])]),t("h2",{attrs:{id:"重启docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启docker"}},[a._v("#")]),a._v(" 重启docker")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl restart docker\n")])])]),t("h2",{attrs:{id:"启动harbor的组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动harbor的组件"}},[a._v("#")]),a._v(" 启动harbor的组件")]),a._v(" "),t("p",[a._v("启动harbor仓库，一定要到harbor安装目录中执行命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker-compose up -d\n")])])]),t("h2",{attrs:{id:"要上传的镜像打标签"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#要上传的镜像打标签"}},[a._v("#")]),a._v(" 要上传的镜像打标签")]),a._v(" "),t("p",[a._v("如果不打标签，会默认上传到docker的公共镜像仓库中")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("docker image tag nginx:v1 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.72/msg/nginx:v1\n")])])]),t("h2",{attrs:{id:"登录认证harbor仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录认证harbor仓库"}},[a._v("#")]),a._v(" 登录认证harbor仓库")]),a._v(" "),t("p",[a._v("帐号密码是harbor仓库新创建的账号")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("docker login "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.72\n")])])]),t("h2",{attrs:{id:"上传镜像到harbor仓库中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传镜像到harbor仓库中"}},[a._v("#")]),a._v(" 上传镜像到harbor仓库中")]),a._v(" "),t("p",[a._v("要先登录才能上传")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("docker image push "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.72/msg/nginx:v1\n")])])]),t("h2",{attrs:{id:"从harbor仓库拉取镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从harbor仓库拉取镜像"}},[a._v("#")]),a._v(" 从harbor仓库拉取镜像")]),a._v(" "),t("p",[a._v("要先登录才能下载")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("docker image pull "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.72/msg/nginx:v1\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);