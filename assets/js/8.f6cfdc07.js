(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{374:function(s,t,a){"use strict";a.r(t);var e=a(45),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_2-kubernetes1-14集群部署-二进制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-kubernetes1-14集群部署-二进制"}},[s._v("#")]),s._v(" 2. Kubernetes1.14集群部署 - 二进制")]),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"kubernetes集群部署步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes集群部署步骤"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Kubernetes集群部署步骤")])]),s._v(" "),a("ol",[a("li",[s._v("官方提供的三种部署方式")]),s._v(" "),a("li",[s._v("Kubernetes平台环境规划")]),s._v(" "),a("li",[s._v("自签SSL证书")]),s._v(" "),a("li",[s._v("Etcd数据库集群部署")]),s._v(" "),a("li",[s._v("Node安装Docker")]),s._v(" "),a("li",[s._v("部署Kubernetes网络")]),s._v(" "),a("li",[s._v("部署Master组件")]),s._v(" "),a("li",[s._v("部署Node组件")]),s._v(" "),a("li",[s._v("部署一个测试示例")]),s._v(" "),a("li",[s._v("部署Web UI（Dashboard）")]),s._v(" "),a("li",[s._v("部署集群内部DNS解析服务（CoreDNS）")])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"官方提供的三种部署方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#官方提供的三种部署方式"}},[s._v("#")]),s._v(" "),a("strong",[s._v("官方提供的三种部署方式")])]),s._v(" "),a("p",[a("strong",[s._v("minikube")])]),s._v(" "),a("p",[s._v("Minikube是一个工具，可以在本地快速运行一个单点的Kubernetes，仅用于尝试Kubernetes或日常开发的用户使用。")]),s._v(" "),a("p",[s._v("部署地址：https://kubernetes.io/docs/setup/minikube/")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("kubeadm")])]),s._v(" "),a("p",[s._v("Kubeadm也是一个工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。")]),s._v(" "),a("p",[s._v("部署地址：https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("二进制包")])]),s._v(" "),a("p",[s._v("推荐，从官方下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。")]),s._v(" "),a("p",[s._v("下载地址：https://github.com/kubernetes/kubernetes/releases")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"kubernetes平台环境规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes平台环境规划"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Kubernetes平台环境规划")])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"单机kubernetes平台架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单机kubernetes平台架构"}},[s._v("#")]),s._v(" 单机Kubernetes平台架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/18/Jm0HHO.png",alt:"Jm0HHO.png"}})]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"高可用kubernetes平台架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高可用kubernetes平台架构"}},[s._v("#")]),s._v(" 高可用Kubernetes平台架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://92.linux91.cn/attachment/20190319/91e19dbcaa9f4122ac5a8dd42c17bca0.png",alt:"img"}})]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"本文章的规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本文章的规划"}},[s._v("#")]),s._v(" 本文章的规划")]),s._v(" "),a("p",[s._v("目前会先构建单机Kubernetes平台架构，后面会将构建好的单机Kubernetes平台架构，扩容为高可用Kubernetes平台架构")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"单机kubernetes平台架构-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单机kubernetes平台架构-2"}},[s._v("#")]),s._v(" 单机Kubernetes平台架构")]),s._v(" "),a("ol",[a("li",[s._v("192.168.0.141--masrer\n"),a("ol",[a("li",[s._v("4G，2P")])])]),s._v(" "),a("li",[s._v("192.168.0.142--nodc01\n"),a("ol",[a("li",[s._v("4G，2P")])])]),s._v(" "),a("li",[s._v("192.168.0.143--nodc02\n"),a("ol",[a("li",[s._v("4G，2P")])])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"自签ssl证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自签ssl证书"}},[s._v("#")]),s._v(" "),a("strong",[s._v("自签SSL证书")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/JuGzuD.png",alt:"JuGzuD.png"}})]),s._v(" "),a("p",[s._v("按着以上的证书需求图上，etcd跟k8s都需要证书")]),s._v(" "),a("p",[s._v("证书就在主master机上生成")]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"创建证书目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建证书目录"}},[s._v("#")]),s._v(" 创建证书目录")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /k8s/cert/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("k8s-cert,etcd-cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 分别创建k8s跟etcd的证书目录，分类存储")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"同步时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步时间"}},[s._v("#")]),s._v(" 同步时间")]),s._v(" "),a("p",[s._v("查看当前系统时间，请让系统时间保持正确")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ntpdate time.windows.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##虚拟机的时间总是不定，所以要同步时间")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2019-03-24 13:09:30'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##如果同步出错，直接修改")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"生成etcd需要的证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成etcd需要的证书"}},[s._v("#")]),s._v(" "),a("strong",[s._v("生成etcd需要的证书")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"进入etcd证书目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入etcd证书目录"}},[s._v("#")]),s._v(" 进入etcd证书目录")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/cert/etcd-cert\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"安装cfssl命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装cfssl命令"}},[s._v("#")]),s._v(" 安装cfssl命令")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -o /usr/local/bin/cfssl\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -o /usr/local/bin/cfssljson\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -o /usr/local/bin/cfssl-certinfo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/cfssl /usr/local/bin/cfssljson /usr/local/bin/cfssl-certinfo\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写生成ca证书的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写生成ca证书的脚本"}},[s._v("#")]),s._v(" 编写生成ca证书的脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" etca-ca.sh\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca-config.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "signing": {\n    "default": {\n      "expiry": "87600h"\n    },\n    "profiles": {\n      "www": {\n         "expiry": "87600h",\n         "usages": [\n            "signing",\n            "key encipherment",\n            "server auth",\n            "client auth"\n        ]\n      }\n    }\n  }\n}\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca-csr.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n    "CN": "etcd CA",\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "Beijing",\n            "ST": "Beijing"\n        }\n    ]\n}\nEOF')]),s._v("\n\ncfssl gencert -initca ca-csr.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson -bare ca -\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-----------------------")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server-csr.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n    "CN": "etcd",\n    "hosts": [\n    "192.168.0.141",\n    "192.168.0.142",\n    "192.168.0.143"\n    ],\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "BeiJing",\n            "ST": "BeiJing"\n        }\n    ]\n}\nEOF')]),s._v("\n\ncfssl gencert -ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca.pem -ca-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca-key.pem -config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca-config.json -profile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www server-csr.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson -bare server\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"证书脚本重点注意信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书脚本重点注意信息"}},[s._v("#")]),s._v(" 证书脚本重点注意信息")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("expiry：表示证书有效时间\nhosts：有效的IP，只要是etcd的节点IP都要写进去\nkey：生成证书的算法\nnames：地区\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"使用ca-sh脚本生成ca证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用ca-sh脚本生成ca证书"}},[s._v("#")]),s._v(" 使用ca.sh脚本生成ca证书")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x etca-ca.sh\n./etca-ca.sh\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"生成k8s需要的证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成k8s需要的证书"}},[s._v("#")]),s._v(" 生成k8s需要的证书")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"进入k8s证书目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入k8s证书目录"}},[s._v("#")]),s._v(" 进入k8s证书目录")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/cert/k8s-cert/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写生成证书的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写生成证书的脚本"}},[s._v("#")]),s._v(" 编写生成证书的脚本")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("vim k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"profiles"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"usages"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key encipherment"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server auth"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client auth"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      \t    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\ncfssl gencert "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("initca ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare ca "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\n#"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.141"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.40"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.41"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.42"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc.cluster"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc.cluster.local"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\ncfssl gencert "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare server\n\n#"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" admin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system:masters"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\ncfssl gencert "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes admin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare admin\n\n#"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system:kube-proxy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\ncfssl gencert "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"证书脚本重点注意信息-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书脚本重点注意信息-2"}},[s._v("#")]),s._v(" 证书脚本重点注意信息")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("expiry：表示证书有效时间\nhosts：有效的IP，只要是master的节点IP都要写进去，为了之后的高可用，我就多加了几个IP，还有几个域名跟二个IP都不要删除，默认k8s有时会调用\nkey：生成证书的算法\nnames：地区，如果不熟悉最好不要修改names中的地区，因为有标记k8s\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"使用k8s-sh脚本生成证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用k8s-sh脚本生成证书"}},[s._v("#")]),s._v(" 使用k8s.sh脚本生成证书")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x k8s.sh\n./k8s.sh\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"etcd数据库集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etcd数据库集群部署"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Etcd数据库集群部署")])]),s._v(" "),a("p",[s._v("etcd 是一个分布式一致性k-v存储系统，可用于服务注册发现与共享配置，具有以下优点。")]),s._v(" "),a("ol",[a("li",[s._v("简单 ： 相比于晦涩难懂的paxos算法，etcd基于相对简单且易实现的raft算法实现一致性，并通过gRPC提供接口调用")]),s._v(" "),a("li",[s._v("安全：支持TLS通信，并可以针对不同的用户进行对key的读写控制")]),s._v(" "),a("li",[s._v("高性能：10,000 /秒的写性能")])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"etcd下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etcd下载"}},[s._v("#")]),s._v(" etcd下载")]),s._v(" "),a("p",[s._v("https://github.com/etcd-io/etcd/releases")]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"etcd版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etcd版本"}},[s._v("#")]),s._v(" etcd版本")]),s._v(" "),a("p",[s._v("这边是用etcd3.3.10来部署的")]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"etcd集群节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etcd集群节点"}},[s._v("#")]),s._v(" etcd集群节点")]),s._v(" "),a("ol",[a("li",[s._v("192.168.0.141")]),s._v(" "),a("li",[s._v("192.168.0.142")]),s._v(" "),a("li",[s._v("192.168.0.143")])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"etcd主要文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etcd主要文件"}},[s._v("#")]),s._v(" etcd主要文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("etcd文件 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##启动etcd的主要程序")]),s._v("\netcdctl文件  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##是etcd管理客户端的命令")]),s._v("\n/var/log/messages   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##日志文件")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"_192-168-0-141机上操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_192-168-0-141机上操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("192.168.0.141机上操作")])]),s._v(" "),a("h3",{attrs:{id:"进入目录并解压并进入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入目录并解压并进入"}},[s._v("#")]),s._v(" 进入目录并解压并进入")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /k8s/soft\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/soft\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxf etcd-v3.3.10-linux-amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" etcd-v3.3.10-linux-amd64\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"创建目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录"}},[s._v("#")]),s._v(" 创建目录")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/etcd/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("bin,conf,ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bin：存放可执行文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## conf：存放配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ssl：存放证书文件")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"复制文件到etcd的bin目录中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制文件到etcd的bin目录中"}},[s._v("#")]),s._v(" 复制文件到etcd的bin目录中")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -a /k8s/soft/etcd-v3.3.10-linux-amd64/etcd* /usr/local/etcd/bin/\n")])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("复制证书到etcd的ssh目录中")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -a /k8s/cert/etcd-cert/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ca,server,server-key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".pem /usr/local/etcd/ssl/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" etcd.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# example: ./etcd.sh etcd01 192.168.1.10 etcd02=https://192.168.1.11:2380,etcd03=https://192.168.1.12:2380")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_CLUSTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WORK_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORK_DIR")]),s._v("/conf/etcd")]),s._v('\n#[Member]\nETCD_NAME="'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_NAME}")]),s._v('"\nETCD_DATA_DIR="/var/lib/etcd/default.etcd"\nETCD_LISTEN_PEER_URLS="https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_IP}")]),s._v(':2380"\nETCD_LISTEN_CLIENT_URLS="https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_IP}")]),s._v(':2379"\n\n#[Clustering]\nETCD_INITIAL_ADVERTISE_PEER_URLS="https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_IP}")]),s._v(':2380"\nETCD_ADVERTISE_CLIENT_URLS="https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_IP}")]),s._v(':2379"\nETCD_INITIAL_CLUSTER="etcd01=https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_IP}")]),s._v(":2380,"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_CLUSTER}")]),s._v('"\nETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"\nETCD_INITIAL_CLUSTER_STATE="new"\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/etcd.service")]),s._v("\n[Unit]\nDescription=Etcd Server\nAfter=network.target\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=notify\nEnvironmentFile="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/conf/etcd\nExecStart="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/bin/etcd \\\n--name=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_NAME}")]),s._v(" \\\n--data-dir=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_DATA_DIR}")]),s._v(" \\\n--listen-peer-urls=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_LISTEN_PEER_URLS}")]),s._v(" \\\n--listen-client-urls=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_LISTEN_CLIENT_URLS}")]),s._v(",http://127.0.0.1:2379 \\\n--advertise-client-urls=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_ADVERTISE_CLIENT_URLS}")]),s._v(" \\\n--initial-advertise-peer-urls=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_INITIAL_ADVERTISE_PEER_URLS}")]),s._v(" \\\n--initial-cluster=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_INITIAL_CLUSTER}")]),s._v(" \\\n--initial-cluster-token=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_INITIAL_CLUSTER_TOKEN}")]),s._v(" \\\n--initial-cluster-state=new \\\n--cert-file="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/ssl/server.pem \\\n--key-file="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/ssl/server-key.pem \\\n--peer-cert-file="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/ssl/server.pem \\\n--peer-key-file="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/ssl/server-key.pem \\\n--trusted-ca-file="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/ssl/ca.pem \\\n--peer-trusted-ca-file="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORK_DIR}")]),s._v("/ssl/ca.pem\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" etcd\nsystemctl restart etcd\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"执行脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x etcd.sh\n./etcd.sh etcd01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.141 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("etcd02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://192.168.0.142:2380,etcd03"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://192.168.0.143:2380\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## etcd01代表节点名，跟IP，后面代表其他节点的IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 端口在上面生成脚本配置")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2380端口：集群通信端口")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2379端口：数据端口")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"发送etcd目录中另两个节点中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送etcd目录中另两个节点中"}},[s._v("#")]),s._v(" 发送etcd目录中另两个节点中")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /usr/local/etcd/ root@192.168.0.143:/usr/local/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /usr/local/etcd/ root@192.168.0.142:/usr/local/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /usr/lib/systemd/system/etcd.service root@192.168.0.142:/usr/lib/systemd/system/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /usr/lib/systemd/system/etcd.service root@192.168.0.143:/usr/lib/systemd/system/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" etcd\nsystemctl start etcd\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[s._v("#")]),s._v(" 查看日志")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -100f /var/log/messages\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##会发现日志一直在输出找不到另外二个节点，剩下的就把另外二个节点启动就行了")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"_192-168-0-142机上操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_192-168-0-142机上操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("192.168.0.142机上操作")])]),s._v(" "),a("h3",{attrs:{id:"修改etcd配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改etcd配置文件"}},[s._v("#")]),s._v(" 修改etcd配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/etcd/conf/etcd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[Member]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd02"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_DATA_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd/default.etcd"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.142:2380"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.142:2379"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[Clustering]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.142:2380"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.142:2379"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd01=https://192.168.0.141:2380,etcd02=https://192.168.0.142:2380,etcd03=https://192.168.0.143:2380"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-cluster"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##除了最后第三行，把节点名跟IP修改成当前节点中IP，最后第三行的不用修改，是用于配置集群")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-2"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" etcd\nsystemctl start etcd\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看日志-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看日志-2"}},[s._v("#")]),s._v(" 查看日志")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -100f /var/log/messages\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##会发现日志一直在输出找不到另外二个节点，剩下的就把另外二个节点启动就行了")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"_192-168-0-143机上操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_192-168-0-143机上操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("192.168.0.143机上操作")])]),s._v(" "),a("h3",{attrs:{id:"修改etcd配置文件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改etcd配置文件-2"}},[s._v("#")]),s._v(" 修改etcd配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/etcd/conf/etcd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[Member]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd03"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_DATA_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd/default.etcd"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.143:2380"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.143:2379"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[Clustering]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.143:2380"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.143:2379"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd01=https://192.168.0.141:2380,etcd02=https://192.168.0.142:2380,etcd03=https://192.168.0.143:2380"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-cluster"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##除了最后第三行，把节点名跟IP修改成当前节点中IP，最后第三行的不用修改，是用于配置集群")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-3"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" etcd\nsystemctl start etcd\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看日志-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看日志-3"}},[s._v("#")]),s._v(" 查看日志")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -100f /var/log/messages\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##会发现日志一直在输出找不到另外二个节点，剩下的就把另外二个节点启动就行了")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"检测集群是否完整"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检测集群是否完整"}},[s._v("#")]),s._v(" 检测集群是否完整")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/etcd/bin/etcdctl --ca-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssl/ca.pem --cert-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssl/server.pem --key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssl/server-key.pem --endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.141:2379,https://192.168.0.142,https://192.168.0.143:2379"')]),s._v(" cluster-health\n\n\n结果：\nmember 4744090d32d62b14 is healthy: got healthy result from https://192.168.0.142:2379\nmember cad5c53fd12ea4d7 is healthy: got healthy result from https://192.168.0.143:2379\nmember ff44f0163fd2a515 is healthy: got healthy result from https://192.168.0.141:2379\ncluster is healthy\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"错误总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误总结"}},[s._v("#")]),s._v(" 错误总结")]),s._v(" "),a("p",[s._v("遇到过一个错误，启动一个节点，主节点一直报该节点证书错误，到最后发现是服务器时间不对，把时间修改回来就可以了")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"node安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node安装docker"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Node安装Docker")])]),s._v(" "),a("p",[s._v("在node节点中安装docker")]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"k8s整体分层图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s整体分层图"}},[s._v("#")]),s._v(" k8s整体分层图")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://imgchr.com/i/Ju0i1s",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/Ju0i1s.png",alt:"Ju0i1s.png"}}),a("OutboundLink")],1)]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"node节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node节点"}},[s._v("#")]),s._v(" node节点")]),s._v(" "),a("ol",[a("li",[s._v("192.168.0.142")]),s._v(" "),a("li",[s._v("192.168.0.143")])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" "),a("strong",[s._v("安装docker")])]),s._v(" "),a("p",[s._v("以下的步骤请在node的所有节点上操作")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"安装依赖包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖包"}},[s._v("#")]),s._v(" 安装依赖包")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"配置docker的yum源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置docker的yum源"}},[s._v("#")]),s._v(" 配置docker的yum源")]),s._v(" "),a("p",[s._v("需要配置docker官方的yum源来保证拉取的是官方最新的安装包")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"安装docker-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-2"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"安装daoclou加速器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装daoclou加速器"}},[s._v("#")]),s._v(" 安装daoclou加速器")]),s._v(" "),a("p",[s._v("网址："),a("a",{attrs:{href:"http://www.daocloud.io/mirror",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.daocloud.io/mirror"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL https://get.daocloud.io/daotools/set_mirror.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -s http://f1361db2.m.daocloud.io\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##如果报错，很有可能是本机的时间不同步当前时间，安装的，是在/etc/docker/daemon.json文件中，这个文件是docker默认读取的文件")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动docker"}},[s._v("#")]),s._v(" 启动docker")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start docker\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"部署kubernetes网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署kubernetes网络"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署Kubernetes网络")])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"kubernetes网络模型-cni"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes网络模型-cni"}},[s._v("#")]),s._v(" Kubernetes网络模型（CNI）")]),s._v(" "),a("ol",[a("li",[s._v("Container Network Interface(CNI)：\n"),a("ol",[a("li",[s._v("容器网络接口，Google和CoreOS主导。")])])]),s._v(" "),a("li",[s._v("Kubernetes网络模型设计基本要求：\n"),a("ol",[a("li",[s._v("一个Pod一个IP")]),s._v(" "),a("li",[s._v("每个Pod独立IP，Pod内所有容器共享网络（同一个IP）")]),s._v(" "),a("li",[s._v("所有容器都可以与所有其他容器通信")]),s._v(" "),a("li",[s._v("所有节点都可以与所有容器通信")])])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"kubernetes网络模型的实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes网络模型的实现"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Kubernetes网络模型的实现")])]),s._v(" "),a("p",[s._v("主要是由以下几种技术实现")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/Ju0w3d.png",alt:"Ju0w3d.png"}})]),s._v(" "),a("p",[s._v("一般企业中常用的就是Flannel跟Calico以及contiv")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"flannel网络插件-百台下网络方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flannel网络插件-百台下网络方案"}},[s._v("#")]),s._v(" Flannel网络插件 - (百台下网络方案)")]),s._v(" "),a("ol",[a("li",[s._v("Flannel是CoreOS团队针对Kubernetes设计的一个网络规划服务，简单来说，它的功能是让集群中的不同节点主机创建的Docker容器都具有全集群唯一的虚拟IP地址。")]),s._v(" "),a("li",[s._v("在默认的Docker配置中，每个节点上的Docker服务会分别负责所在节点容器的IP分配。这样导致的一个问题是，不同节点上容器可能获得相同的内外IP地址。并使这些容器之间能够之间通过IP地址相互找到，也就是相互ping通。")]),s._v(" "),a("li",[s._v("Flannel的设计目的就是为集群中的所有节点重新规划IP地址的使用规则，从而使得不同节点上的容器能够获得“同属一个内网”且”不重复的”IP地址，并让属于不同节点上的容器能够直接通过内网IP通信。")]),s._v(" "),a("li",[s._v("Flannel实质上是一种“覆盖网络(overlaynetwork)”，也就是将TCP数据包装在另一种网络包里面进行路由转发和通信，目前已经支持udp、vxlan、host-gw、aws-vpc、gce和alloc路由等数据转发方式，默认的节点间数据通信方式是UDP转发")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/Ju0sDP.png",alt:"Ju0sDP.png"}})]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"calico网络插件-上百台网络方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#calico网络插件-上百台网络方案"}},[s._v("#")]),s._v(" Calico网络插件 - (上百台网络方案)")]),s._v(" "),a("ol",[a("li",[s._v("Calico是一个纯3层的数据中心网络方案，而且无缝集成像OpenStack这种IaaS云架构，能够提供可控的VM、容器、裸机之间的IP通信。Calico不使用重叠网络比如flannel和libnetwork重叠网络驱动，它是一个纯三层的方法，使用虚拟路由代替虚拟交换，每一台虚拟路由通过BGP协议传播可达信息（路由）到剩余数据中心。")]),s._v(" "),a("li",[s._v("Calico在每一个计算节点利用Linux Kernel实现了一个高效的vRouter来负责数据转发，而每个vRouter通过BGP协议负责把自己上运行的workload的路由信息像整个Calico网络内传播——小规模部署可以直接互联，大规模下可通过指定的BGP route reflector来完成。")]),s._v(" "),a("li",[s._v("Calico节点组网可以直接利用数据中心的网络结构（无论是L2或者L3），不需要额外的NAT，隧道或者Overlay Network。")]),s._v(" "),a("li",[s._v("Calico基于iptables还提供了丰富而灵活的网络Policy，保证通过各个节点上的ACLs来提供Workload的多租户隔离、安全组以及其他可达性限制等功能。")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://imgchr.com/i/Ju04vn",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/19/Ju04vn.png",alt:"Ju04vn.png"}}),a("OutboundLink")],1)]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"部署kubernetes网络-flannel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署kubernetes网络-flannel"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署Kubernetes网络-Flannel")])]),s._v(" "),a("p",[s._v("这里网络模型选择的是Flannel模型，因Flannel使用起来相比Calico简单中，但是Flannel一般用于集群机器百台内的网络模型，超过百台建议使用Calico")]),s._v(" "),a("p",[s._v("Flannel也是官方推荐的网络模型")]),s._v(" "),a("p",[s._v("Overlay Network：覆盖网络，在基础网络上叠加的一种虚拟网络技术模式，该网络中的主机通过虚拟链路连接起来。\nFlannel：是Overlay网络的一种，也是将源数据包封装在另一种网络包里面进行路由转发和通信，目前已经支持UDP、"),a("strong",[s._v("VXLAN")]),s._v("、"),a("strong",[s._v("Host-GW")]),s._v("、AWS VPC和GCE路由等数据转发方式。")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"创建一个子网写到etcd中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个子网写到etcd中"}},[s._v("#")]),s._v(" 创建一个子网写到etcd中")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/etcd/bin/etcdctl --ca-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssl/ca.pem --cert-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssl/server.pem --key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssl/server-key.pem --endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.141:2379,https://192.168.0.142:2379,https://192.168.0.143:2379"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" /coreos.com/network/config "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{ "Network": "172.17.0.0/16", "Backend": {"Type": "vxlan"}}\'')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## set 创建一个子网")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Network：分配给docker的网段")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Backend：使用flannel网络模式中那个数据转发方式")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 全局域网通信建议使用：Host-GW")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 多网络通信建议使用：VXLAN")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看子网有没有生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看子网有没有生成"}},[s._v("#")]),s._v(" 查看子网有没有生成")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/usr/local/etcd/bin/etcdctl --ca-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssh/ca.pem --cert-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssh/server.pem --key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etcd/ssh/server-key.pem --endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.0.141:2379,https://192.168.0.142:2379,https://192.168.0.143:2379"')]),s._v(" get /coreos.com/network/config\n\n结果：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Network"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.0/16"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Backend"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vxlan"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"下载flannel二进制包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载flannel二进制包"}},[s._v("#")]),s._v(" 下载flannel二进制包")]),s._v(" "),a("p",[s._v("https://github.com/coreos/flannel/releases")]),s._v(" "),a("ol",[a("li",[s._v("在master节点也是可以部署flannel网络的，不过是可选的")]),s._v(" "),a("li",[s._v("需要在node节点上部署：\n"),a("ol",[a("li",[s._v("192.168.0.142")]),s._v(" "),a("li",[s._v("192.168.0.143")])])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_192-168-0-142机上操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_192-168-0-142机上操作-2"}},[s._v("#")]),s._v(" "),a("strong",[s._v("192.168.0.142机上操作")])]),s._v(" "),a("h4",{attrs:{id:"进入目录并解压并进入-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入目录并解压并进入-2"}},[s._v("#")]),s._v(" 进入目录并解压并进入")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /k8s\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxf flannel-v0.10.0-linux-amd64.tar.gz\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"创建目录-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录-2"}},[s._v("#")]),s._v(" 创建目录")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/kubernetes/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("bin,conf,ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"复制文件到kubernetes的bin目录中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制文件到kubernetes的bin目录中"}},[s._v("#")]),s._v(" 复制文件到kubernetes的bin目录中")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" flanneld mk-docker-opts.sh /usr/local/kubernetes/bin/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"编写部署脚本-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本-2"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" flanneld.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ENDPOINTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v('"http'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("127.0.0.1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v('2379"}')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/flanneld")]),s._v('\n\nFLANNEL_OPTIONS="--etcd-endpoints='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_ENDPOINTS}")]),s._v(' \\\n-etcd-cafile=/usr/local/etcd/ssl/ca.pem \\\n-etcd-certfile=/usr/local/etcd/ssl/server.pem \\\n-etcd-keyfile=/usr/local/etcd/ssl/server-key.pem"\n\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/flanneld.service")]),s._v("\n[Unit]\nDescription=Flanneld overlay address etcd agent\nAfter=network-online.target network.target\nBefore=docker.service\n\n[Service]\nType=notify\nEnvironmentFile=/usr/local/kubernetes/conf/flanneld\nExecStart=/usr/local/kubernetes/bin/flanneld --ip-masq \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLANNEL_OPTIONS")]),s._v("\nExecStartPost=/usr/local/kubernetes/bin/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/subnet.env\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/docker.service")]),s._v("\n\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n\n[Service]\nType=notify\nEnvironmentFile=/run/flannel/subnet.env\nExecStart=/usr/bin/dockerd \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKER_NETWORK_OPTIONS")]),s._v("\nExecReload=/bin/kill -s HUP \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTimeoutStartSec=0\nDelegate=yes\nKillMode=process\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n\n[Install]\nWantedBy=multi-user.target\n\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" flanneld\nsystemctl restart flanneld\nsystemctl restart docker\n    \n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## /run/flannel/：这个目录存放着刚才创建的子网相关文件")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"执行脚本-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本-2"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x flanneld.sh\n./flanneld.sh https://192.168.0.141:2379,https://192.168.0.142:2379,https://192.168.0.143:2379\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##执行脚本时要带有etcd集群的IP")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"执行脚本后会生成三个配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本后会生成三个配置文件"}},[s._v("#")]),s._v(" 执行脚本后会生成三个配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/local/kubernetes/conf/flanneld\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLANNEL_OPTIONS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--etcd-endpoints=https://192.168.0.141:2379,https://192.168.0.142:2379,https://192.168.0.143:2379 -etcd-cafile=/usr/local/etcd/ssl/ca.pem -etcd-certfile=/usr/local/etcd/ssl/server.pem -etcd-keyfile=/usr/local/etcd/ssl/server-key.pem"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/lib/systemd/system/flanneld.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Flanneld overlay address etcd agent\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target network.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Before")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/kubernetes/conf/flanneld\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/kubernetes/bin/flanneld --ip-masq "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLANNEL_OPTIONS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPost")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/kubernetes/bin/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/subnet.env\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/lib/systemd/system/docker.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Docker Application Container Engine\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://docs.docker.com\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target firewalld.service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/flannel/subnet.env\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKER_NETWORK_OPTIONS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -s HUP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitNOFILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitNPROC")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitCORE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TimeoutStartSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Delegate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("StartLimitBurst")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("StartLimitInterval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("60s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"启动flanneld网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动flanneld网络"}},[s._v("#")]),s._v(" 启动flanneld网络")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" flanneld\nsystemctl start flanneld\nsystemctl restart docker\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"查看docker是否是用flanneld网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看docker是否是用flanneld网络"}},[s._v("#")]),s._v(" 查看docker是否是用flanneld网络")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n\ndocker0: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v("<")]),s._v("UP,BROADCAST,MULTICAST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".56.1  netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".56.255\n        ether 02:42:15:ef:ba:64  txqueuelen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nflannel.1: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1450")]),s._v("\n        inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".56.0  netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.255  broadcast "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n        inet6 fe80::9ce8:8eff:fe50:a1b7  prefixlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x20\n        ether 9e:e8:8e:50:a1:b7  txqueuelen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##docker0的网卡跟flannel.1的网卡是在同一网段上，就证明docker使用了flanneld网络")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"发送flannel到另一个node中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送flannel到另一个node中"}},[s._v("#")]),s._v(" 发送flannel到另一个node中")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /usr/local/kubernetes/ root@192.168.0.143:/usr/local/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /usr/lib/systemd/system/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("docker,flanneld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service root@192.168.0.143:/usr/lib/systemd/system/\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_192-168-0-143机上操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_192-168-0-143机上操作-2"}},[s._v("#")]),s._v(" "),a("strong",[s._v("192.168.0.143机上操作")])]),s._v(" "),a("p",[s._v("在192.168.0.143上直接启动不用修改配置")]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"启动flanneld网络-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动flanneld网络-2"}},[s._v("#")]),s._v(" 启动flanneld网络")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" flanneld\nsystemctl start flanneld\nsystemctl restart docker\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"查看docker是否是用flanneld网络-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看docker是否是用flanneld网络-2"}},[s._v("#")]),s._v(" 查看docker是否是用flanneld网络")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n\ndocker0: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v("<")]),s._v("UP,BROADCAST,MULTICAST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".10.1  netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".10.255\n        ether 02:42:c2:c3:04:f9  txqueuelen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nflannel.1: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1450")]),s._v("\n        inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".10.0  netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.255  broadcast "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n        inet6 fe80::9c52:51ff:feb0:21e9  prefixlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x20\n        ether 9e:52:51:b0:21:e9  txqueuelen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" overruns "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##docker0的网卡跟flannel.1的网卡是在同一网段上，就证明docker使用了flanneld网络")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"测试node节点的容器是否相通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试node节点的容器是否相通"}},[s._v("#")]),s._v(" 测试node节点的容器是否相通")]),s._v(" "),a("p",[s._v("在二个node节点都创建一个容器，并相互ping一下")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker container run -it busybox\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##在node节点的机器上使用")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看容器中的IP")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" 容器IP\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看到的IP在另的node节点的容器测试一下是否相通")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"部署master组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署master组件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署Master组件")])]),s._v(" "),a("p",[s._v("在部署Kubernetes之前一定要确保etcd、flannel、docker是正常工作的，否则先解决问题再继")]),s._v(" "),a("p",[s._v("需要部署三个组件")]),s._v(" "),a("ol",[a("li",[s._v("kube-apiserver")]),s._v(" "),a("li",[s._v("kube-controller-manager")]),s._v(" "),a("li",[s._v("kube-scheduler")])]),s._v(" "),a("p",[s._v("下载二进制包：https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.12.md 下载这个包（kubernetes-server-linux-amd64.tar.gz）就够了，包含了所需的所有组件。")]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"kube-apiserver组件的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kube-apiserver组件的部署"}},[s._v("#")]),s._v(" "),a("strong",[s._v("kube-apiserver组件的部署")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"进入目录并解压并进入-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入目录并解压并进入-3"}},[s._v("#")]),s._v(" 进入目录并解压并进入")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/soft\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxf kubernetes-server-linux-amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kubernetes\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"创建目录-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录-3"}},[s._v("#")]),s._v(" 创建目录")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/kubernetes/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("bin,conf,ssl,logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"复制文件到kubernetes的bin目录中-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制文件到kubernetes的bin目录中-2"}},[s._v("#")]),s._v(" 复制文件到kubernetes的bin目录中")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" server/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" kube-apiserver kube-controller-manager kubectl kube-scheduler /usr/local/kubernetes/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/kubernetes/bin/kubectl /usr/bin/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写部署脚本-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本-3"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" apiserver.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_SERVERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/kube-apiserver")]),s._v('\n\nKUBE_APISERVER_OPTS="--logtostderr=false '),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--log-dir=/usr/local/kubernetes/logs "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--v=4 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--etcd-servers="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_SERVERS}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--bind-address="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MASTER_ADDRESS}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--secure-port=6443 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--advertise-address="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MASTER_ADDRESS}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--allow-privileged=true "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--service-cluster-ip-range=10.0.0.0/24 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--service-node-port-range=30000-50000 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--authorization-mode=RBAC,Node "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--kubelet-https=true "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--enable-bootstrap-token-auth "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--token-auth-file=/usr/local/kubernetes/conf/token.csv "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--tls-cert-file=/usr/local/kubernetes/ssl/server.pem  "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--tls-private-key-file=/usr/local/kubernetes/ssl/server-key.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--client-ca-file=/usr/local/kubernetes/ssl/ca.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--service-account-key-file=/usr/local/kubernetes/ssl/ca-key.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--etcd-cafile=/usr/local/etcd/ssl/ca.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--etcd-certfile=/usr/local/etcd/ssl/server.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('\n--etcd-keyfile=/usr/local/etcd/ssl/server-key.pem"\n\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/kube-apiserver.service")]),s._v("\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes/kubernetes\n\n[Service]\nEnvironmentFile=-/usr/local/kubernetes/conf/kube-apiserver\nExecStart=/usr/local/kubernetes/bin/kube-apiserver \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBE_APISERVER_OPTS")]),s._v("\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-apiserver\nsystemctl restart kube-apiserver\n\n")])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("执行脚本")])]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("chmod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x apiserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/apiserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".141")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".141")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".142")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".143")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("复制证书到kubernetes的ssh目录中")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/cert/k8s-cert/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ca.pem ca-key.pem server.pem server-key.pem /usr/local/kubernetes/ssl/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"生成token-csv验证文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成token-csv验证文件"}},[s._v("#")]),s._v(" 生成token.csv验证文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" /dev/urandom "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" od -An -t x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tr")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##生成密钥")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0fb61c46f8991b718eb38d27b605b008,kubelet-bootstrap,10001,\"system:kubelet-bootstrap\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/local/kubernetes/conf/token.csv\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0fb61c46f8991b718eb38d27b605b008：密钥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubelet-bootstrap：用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10001：用户组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# system:kubelet-bootstrap：加入k8s集群")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动kube-apiserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动kube-apiserver"}},[s._v("#")]),s._v(" 启动kube-apiserver")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-apiserver\nsystemctl start kube-apiserver\n\n端口：8080，6443\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"kube-controller-manager组件的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kube-controller-manager组件的部署"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Kube-controller-manager组件的部署")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写部署脚本-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本-4"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/soft/kubernetes/server/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" controller-manager.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/kube-controller-manager")]),s._v('\n\n\nKUBE_CONTROLLER_MANAGER_OPTS="--logtostderr=false '),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--log-dir=/usr/local/kubernetes/logs "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--v=4 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--master="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MASTER_ADDRESS}")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--leader-elect=true "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--address=127.0.0.1 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--service-cluster-ip-range=10.0.0.0/24 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--cluster-name=kubernetes "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--cluster-signing-cert-file=/usr/local/kubernetes/ssl/ca.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--cluster-signing-key-file=/usr/local/kubernetes/ssl/ca-key.pem  "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--root-ca-file=/usr/local/kubernetes/ssl/ca.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--service-account-private-key-file=/usr/local/kubernetes/ssl/ca-key.pem "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('\n--experimental-cluster-signing-duration=87600h0m0s"\n\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/kube-controller-manager.service")]),s._v("\n[Unit]\nDescription=Kubernetes Controller Manager\nDocumentation=https://github.com/kubernetes/kubernetes\n\n[Service]\nEnvironmentFile=-/usr/local/kubernetes/conf/kube-controller-manager\nExecStart=/usr/local/kubernetes/bin/kube-controller-manager \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBE_CONTROLLER_MANAGER_OPTS")]),s._v("\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-controller-manager\nsystemctl restart kube-controller-manager\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"执行脚本-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本-3"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x controller-manager.sh\n./controller-manager.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 启动需要绑定apiserver的8080端口，所以要确定apiserver启动起来后才能启动controller-manager")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动kube-controller-manager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动kube-controller-manager"}},[s._v("#")]),s._v(" 启动Kube-controller-manager")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-controller-manager\nsystemctl start kube-controller-manager\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"kube-scheduler组件的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kube-scheduler组件的部署"}},[s._v("#")]),s._v(" "),a("strong",[s._v("kube-scheduler组件的部署")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写部署脚本-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本-5"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/soft/kubernetes/server/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" scheduler.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/kube-scheduler")]),s._v('\n\nKUBE_SCHEDULER_OPTS="--logtostderr=false '),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--log-dir=/usr/local/kubernetes/logs "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--v=4 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--master="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MASTER_ADDRESS}")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('\n--leader-elect"\n\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/kube-scheduler.service")]),s._v("\n[Unit]\nDescription=Kubernetes Scheduler\nDocumentation=https://github.com/kubernetes/kubernetes\n\n[Service]\nEnvironmentFile=-/usr/local/kubernetes/conf/kube-scheduler\nExecStart=/usr/local/kubernetes/bin/kube-scheduler \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBE_SCHEDULER_OPTS")]),s._v("\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-scheduler\nsystemctl restart kube-scheduler\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"执行脚本-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本-4"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x scheduler.sh\n./scheduler.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 启动需要绑定apiserver的8080端口，所以要确定apiserver启动起来后才能启动controller-manager")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动kube-scheduler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动kube-scheduler"}},[s._v("#")]),s._v(" 启动kube-scheduler")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("systemctl daemon"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reload\nsystemctl enable kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\nsystemctl start kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"查看当前集群节点的状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看当前集群节点的状态"}},[s._v("#")]),s._v(" 查看当前集群节点的状态")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("kubectl get cs\n\nNAME                 STATUS    MESSAGE             ERROR\ncontroller"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager   "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Healthy")]),s._v("   ok                  \nscheduler            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Healthy")]),s._v("   ok                  \netcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Healthy")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \netcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Healthy")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \netcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Healthy")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"部署node组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署node组件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署Node组件")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/20/JMxvhq.png",alt:"JMxvhq.png"}})]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"需要部署二个组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需要部署二个组件"}},[s._v("#")]),s._v(" 需要部署二个组件")]),s._v(" "),a("ol",[a("li",[s._v("kubelet")]),s._v(" "),a("li",[s._v("kube-proxy")])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"以下操作是在master节点上操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以下操作是在master节点上操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("以下操作是在Master节点上操作")])]),s._v(" "),a("h3",{attrs:{id:"绑定到系统集群角色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定到系统集群角色"}},[s._v("#")]),s._v(" 绑定到系统集群角色")]),s._v(" "),a("p",[s._v("将kubelet-bootstrap用户绑定到系统集群角色")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl create clusterrolebinding kubelet-bootstrap --clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:node-bootstrapper --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubelet-bootstrap\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 为上面生成的token.csv验证文件中的用户绑定到集群角色中")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"编写生成kubeconfig文件的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写生成kubeconfig文件的脚本"}},[s._v("#")]),s._v(" 编写生成kubeconfig文件的脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/soft/kubernetes/server/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kubeconfig.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("APISERVER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SSL_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTSTRAP_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cd38b57ef30a4f4009fde99e9603dcb8\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建kubelet bootstrapping kubeconfig ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_APISERVER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APISERVER")]),s._v(':6443"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置集群参数")]),s._v("\nkubectl config set-cluster kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --certificate-authority"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SSL_DIR")]),s._v("/ca.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --embed-certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_APISERVER}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bootstrap.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置客户端认证参数")]),s._v("\nkubectl config set-credentials kubelet-bootstrap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --token"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BOOTSTRAP_TOKEN}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bootstrap.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置上下文参数")]),s._v("\nkubectl config set-context default "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubelet-bootstrap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bootstrap.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置默认上下文")]),s._v("\nkubectl config use-context default --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bootstrap.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#----------------------")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建kube-proxy kubeconfig文件")]),s._v("\n\nkubectl config set-cluster kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --certificate-authority"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SSL_DIR")]),s._v("/ca.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --embed-certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_APISERVER}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-proxy.kubeconfig\n\nkubectl config set-credentials kube-proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --client-certificate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SSL_DIR")]),s._v("/kube-proxy.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --client-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SSL_DIR")]),s._v("/kube-proxy-key.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --embed-certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-proxy.kubeconfig\n\nkubectl config set-context default "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-proxy.kubeconfig\n\nkubectl config use-context default --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-proxy.kubeconfig\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##注意：BOOTSTRAP_TOKEN这个变量是存放刚刚生成token.csv验证文件中的密钥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这文件存放了验证apisever的验证信息，这样其它组件才有权限访问apiserve")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("执行脚本")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x kubeconfig.sh \n./kubeconfig.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.141 /k8s/cert/k8s-cert/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 第一位参数：为master节点的IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 第二位参数：生成k8s证书的目录")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("拷贝生文件到node节点上")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/cert/k8s-cert\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" bootstrap.kubeconfig kube-proxy.kubeconfig root@192.168.0.142:/usr/local/kubernetes/conf/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" bootstrap.kubeconfig kube-proxy.kubeconfig root@192.168.0.143:/usr/local/kubernetes/conf/\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/soft/kubernetes/server/bin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" kubelet kube-proxy root@192.168.0.142:/usr/local/kubernetes/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" kubelet kube-proxy root@192.168.0.143:/usr/local/kubernetes/bin/\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"以下操作在node节点192-168-0-142操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以下操作在node节点192-168-0-142操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("以下操作在node节点192.168.0.142操作")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"部署kubelet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署kubelet"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署kubelet")])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"创建目录-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录-4"}},[s._v("#")]),s._v(" 创建目录")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/kubernetes/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("bin,conf,ssl,logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"编写部署脚本-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本-6"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kubelet.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DNS_SERVER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v('"10.0.0.2"}')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/kubelet")]),s._v('\n\nKUBELET_OPTS="--logtostderr=false '),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--log-dir=/usr/local/kubernetes/logs "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--v=4 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--hostname-override="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${NODE_ADDRESS}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--kubeconfig=/usr/local/kubernetes/conf/kubelet.kubeconfig "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--bootstrap-kubeconfig=/usr/local/kubernetes/conf/bootstrap.kubeconfig "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--config=/usr/local/kubernetes/conf/kubelet.config "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--cert-dir=//usr/local/kubernetes/ssl "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('\n--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0"\n\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/kubelet.config")]),s._v("\n\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io/v1beta1\naddress: "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${NODE_ADDRESS}")]),s._v("\nport: 10250\nreadOnlyPort: 10255\ncgroupDriver: cgroupfs\nclusterDNS:\n- "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DNS_SERVER_IP}")]),s._v(" \nclusterDomain: cluster.local.\nfailSwapOn: false\nauthentication:\n  anonymous:\n    enabled: true\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/kubelet.service")]),s._v("\n[Unit]\nDescription=Kubernetes Kubelet\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironmentFile=/usr/local/kubernetes/conf/kubelet\nExecStart=/usr/local/kubernetes/bin/kubelet \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_OPTS")]),s._v("\nRestart=on-failure\nKillMode=process\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\nsystemctl restart kubelet\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"执行脚本-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本-5"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x kubelet.sh\n./kubelet.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.142\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##当前node节点的IP")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"启动kubelet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动kubelet"}},[s._v("#")]),s._v(" 启动kubelet")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\nsystemctl start kubelet\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"节点授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点授权"}},[s._v("#")]),s._v(" 节点授权")]),s._v(" "),a("p",[a("strong",[s._v("到Master节点给node192.168.0.142节点授权")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get csr\n结果：\nNAME                                                   AGE   REQUESTOR           CONDITION\nnode-csr-In6C6aeHhDjMbourTBOFiWvji-ROo7njqhlDBKUeJl8   28h   kubelet-bootstrap   Pending\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看密钥值")]),s._v("\n\n\nkubectl certificate approve node-csr-In6C6aeHhDjMbourTBOFiWvji-ROo7njqhlDBKUeJl8\n结果：\ncertificatesigningrequest.certificates.k8s.io/node-csr-In6C6aeHhDjMbourTBOFiWvji-ROo7njqhlDBKUeJl8 approved\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##通过命令给密钥值加权")]),s._v("\n\n\nkubectl get node\n结果：\nNAME            STATUS   ROLES    AGE    VERSION\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.142   Ready    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   110m   v1.13.4\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看Node节点")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"部署kube-proxy组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署kube-proxy组件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署kube-proxy组件")])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"编写部署脚本-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写部署脚本-7"}},[s._v("#")]),s._v(" 编写部署脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" proxy.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/local/kubernetes/conf/kube-proxy")]),s._v('\n\nKUBE_PROXY_OPTS="--logtostderr=false '),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--log-dir=/usr/local/kubernetes/logs "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--v=4 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--hostname-override="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${NODE_ADDRESS}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--cluster-cidr=10.0.0.0/24 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n--proxy-mode=ipvs "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('\n--kubeconfig=/usr/local/kubernetes/conf/kube-proxy.kubeconfig"\n\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/usr/lib/systemd/system/kube-proxy.service")]),s._v("\n[Unit]\nDescription=Kubernetes Proxy\nAfter=network.target\n\n[Service]\nEnvironmentFile=-/usr/local/kubernetes/conf/kube-proxy\nExecStart=/usr/local/kubernetes/bin/kube-proxy \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBE_PROXY_OPTS")]),s._v("\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-proxy\nsystemctl restart kube-proxy\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"执行脚本-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本-6"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x proxy.sh\n./proxy.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.142\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##当前node节点的IP")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h4",{attrs:{id:"启动proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动proxy"}},[s._v("#")]),s._v(" 启动proxy")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-proxy\nsystemctl start kube-proxy\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"发送配置文件目录到另一个node节点上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送配置文件目录到另一个node节点上"}},[s._v("#")]),s._v(" 发送配置文件目录到另一个Node节点上")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /usr/local/kubernetes/ root@192.168.0.143:/usr/local/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/lib/systemd/system/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" kubelet.service kube-proxy.service root@192.168.0.143:/usr/lib/systemd/system/\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"以下操作在node节点192-168-0-143上操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以下操作在node节点192-168-0-143上操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("以下操作在node节点192.168.0.143上操作")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"删除证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除证书"}},[s._v("#")]),s._v(" 删除证书")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("rm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n")])])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("修改配置文件")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/kubernetes/conf\n\n需要修改的配置文件有以下几个\nkubelet\nkubelet.config\nkube-proxy\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##将这些配置文件中的192.168.0.142换成192.168.0.143")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("启动")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\nsystemctl start kubelet\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-proxy\nsystemctl start kube-proxy\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"节点授权-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点授权-2"}},[s._v("#")]),s._v(" 节点授权")]),s._v(" "),a("p",[a("strong",[s._v("到Master节点给node192.168.0.143节点授权")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get csr\n结果：\nNAME                                                   AGE   REQUESTOR           CONDITION\nnode-csr-In6C6aeHhDjMbourTBOFiWvji-ROo7njqhlDBKUeJl8   28h   kubelet-bootstrap   Approved,Issued\nnode-csr-bv__TEcpxKxCGUULU-5ElHHwgTXRPdxrI7zy8nxPmog   39s   kubelet-bootstrap   Pending\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看密钥值，其中有一个值是192.168.0.142的")]),s._v("\n\n\nkubectl certificate approve node-csr-bv__TEcpxKxCGUULU-5ElHHwgTXRPdxrI7zy8nxPmog\n结果：\ncertificatesigningrequest.certificates.k8s.io/node-csr-bv__TEcpxKxCGUULU-5ElHHwgTXRPdxrI7zy8nxPmog approved\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##通过命令给密钥值加权")]),s._v("\n\n\nkubectl get node\n结果：\nNAME            STATUS   ROLES    AGE    VERSION\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.142   Ready    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   110m   v1.13.4\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.143   Ready    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   17s    v1.13.4\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##查看Node节点")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"部署一个测试示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署一个测试示例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("部署一个测试示例")])]),s._v(" "),a("h2",{attrs:{id:"创建一个nginx的服务容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个nginx的服务容器"}},[s._v("#")]),s._v(" 创建一个nginx的服务容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl create deployment nginx --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"查看创建的服务容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看创建的服务容器"}},[s._v("#")]),s._v(" 查看创建的服务容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods\n\nNAME                   READY   STATUS    RESTARTS   AGE\nnginx-5c7588df-45gzq   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m45s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 第一次启动Nginx, 可能会慢点，因为系统需要拉镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 1/1：启动成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 0/1：启动中")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"扩容nginx服务容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容nginx服务容器"}},[s._v("#")]),s._v(" 扩容nginx服务容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl scale deployment nginx --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定nginx容器数量为三个")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"在查看创建的服务容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在查看创建的服务容器"}},[s._v("#")]),s._v(" 在查看创建的服务容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods\n\nNAME                   READY   STATUS    RESTARTS   AGE\nnginx-5c7588df-45gzq   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m45s\nnginx-5c7588df-56gwb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m11s\nnginx-5c7588df-hvjlf   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m11s\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"查看容器分布在那些节点上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看容器分布在那些节点上"}},[s._v("#")]),s._v(" 查看容器分布在那些节点上")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods -o wide\n\nNAME                   READY   STATUS    RESTARTS   AGE     IP            NODE            NOMINATED NODE   READINESS GATES\nnginx-5c7588df-45gzq   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m59s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".71.2   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.142   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nnginx-5c7588df-56gwb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m25s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".71.3   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.142   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nnginx-5c7588df-hvjlf   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m25s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".82.2   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.143   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("            \n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"暴露node88端口给外部连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#暴露node88端口给外部连接"}},[s._v("#")]),s._v(" 暴露node88端口给外部连接")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl expose deployment nginx --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v(" --target-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 暴露的端口是内部连接的，外部连接是暴露的随机端口")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"查看以暴露的端口并访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看以暴露的端口并访问"}},[s._v("#")]),s._v(" 查看以暴露的端口并访问")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get svc\n\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nkubernetes   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        4h45m\nnginx        NodePort    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.175   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v(":32707/TCP   23s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##访问随意node节点IP加随机端口(46771)")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"web访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web访问"}},[s._v("#")]),s._v(" web访问")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以通过二个node节点的IP加上32707端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 192.168.0.142:32707")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 192.168.0.143:32707")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"授权用户可以查看日志的权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#授权用户可以查看日志的权限"}},[s._v("#")]),s._v(" 授权用户可以查看日志的权限")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl create clusterrolebinding cluster-system-anonymous --clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cluster-admin --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:anonymous\n")])])]),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"查看创建的服务容器并查看日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看创建的服务容器并查看日志"}},[s._v("#")]),s._v(" 查看创建的服务容器并查看日志")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods\n\nNAME                   READY   STATUS    RESTARTS   AGE\nnginx-5c7588df-45gzq   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m45s\nnginx-5c7588df-56gwb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m11s\nnginx-5c7588df-hvjlf   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m11s\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\nkubectl logs nginx-5c7588df-hvjlf\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".71.0 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/Apr/2020:07:47:26 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("612")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.29.0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".71.0 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/Apr/2020:07:47:52 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("612")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/20 07:47:52 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#6: *2 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 172.17.71.0, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "192.168.0.142:32707", referrer: "http://192.168.0.142:32707/"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".71.0 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/Apr/2020:07:47:52 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /favicon.ico HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("556")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.0.142:32707/"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".82.1 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/Apr/2020:07:47:56 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("612")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".82.1 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/Apr/2020:07:47:56 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /favicon.ico HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("556")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.0.143:32707/"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/20 07:47:56 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#6: *3 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 172.17.82.1, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "192.168.0.143:32707", referrer: "http://192.168.0.143:32707/"')]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"高可用负载kubemetes集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高可用负载kubemetes集群"}},[s._v("#")]),s._v(" 高可用负载kubemetes集群")]),s._v(" "),a("p",[s._v("基于上面的kubemetes集群，在添加二台机器")]),s._v(" "),a("ol",[a("li",[s._v("192.168.0.41\n"),a("ol",[a("li",[s._v("新的maste节点\n"),a("ol",[a("li",[s._v("4G，2P")])])])])]),s._v(" "),a("li",[s._v("192.168.0.42\n"),a("ol",[a("li",[s._v("nginx节点跟keepalived节点\n"),a("ol",[a("li",[s._v("2G，1P")])])])])]),s._v(" "),a("li",[s._v("192.168.0.43\n"),a("ol",[a("li",[s._v("nginx节点跟keepalived节点\n"),a("ol",[a("li",[s._v("2G，1P")])])])])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"新建maste节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建maste节点"}},[s._v("#")]),s._v(" 新建maste节点")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"获取旧maste节点的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取旧maste节点的数据"}},[s._v("#")]),s._v(" 获取旧maste节点的数据")]),s._v(" "),a("p",[s._v("请到192.168.0.141机器上执行")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /usr/local/etcd/ssl/ root@192.168.0.41:/usr/local/etcd/ssl/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r /usr/local/kubernetes/ root@192.168.0.41:/usr/local/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /usr/lib/systemd/system/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("kube-apiserver,kube-controller-manager,kube-scheduler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service root@192.168.0.41:/usr/lib/systemd/system\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"创建kubectl命令文件软链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建kubectl命令文件软链接"}},[s._v("#")]),s._v(" 创建kubectl命令文件软链接")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/kubernetes/bin/kubectl /usr/bin/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"修改kube-apiserver的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改kube-apiserver的配置"}},[s._v("#")]),s._v(" 修改kube-apiserver的配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/kubernetes/conf/kube-apiserver\n--bind-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.41 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--advertise-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.41 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 把这二行的IP修改为当前新节点的IP")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动新节点的三个组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动新节点的三个组件"}},[s._v("#")]),s._v(" 启动新节点的三个组件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-apiserver\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-controller-manager\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-scheduler\nsystemctl start kube-apiserver\nsystemctl start kube-controller-manager\nsystemctl start kube-scheduler\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 先启动kube-apiserver，要保证kube-apiserver启动后才能启动其他二个节点，因为其他二个节点都是依赖kube-apiserver的8080端口")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看当前集群节点的状态-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看当前集群节点的状态-2"}},[s._v("#")]),s._v(" 查看当前集群节点的状态")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get cs\n\nNAME                 STATUS    MESSAGE             ERROR\ncontroller-manager   Healthy   ok                  \nscheduler            Healthy   ok                  \netcd-1               Healthy   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \netcd-0               Healthy   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \netcd-2               Healthy   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看运行的容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看运行的容器"}},[s._v("#")]),s._v(" 查看运行的容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods\n\nNAME                   READY   STATUS    RESTARTS   AGE\nnginx-5c7588df-45gzq   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          156m\nnginx-5c7588df-56gwb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          153m\nnginx-5c7588df-hvjlf   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          153m\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"在192-168-0-42搭建nginx跟keepalived"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在192-168-0-42搭建nginx跟keepalived"}},[s._v("#")]),s._v(" 在192.168.0.42搭建nginx跟keepalived")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"安装nginx跟keepalived"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx跟keepalived"}},[s._v("#")]),s._v(" 安装nginx跟keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx keepalived\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"修改nginx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改nginx配置"}},[s._v("#")]),s._v(" 修改nginx配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/nginx/nginx.conf\n\nstream "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  /var/log/nginx/k8s-access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    upstream k8s-apiserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.141:6443"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.41:6443"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_pass k8s-apiserver；\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在http{}头上添加stream{}，stream是基于4层的负载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## access_log：是日志输出 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## server{}：是监听6443端口，如果6443端口有数据就会调用k8s-apiserver模块")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## upstream{}：定义负载的模块")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动nginx"}},[s._v("#")]),s._v(" 启动nginx")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start nginx\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"创建nginx心跳检测脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建nginx心跳检测脚本"}},[s._v("#")]),s._v(" 创建nginx心跳检测脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/nginx/check_nginx.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -cv "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grep|'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$count")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    systemctl stop keepalived\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 让keepalived自行调用")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"增加nginx心跳检测脚本可执行权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加nginx心跳检测脚本可执行权限"}},[s._v("#")]),s._v(" 增加nginx心跳检测脚本可执行权限")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/nginx/check_nginx.sh\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"修改keepalived配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改keepalived配置"}},[s._v("#")]),s._v(" 修改keepalived配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/keepalived/keepalived.conf\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Configuration File "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived \n \nglobal_defs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n   notification_email "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n     acassen@firewall.loc \n     failover@firewall.loc \n     sysadmin@firewall.loc \n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n   notification_email_from Alexandre.Cassen@firewall.loc  \n   smtp_server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 \n   smtp_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \n   router_id NGINX_MASTER \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\nvrrp_script check_nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/nginx/check_nginx.sh"')]),s._v("\n    interval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 检测时间间隔")]),s._v("\n    weight -20 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 如果条件成立，权重-20")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface eth0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 网卡名，一定要跟当前机器的网卡名一致")]),s._v("\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VRRP 路由 ID实例，每个实例是唯一的")]),s._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 优先级，备服务器设置 90")]),s._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定VRRP 心跳包通告间隔时间，默认1秒")]),s._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.40/24\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    track_script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        check_nginx\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 把文件清空，写入上面的配置")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动keepalived"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动keepalived"}},[s._v("#")]),s._v(" 启动keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start keepalived\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看ip"}},[s._v("#")]),s._v(" 查看IP")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": eth0: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc pfifo_fast state UP group default qlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether 00:50:56:39:24:d1 brd ff:ff:ff:ff:ff:ff\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.43/24 brd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.255 scope global noprefixroute eth0\n       valid_lft forever preferred_lft forever\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.40/24 scope global secondary eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::7afa:61f2:9555:6c8e/64 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" noprefixroute \n       valid_lft forever preferred_lft forever\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"移动配置文件到192-168-0-43上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移动配置文件到192-168-0-43上"}},[s._v("#")]),s._v(" 移动配置文件到192.168.0.43上")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /etc/keepalived/keepalived.conf root@192.168.0.43:/root\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /etc/nginx/check_nginx.sh root@192.168.0.43:/root\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"在192-168-0-43搭建nginx跟keepalived"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在192-168-0-43搭建nginx跟keepalived"}},[s._v("#")]),s._v(" 在192.168.0.43搭建nginx跟keepalived")]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"安装nginx跟keepalived-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx跟keepalived-2"}},[s._v("#")]),s._v(" 安装nginx跟keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx keepalived\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"修改nginx配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改nginx配置-2"}},[s._v("#")]),s._v(" 修改nginx配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/nginx/nginx.conf\n\nstream "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  /var/log/nginx/k8s-access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    upstream k8s-apiserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.141:6443"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.41:6443"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_pass k8s-apiserver；\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在http{}头上添加stream{}，stream是基于4层的负载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## access_log：是日志输出 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## server{}：是监听6443端口，如果6443端口有数据就会调用k8s-apiserver模块")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## upstream{}：定义负载的模块")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动nginx-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动nginx-2"}},[s._v("#")]),s._v(" 启动nginx")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start nginx\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"移动文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移动文件"}},[s._v("#")]),s._v(" 移动文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /root/check_nginx.sh /etc/nginx/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /root/keepalived.conf /etc/keepalived/\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"增加nginx心跳检测脚本可执行权限-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加nginx心跳检测脚本可执行权限-2"}},[s._v("#")]),s._v(" 增加nginx心跳检测脚本可执行权限")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/nginx/check_nginx.sh\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"修改keepalived配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改keepalived配置-2"}},[s._v("#")]),s._v(" 修改keepalived配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/keepalived/keepalived.conf\n\nstate BACKUP\npriority "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改这二项")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"启动keepalived-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动keepalived-2"}},[s._v("#")]),s._v(" 启动keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start keepalived\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"查看ip-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看ip-2"}},[s._v("#")]),s._v(" 查看IP")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": eth0: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc pfifo_fast state UP group default qlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether 00:50:56:39:24:d1 brd ff:ff:ff:ff:ff:ff\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.43/24 brd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.255 scope global noprefixroute eth0\n       valid_lft forever preferred_lft forever\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.40/24 scope global secondary eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::7afa:61f2:9555:6c8e/64 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" noprefixroute \n       valid_lft forever preferred_lft forever\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 可以关闭192.168.0.42的nginx，看看192.168.0.40的VIP会不会移动到192.168.0.43的机器上")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"配置node集群访问ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置node集群访问ip"}},[s._v("#")]),s._v(" 配置node集群访问IP")]),s._v(" "),a("p",[a("strong",[s._v("把node节点需要访问maste节点的IP改成上面配置好的虚拟IP")])]),s._v(" "),a("p",[a("strong",[s._v("以下操作在二个node节点都要")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"修改node节点的配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改node节点的配置文件"}},[s._v("#")]),s._v(" 修改node节点的配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("修改有三个文件，bootstrap.kubeconfig，kubelet.kubeconfig，kube-proxy.kubeconfig\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 把这三个文件的IP修改成虚拟IP，端口不用改，这样子node节点访问maste节点就会先经过nginx负载转发")]),s._v("\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"重启服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启服务"}},[s._v("#")]),s._v(" 重启服务")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl restart kubelet\nsystemctl restart kube-proxy\n")])])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"故障"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#故障"}},[s._v("#")]),s._v(" 故障")]),s._v(" "),a("p",[s._v("注意：在本人实践文章的可行时，报了错，最终找到原因：是因为上面虚拟IP192.168.0.40并没有加入k8s证书中，所以node不认同这个IP")]),s._v(" "),a("p",[s._v("解决方案：如果是按上面的IP来部署的话，可以把nginx跟keepalived节点之一的192.168.0.42修改一下IP，并把192.168.0.42改为虚拟IP，因为在上面k8s认证的时候就只写了三个IP，其中二个都是maste节点，还有一个就是192.168.0.42这个IP")]),s._v(" "),a("p",[s._v('上面k8s证书中的IP："192.168.0.141"，"192.168.0.41"，"192.168.0.42"')]),s._v(" "),a("p",[s._v("如果不是按上面的配置部署，那么查一下还有没有k8s证书中剩余可使用的IP，如果没有就只能重新生成证书并对老证书进行替换")]),s._v(" "),a("p",[s._v("目前博客已在博文中把192.168.0.40这个IP加入证书")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h1",{attrs:{id:"部署kubernetes的web界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署kubernetes的web界面"}},[s._v("#")]),s._v(" 部署kubernetes的web界面")]),s._v(" "),a("p",[s._v("目前我就只在192.168.0.141这台机部署，如果需要负载，可以在192.168.0.41上在部署一遍，然后用nginx做负载就行了，目前就使用简单的单机web界面")]),s._v(" "),a("h2",{attrs:{id:"创建目录并进入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录并进入"}},[s._v("#")]),s._v(" 创建目录并进入")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /k8s/web\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /k8s/web\n")])])]),a("h2",{attrs:{id:"生成web证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成web证书"}},[s._v("#")]),s._v(" 生成web证书")]),s._v(" "),a("h3",{attrs:{id:"编写证书脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写证书脚本"}},[s._v("#")]),s._v(" 编写证书脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" dashboard-cert.sh\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dashboard-csr.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n    "CN": "Dashboard",\n    "hosts": [],\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "L": "BeiJing",\n            "ST": "BeiJing"\n        }\n    ]\n}\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("K8S_CA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\ncfssl gencert -ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$K8S_CA")]),s._v("/ca.pem -ca-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$K8S_CA")]),s._v("/ca-key.pem -config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$K8S_CA")]),s._v("/ca-config.json -profile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes dashboard-csr.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson -bare dashboard\nkubectl delete secret kubernetes-dashboard-certs -n kube-system\nkubectl create secret generic kubernetes-dashboard-certs --from-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./ -n kube-system\n")])])]),a("h3",{attrs:{id:"执行脚本-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本-7"}},[s._v("#")]),s._v(" 执行脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" dashboard-cert.sh /k8s/cert/k8s-cert\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":04:19 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generate received request\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":04:19 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received CSR\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":04:19 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generating key: rsa-2048\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":04:19 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" encoded CSR\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":04:19 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" signed certificate with serial number "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("174470471201869135810243443026966519858501030342")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/04/21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":04:19 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WARNING"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" This certificate lacks a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),s._v(" field. This makes it unsuitable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("\nwebsites. For "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information see the Baseline Requirements "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the Issuance and Management\nof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://cabforum.org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nspecifically, section "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".3 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Information Requirements"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nsecret "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-dashboard-certs"')]),s._v(" deleted\nsecret/kubernetes-dashboard-certs created\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 脚本会自动的替换k8s原先证书的位置")]),s._v("\n")])])]),a("h2",{attrs:{id:"拉取git"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取git"}},[s._v("#")]),s._v(" 拉取git")]),s._v(" "),a("p",[s._v("安装web界面需要的yaml文件都在git上")]),s._v(" "),a("p",[s._v("地址：https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dashboard")]),s._v(" "),a("p",[s._v("我这边是事先下载好")]),s._v(" "),a("p",[s._v("需要的文件：dashboard-configmap.yaml  dashboard-controller.yaml  dashboard-rbac.yaml  dashboard-secret.yaml  dashboard-service.yaml")]),s._v(" "),a("h2",{attrs:{id:"部署不需要修改三个文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署不需要修改三个文件"}},[s._v("#")]),s._v(" 部署不需要修改三个文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f dashboard-rbac.yaml\nkubectl apply -f dashboard-configmap.yaml\nkubectl apply -f dashboard-secret.yaml\n")])])]),a("h2",{attrs:{id:"部署需要修改的二个文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署需要修改的二个文件"}},[s._v("#")]),s._v(" 部署需要修改的二个文件")]),s._v(" "),a("h3",{attrs:{id:"dashboard-controller-yaml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dashboard-controller-yaml"}},[s._v("#")]),s._v(" dashboard-controller.yaml")]),s._v(" "),a("p",[s._v("需要修改下载镜像的地址，因为默认地址是官方的")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mage: registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改这行配置，把镜像地址修改成阿里云的镜像仓库")]),s._v("\n\nargs:\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PLATFORM-SPECIFIC ARGS HERE")]),s._v("\n          - --auto-generate-certificates\n          - --tls-key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dashboard-key.pem\n          - --tls-cert-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dashboard.pe\n          \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 增加：- --tls-key-file=dashboard-key.pem，- --tls-cert-file=dashboard.pe这二行配置，让web界面使用自己的生成的证书")]),s._v("\n")])])]),a("h4",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f dashboard-controller.yaml\n")])])]),a("h4",{attrs:{id:"查看部署结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看部署结果"}},[s._v("#")]),s._v(" 查看部署结果")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods -n kube-system\nNAME                                    READY   STATUS    RESTARTS   AGE\nkubernetes-dashboard-785f8ff65c-9h57l   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          93s\n")])])]),a("h3",{attrs:{id:"dashboard-service-yaml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dashboard-service-yaml"}},[s._v("#")]),s._v(" dashboard-service.yaml")]),s._v(" "),a("p",[s._v("只需要修改暴露端口")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("type: NodePort\nnodePort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30001")]),s._v("\n")])])]),a("h4",{attrs:{id:"部署-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署-2"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f dashboard-service.yaml\n")])])]),a("h2",{attrs:{id:"查看暴露的端口跟ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看暴露的端口跟ip"}},[s._v("#")]),s._v(" 查看暴露的端口跟IP")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods -n kube-system -o wide\nNAME                                    READY   STATUS    RESTARTS   AGE     IP            NODE            NOMINATED NODE   READINESS GATES\nkubernetes-dashboard-785f8ff65c-9h57l   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          7m52s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".82.3   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.143   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n\nkubectl get svc -n kube-system\nNAME                   TYPE       CLUSTER-IP   EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         AGE\nkubernetes-dashboard   NodePort   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.219   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":30001/TCP   73s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 暴露的IP为：192.168.0.143")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 暴露的端口为：30001")]),s._v("\n")])])]),a("h2",{attrs:{id:"访问web界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问web界面"}},[s._v("#")]),s._v(" 访问web界面")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("https://192.168.0.143:30001/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 需要https访问，会报证书过期，直接接受风险就行")]),s._v("\n")])])]),a("h2",{attrs:{id:"创建登录令牌"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建登录令牌"}},[s._v("#")]),s._v(" 创建登录令牌")]),s._v(" "),a("p",[s._v("登录有二种登录方式，我们就选令牌的方式")]),s._v(" "),a("h3",{attrs:{id:"编写创建令牌的文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写创建令牌的文件"}},[s._v("#")]),s._v(" 编写创建令牌的文件")]),s._v(" "),a("p",[s._v("默认创建完的用户是管理员")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" k8s-admin.yaml\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: dashboard-admin\n  namespace: kube-system\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: dashboard-admin\nsubjects:\n  - kind: ServiceAccount\n    name: dashboard-admin\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\n")])])]),a("h3",{attrs:{id:"部署-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署-3"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply -f k8s-admin.yaml\n")])])]),a("h3",{attrs:{id:"查看令牌"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看令牌"}},[s._v("#")]),s._v(" 查看令牌")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get secret -n kube-system\nNAME                               TYPE                                  DATA   AGE\ndashboard-admin-token-5txcb        kubernetes.io/service-account-token   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      39s\ndefault-token-bctts                kubernetes.io/service-account-token   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      31h\nkubernetes-dashboard-certs         Opaque                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      19m\nkubernetes-dashboard-key-holder    Opaque                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      19m\nkubernetes-dashboard-token-t9kps   kubernetes.io/service-account-token   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      18m\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 获取NAME值：dashboard-admin-token-5txcb")]),s._v("\n\nkubectl describe secret dashboard-admin-token-5txcb -n kube-system\nName:         dashboard-admin-token-5txcb\nNamespace:    kube-system\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: 74de8530-83b5-11ea-ad90-0050563b26da\n\nType:  kubernetes.io/service-account-token\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nca.crt:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1359")]),s._v(" bytes\nnamespace:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tNXR4Y2IiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNzRkZTg1MzAtODNiNS0xMWVhLWFkOTAtMDA1MDU2M2IyNmRhIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.qn8Cb5BtNTaVYQ2q2Im61BOnHPD6LwcmGTG95Reei5gjU_P1aI6tosg9LN0Nm3ANxZxHDPJJ_wXQtqgMv4a9FILs72DcnNl5heJq3U1iUXPwbxVG-6q4cwLnQ5FPf23DhZhX_UJQaGpGYR81LpaR7-7ZJlmgmfD97YioWMdxeli4oNHMFEcTIkCR02SXqGcYjBTgAgxDuDKJJvQfCGumHp_V_Z2eP8AnRy-Snww5FHi0Ibx4p6y_AyQVHrnUccNTK-Glq6Gp3EXM7BgCL8Wykc2r8hpP5RMJ9qnbJ0jvOL_VtEChted_2yXCcQMFfg2Gbpco3mo8tApz_e0_nW_Sqg\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 获取令牌值：eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tNXR4Y2IiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNzRkZTg1MzAtODNiNS0xMWVhLWFkOTAtMDA1MDU2M2IyNmRhIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.qn8Cb5BtNTaVYQ2q2Im61BOnHPD6LwcmGTG95Reei5gjU_P1aI6tosg9LN0Nm3ANxZxHDPJJ_wXQtqgMv4a9FILs72DcnNl5heJq3U1iUXPwbxVG-6q4cwLnQ5FPf23DhZhX_UJQaGpGYR81LpaR7-7ZJlmgmfD97YioWMdxeli4oNHMFEcTIkCR02SXqGcYjBTgAgxDuDKJJvQfCGumHp_V_Z2eP8AnRy-Snww5FHi0Ibx4p6y_AyQVHrnUccNTK-Glq6Gp3EXM7BgCL8Wykc2r8hpP5RMJ9qnbJ0jvOL_VtEChted_2yXCcQMFfg2Gbpco3mo8tApz_e0_nW_Sqg")]),s._v("\n")])])]),a("h2",{attrs:{id:"登录web界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录web界面"}},[s._v("#")]),s._v(" 登录web界面")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://imgchr.com/i/JGmZee",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/21/JGmZee.png",alt:"JGmZee.png"}}),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://imgchr.com/i/JGmKJI",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/21/JGmKJI.png",alt:"JGmKJI.png"}}),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);