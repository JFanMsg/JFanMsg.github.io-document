<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>52. threading线程管理模块、queue队列模块、concurrent线程池模块 | MSG</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="在追寻技术的同时享受生活">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.d65bef42.js" as="script"><link rel="preload" href="/assets/js/2.2249178e.js" as="script"><link rel="preload" href="/assets/js/118.ebb58ddb.js" as="script"><link rel="prefetch" href="/assets/js/10.4785e2e5.js"><link rel="prefetch" href="/assets/js/100.33fceff2.js"><link rel="prefetch" href="/assets/js/101.62e1e5d4.js"><link rel="prefetch" href="/assets/js/102.8551fe71.js"><link rel="prefetch" href="/assets/js/103.47754d79.js"><link rel="prefetch" href="/assets/js/104.4adf114f.js"><link rel="prefetch" href="/assets/js/105.6206a08a.js"><link rel="prefetch" href="/assets/js/106.1c4561f3.js"><link rel="prefetch" href="/assets/js/107.e1531a5a.js"><link rel="prefetch" href="/assets/js/108.c637743a.js"><link rel="prefetch" href="/assets/js/109.3f150913.js"><link rel="prefetch" href="/assets/js/11.bd8ec7a6.js"><link rel="prefetch" href="/assets/js/110.088c1ac3.js"><link rel="prefetch" href="/assets/js/111.66d8d491.js"><link rel="prefetch" href="/assets/js/112.231663ee.js"><link rel="prefetch" href="/assets/js/113.a38bc531.js"><link rel="prefetch" href="/assets/js/114.e165daea.js"><link rel="prefetch" href="/assets/js/115.994b087a.js"><link rel="prefetch" href="/assets/js/116.ea3cfdfb.js"><link rel="prefetch" href="/assets/js/117.7be5e4f3.js"><link rel="prefetch" href="/assets/js/119.90018646.js"><link rel="prefetch" href="/assets/js/12.0d8f43df.js"><link rel="prefetch" href="/assets/js/120.bb5be863.js"><link rel="prefetch" href="/assets/js/121.3d1db670.js"><link rel="prefetch" href="/assets/js/122.d29ed1b2.js"><link rel="prefetch" href="/assets/js/123.38cc4704.js"><link rel="prefetch" href="/assets/js/124.cc8549d4.js"><link rel="prefetch" href="/assets/js/125.6ee3e9c8.js"><link rel="prefetch" href="/assets/js/126.48710eba.js"><link rel="prefetch" href="/assets/js/127.d7a1fd83.js"><link rel="prefetch" href="/assets/js/128.e5017f6b.js"><link rel="prefetch" href="/assets/js/129.4c33e121.js"><link rel="prefetch" href="/assets/js/13.2dbde7aa.js"><link rel="prefetch" href="/assets/js/130.cda66247.js"><link rel="prefetch" href="/assets/js/131.ad76f669.js"><link rel="prefetch" href="/assets/js/132.aca88758.js"><link rel="prefetch" href="/assets/js/133.a1cf5903.js"><link rel="prefetch" href="/assets/js/134.b1386377.js"><link rel="prefetch" href="/assets/js/135.94edcf53.js"><link rel="prefetch" href="/assets/js/136.24be4170.js"><link rel="prefetch" href="/assets/js/137.db57772e.js"><link rel="prefetch" href="/assets/js/138.dc67bcaa.js"><link rel="prefetch" href="/assets/js/139.5453d1f6.js"><link rel="prefetch" href="/assets/js/14.2187dbf4.js"><link rel="prefetch" href="/assets/js/140.938e5c07.js"><link rel="prefetch" href="/assets/js/141.99c7cf2c.js"><link rel="prefetch" href="/assets/js/142.428e3958.js"><link rel="prefetch" href="/assets/js/143.68b01530.js"><link rel="prefetch" href="/assets/js/144.f67389cc.js"><link rel="prefetch" href="/assets/js/145.d952a130.js"><link rel="prefetch" href="/assets/js/146.b933dcad.js"><link rel="prefetch" href="/assets/js/147.2d8e4c0a.js"><link rel="prefetch" href="/assets/js/148.6d76ac94.js"><link rel="prefetch" href="/assets/js/149.6b4d6378.js"><link rel="prefetch" href="/assets/js/15.a53b356c.js"><link rel="prefetch" href="/assets/js/150.5bf39cb4.js"><link rel="prefetch" href="/assets/js/151.17af677c.js"><link rel="prefetch" href="/assets/js/152.7f1c2792.js"><link rel="prefetch" href="/assets/js/153.98dd0727.js"><link rel="prefetch" href="/assets/js/154.eb44bf23.js"><link rel="prefetch" href="/assets/js/155.5a9840ea.js"><link rel="prefetch" href="/assets/js/156.7ba01fd0.js"><link rel="prefetch" href="/assets/js/157.2296a048.js"><link rel="prefetch" href="/assets/js/158.6bb1f699.js"><link rel="prefetch" href="/assets/js/159.073bb8df.js"><link rel="prefetch" href="/assets/js/16.cef7bf44.js"><link rel="prefetch" href="/assets/js/160.25a837f9.js"><link rel="prefetch" href="/assets/js/161.93d886a1.js"><link rel="prefetch" href="/assets/js/162.5d2714b2.js"><link rel="prefetch" href="/assets/js/17.96f36904.js"><link rel="prefetch" href="/assets/js/18.fd04b310.js"><link rel="prefetch" href="/assets/js/19.3e1377d1.js"><link rel="prefetch" href="/assets/js/20.ac195ac8.js"><link rel="prefetch" href="/assets/js/21.c2d7729c.js"><link rel="prefetch" href="/assets/js/22.dd8c621b.js"><link rel="prefetch" href="/assets/js/23.ad7d0350.js"><link rel="prefetch" href="/assets/js/24.8559c4c3.js"><link rel="prefetch" href="/assets/js/25.783a8116.js"><link rel="prefetch" href="/assets/js/26.25e0e459.js"><link rel="prefetch" href="/assets/js/27.c0616e2a.js"><link rel="prefetch" href="/assets/js/28.30656c2e.js"><link rel="prefetch" href="/assets/js/29.2be5114c.js"><link rel="prefetch" href="/assets/js/3.be8c8f3b.js"><link rel="prefetch" href="/assets/js/30.230a74a7.js"><link rel="prefetch" href="/assets/js/31.760f46ad.js"><link rel="prefetch" href="/assets/js/32.c9533fef.js"><link rel="prefetch" href="/assets/js/33.dcacfb38.js"><link rel="prefetch" href="/assets/js/34.4370a466.js"><link rel="prefetch" href="/assets/js/35.bf299eea.js"><link rel="prefetch" href="/assets/js/36.336e435a.js"><link rel="prefetch" href="/assets/js/37.1d1d2eea.js"><link rel="prefetch" href="/assets/js/38.0d58b7d0.js"><link rel="prefetch" href="/assets/js/39.d43564ba.js"><link rel="prefetch" href="/assets/js/4.4a6cb970.js"><link rel="prefetch" href="/assets/js/40.bc4e4bde.js"><link rel="prefetch" href="/assets/js/41.b71231a5.js"><link rel="prefetch" href="/assets/js/42.9d46f400.js"><link rel="prefetch" href="/assets/js/43.50c5be69.js"><link rel="prefetch" href="/assets/js/44.60406e7f.js"><link rel="prefetch" href="/assets/js/45.ec3569ae.js"><link rel="prefetch" href="/assets/js/46.1bd3ce7b.js"><link rel="prefetch" href="/assets/js/47.1e1b5326.js"><link rel="prefetch" href="/assets/js/48.64c631ea.js"><link rel="prefetch" href="/assets/js/49.b4abacd8.js"><link rel="prefetch" href="/assets/js/5.e6d0b165.js"><link rel="prefetch" href="/assets/js/50.c3e320c0.js"><link rel="prefetch" href="/assets/js/51.5ec7fb8c.js"><link rel="prefetch" href="/assets/js/52.2d234f86.js"><link rel="prefetch" href="/assets/js/53.f3b69623.js"><link rel="prefetch" href="/assets/js/54.c85ff450.js"><link rel="prefetch" href="/assets/js/55.b07597b5.js"><link rel="prefetch" href="/assets/js/56.444129cf.js"><link rel="prefetch" href="/assets/js/57.df1329ba.js"><link rel="prefetch" href="/assets/js/58.5afb51cf.js"><link rel="prefetch" href="/assets/js/59.d98936d9.js"><link rel="prefetch" href="/assets/js/6.809376cd.js"><link rel="prefetch" href="/assets/js/60.02813ecf.js"><link rel="prefetch" href="/assets/js/61.37a4812d.js"><link rel="prefetch" href="/assets/js/62.5da94048.js"><link rel="prefetch" href="/assets/js/63.8e2c2bca.js"><link rel="prefetch" href="/assets/js/64.d290398f.js"><link rel="prefetch" href="/assets/js/65.44e28313.js"><link rel="prefetch" href="/assets/js/66.9acf0206.js"><link rel="prefetch" href="/assets/js/67.85688aa2.js"><link rel="prefetch" href="/assets/js/68.45bda7fc.js"><link rel="prefetch" href="/assets/js/69.9074feb0.js"><link rel="prefetch" href="/assets/js/7.5d7bce6e.js"><link rel="prefetch" href="/assets/js/70.b4cd2ddc.js"><link rel="prefetch" href="/assets/js/71.53219b13.js"><link rel="prefetch" href="/assets/js/72.af2a7290.js"><link rel="prefetch" href="/assets/js/73.c28fc506.js"><link rel="prefetch" href="/assets/js/74.64c81a90.js"><link rel="prefetch" href="/assets/js/75.05191ece.js"><link rel="prefetch" href="/assets/js/76.f516d464.js"><link rel="prefetch" href="/assets/js/77.c345180b.js"><link rel="prefetch" href="/assets/js/78.4a09d0ba.js"><link rel="prefetch" href="/assets/js/79.65f41bcf.js"><link rel="prefetch" href="/assets/js/8.f6cfdc07.js"><link rel="prefetch" href="/assets/js/80.b77151f3.js"><link rel="prefetch" href="/assets/js/81.824fa371.js"><link rel="prefetch" href="/assets/js/82.3f91c09b.js"><link rel="prefetch" href="/assets/js/83.9539f074.js"><link rel="prefetch" href="/assets/js/84.dd89f1de.js"><link rel="prefetch" href="/assets/js/85.15210b99.js"><link rel="prefetch" href="/assets/js/86.e14553e1.js"><link rel="prefetch" href="/assets/js/87.6dc95177.js"><link rel="prefetch" href="/assets/js/88.09c5e890.js"><link rel="prefetch" href="/assets/js/89.0d61f4d0.js"><link rel="prefetch" href="/assets/js/9.759f1986.js"><link rel="prefetch" href="/assets/js/90.a9b14d80.js"><link rel="prefetch" href="/assets/js/91.1a4aabe2.js"><link rel="prefetch" href="/assets/js/92.12070bdb.js"><link rel="prefetch" href="/assets/js/93.b5dc76d0.js"><link rel="prefetch" href="/assets/js/94.690498a6.js"><link rel="prefetch" href="/assets/js/95.b17961e6.js"><link rel="prefetch" href="/assets/js/96.a2f06f3e.js"><link rel="prefetch" href="/assets/js/97.64ef6721.js"><link rel="prefetch" href="/assets/js/98.443eba26.js"><link rel="prefetch" href="/assets/js/99.b6ba7c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">MSG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python-网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/4.%20Python-network/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/Python/4. Python-network/46. socket模块 - 网络套接字模块.html" class="sidebar-link">46. socket模块 - 网络套接字模块</a></li><li><a href="/Python/4. Python-network/47. subprocess模块.html" class="sidebar-link">47. subprocess模块</a></li><li><a href="/Python/4. Python-network/48. struct模块、hmac模块、处理TCP的粘包问题.html" class="sidebar-link">48. struct模块、hmac模块、处理TCP的粘包问题</a></li><li><a href="/Python/4. Python-network/49. 进程 - 理论知识.html" class="sidebar-link">49. 进程 - 理论知识</a></li><li><a href="/Python/4. Python-network/50. multiprocessing进程管理模块.html" class="sidebar-link">50. multiprocessing进程管理模块</a></li><li><a href="/Python/4. Python-network/51. 线程 - 理念知识.html" class="sidebar-link">51. 线程 - 理念知识</a></li><li><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html" class="active sidebar-link">52. threading线程管理模块、queue队列模块、concurrent线程池模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#thread模块使用简单介绍" class="sidebar-link">Thread模块使用简单介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#thread类的其他方法" class="sidebar-link">Thread类的其他方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#thread模块方法介绍" class="sidebar-link">Thread模块方法介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#启动进程-start" class="sidebar-link">启动进程 - .start()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#启动进程-run" class="sidebar-link">启动进程 - .run()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#强制终止进程-terminate" class="sidebar-link">强制终止进程 - .terminate()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#检查子进程是否存活-is-alive" class="sidebar-link">检查子进程是否存活 - .is_alive()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#等待子进程执行完毕-join" class="sidebar-link">等待子进程执行完毕 - .join()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#主进程作为子进程的守护进程-daemon" class="sidebar-link">主进程作为子进程的守护进程 .daemon()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#设置并查看子进程的名称-name" class="sidebar-link">设置并查看子进程的名称 - .name</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#查看子进程的pid-pid" class="sidebar-link">查看子进程的PID - .pid()</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#不常用的方法" class="sidebar-link">不常用的方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#thread模块创建线程" class="sidebar-link">Thread模块创建线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#常规版" class="sidebar-link">常规版</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#类版" class="sidebar-link">类版</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-进程跟线程的效率对比" class="sidebar-link">实验 - 进程跟线程的效率对比</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-进程跟线程的pid对比" class="sidebar-link">实验 - 进程跟线程的PID对比</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-线程的共享数据问题" class="sidebar-link">实验 - 线程的共享数据问题</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-线程的守护进程" class="sidebar-link">实验 - 线程的守护进程</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-多线程的socket聊天" class="sidebar-link">实验 -  多线程的socket聊天</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#lock模块的功能介绍" class="sidebar-link">Lock模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#锁的用处" class="sidebar-link">锁的用处</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#lock模块的简单使用" class="sidebar-link">Lock模块的简单使用</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-死锁的模块" class="sidebar-link">实验 - 死锁的模块</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#rlock模块的功能介绍" class="sidebar-link">RLock模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#rlcok模块的简单使用" class="sidebar-link">RLcok模块的简单使用</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-解决死锁" class="sidebar-link">实验 - 解决死锁</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#semaphore模块的功能介绍" class="sidebar-link">Semaphore模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#semaphore模块的简单使用" class="sidebar-link">Semaphore模块的简单使用</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-模拟休息室" class="sidebar-link">实验 - 模拟休息室</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#event模块的功能介绍" class="sidebar-link">Event模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#event模块的简单使用" class="sidebar-link">Event模块的简单使用</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-模拟数据库连接" class="sidebar-link">实验 - 模拟数据库连接</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#condition模块的功能介绍" class="sidebar-link">Condition模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实例-模拟进行" class="sidebar-link">实例 - 模拟进行</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#timer模块的功能介绍" class="sidebar-link">Timer模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#timer模块的简单使用" class="sidebar-link">Timer模块的简单使用</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#必看" class="sidebar-link">必看</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-queue队列模块-先进先出" class="sidebar-link">queue.Queue队列模块 - 先进先出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-queue模块的简单功能介绍" class="sidebar-link">queue.Queue模块的简单功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-queue模块的简单使用" class="sidebar-link">queue.Queue模块的简单使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-lifoqueue队列模块-后进先出" class="sidebar-link">queue.LifoQueue队列模块 - 后进先出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-lifoqueue模块的简单功能介绍" class="sidebar-link">queue.LifoQueue模块的简单功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-lifoqueue模块的简单使用" class="sidebar-link">queue.LifoQueue模块的简单使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-priorityqueue队列模块-优先级先出" class="sidebar-link">queue.PriorityQueue队列模块 - 优先级先出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-priorityqueue模块的简单功能介绍" class="sidebar-link">queue.PriorityQueue模块的简单功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#queue-lifoqueue模块的简单使用-2" class="sidebar-link">queue.LifoQueue模块的简单使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#concurrent-futures模块的功能介绍" class="sidebar-link">concurrent.futures模块的功能介绍</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#多线程使用submit-方法传递多个值" class="sidebar-link">多线程使用submit()方法传递多个值</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-使用线程池来计算平方求和" class="sidebar-link">实验 - 使用线程池来计算平方求和</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-使用进程池来计算平方求和" class="sidebar-link">实验 - 使用进程池来计算平方求和</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-使用线程池来计算平方求和-map方法" class="sidebar-link">实验 - 使用线程池来计算平方求和 - map方法</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-使用线程池来计算平方求和-回调函数" class="sidebar-link">实验 - 使用线程池来计算平方求和 - 回调函数</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#实验-证明线程的回调函数是谁调用的" class="sidebar-link">实验 - 证明线程的回调函数是谁调用的</a></li><li class="sidebar-sub-header"><a href="/Python/4. Python-network/52. threading线程管理模块、queue队列模块、concurrent线程池模块.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/Python/4. Python-network/53. 协程、Greenlet模块、Gevent模块.html" class="sidebar-link">53. 协程、Greenlet模块、Gevent模块</a></li><li><a href="/Python/4. Python-network/54. IO多路复用.html" class="sidebar-link">54. IO多路复用</a></li><li><a href="/Python/4. Python-network/55. 网络编程大作业 - 类网盘项目.html" class="sidebar-link">55. 网络编程大作业 - 类网盘项目</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_52-threading线程管理模块、queue队列模块、concurrent线程池模块"><a href="#_52-threading线程管理模块、queue队列模块、concurrent线程池模块" class="header-anchor">#</a> 52. threading线程管理模块、queue队列模块、concurrent线程池模块</h1> <h1 id="一点理论知识"><a href="#一点理论知识" class="header-anchor">#</a> 一点理论知识</h1> <p><strong>全局解释器锁GIL</strong></p> <p>Python代码的执行由Python虚拟机(也叫解释器主循环)来控制。Python在设计之初就考虑到要在主循环中，同时只有一个线程在执行。虽然 Python 解释器中可以“运行”多个线程，但在任意时刻只有一个线程在解释器中运行。</p> <p>对Python虚拟机的访问由全局解释器锁(GIL)来控制，正是这个锁能保证同一时刻只有一个线程在运行。</p> <p>在多线程环境中，Python 虚拟机按以下方式执行：</p> <ol><li><p>设置 GIL；</p></li> <li><p>切换到一个线程去运行；</p></li> <li><p>运行指定数量的字节码指令或者线程主动让出控制(可以调用 time.sleep(0))；</p></li> <li><p>把线程设置为睡眠状态；</p></li> <li><p>解锁 GIL；</p></li> <li><p>再次重复以上所有步骤。</p></li> <li><p>在调用外部代码(如 C/C++扩展函数)的时候，GIL将会被锁定，直到这个函数结束为止(由于在这期间没有Python的字节码被运行，所以不会做线程切换)编写扩展的程序员可以主动解锁GIL。</p></li></ol> <p><strong>python线程模块的选择</strong></p> <p>Python提供了几个用于多线程编程的模块，包括thread、threading和Queue等。</p> <p>thread和threading模块允许程序员创建和管理线程。</p> <p>thread模块提供了基本的线程和锁的支持，</p> <p>threading提供了更高级别、功能更强的线程管理的功能。</p> <p>Queue模块允许用户创建一个可以用于多个线程之间共享数据的队列数据结构。</p> <p>避免使用thread模块，因为更高级别的threading模块更为先进，对线程的支持更为完善，而且使用thread模块里的属性有可能会与threading出现冲突；其次低级别的thread模块的同步原语很少(实际上只有一个)，而threading模块则有很多；再者，thread模块中当主线程结束时，所有的线程都会被强制结束掉，没有警告也不会有正常的清除工作，至少threading模块能确保重要的子线程退出后进程才退出。</p> <p>thread模块不支持守护线程，当主线程退出时，所有的子线程不论它们是否还在工作，都会被强行退出。而threading模块支持守护线程，守护线程一般是一个等待客户请求的服务器，如果没有客户提出请求它就在那等着，如果设定一个线程为守护线程，就表示这个线程是不重要的，在进程退出的时候，不用等待这个线程退出。</p> <h1 id="threading-thread线程模块"><a href="#threading-thread线程模块" class="header-anchor">#</a> Threading.Thread线程模块</h1> <p>Thread模块是一个创建线程的模块，借助这个模块，就可以完成线程的创建跟使用。</p> <h2 id="thread模块使用简单介绍"><a href="#thread模块使用简单介绍" class="header-anchor">#</a> Thread模块使用简单介绍</h2> <div class="language-python extra-class"><pre class="language-python"><code>Thread<span class="token punctuation">(</span>group<span class="token punctuation">,</span>target<span class="token punctuation">,</span>name<span class="token punctuation">,</span>args<span class="token punctuation">,</span>kwargs<span class="token punctuation">)</span>，由该类实例化得到的对象，表示一个子进程中的任务（尚未启动）

<span class="token comment">#常用</span>
target<span class="token operator">=</span>  <span class="token comment">##指定某一个方法或类开启子进程线程并运行，表示调用对象，即子进程要执行的任务</span>
args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token comment">##指定传输给target函数位置的数据，元组形式，需要有逗号，表示调用对象的位置参数元组，args=(1,2,'egon',)</span>

<span class="token comment"># 其他参数</span>
group <span class="token comment">#参数未使用，值始终为None</span>
kwargs <span class="token comment">#表示调用对象的字典,kwargs={'name':'egon','age':18}</span>
name <span class="token comment">#为子进程的名称</span>
</code></pre></div><h3 id="thread类的其他方法"><a href="#thread类的其他方法" class="header-anchor">#</a> Thread类的其他方法</h3> <div class="language-python extra-class"><pre class="language-python"><code>Thread实例对象的方法
  <span class="token comment"># isAlive(): 返回线程是否活动的。</span>
  <span class="token comment"># getName(): 返回线程名。</span>
  <span class="token comment"># setName(): 设置线程名。</span>

threading模块提供的一些方法：
threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 返回当前的线程对象。</span>
threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回当前的线程对象，和上述方法一样。</span>
threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 返回一个包含正在运行的线程的list。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。</span>
threading<span class="token punctuation">.</span>activeCount<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</span>
threading<span class="token punctuation">.</span>active_count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回正在运行的线程数量，和上述方法一样</span>
</code></pre></div><h2 id="thread模块方法介绍"><a href="#thread模块方法介绍" class="header-anchor">#</a> Thread模块方法介绍</h2> <h3 id="启动进程-start"><a href="#启动进程-start" class="header-anchor">#</a> 启动进程 - .start()</h3> <p>启动进程，并调用该子进程中的p.run()</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
执行结果：
<span class="token number">1</span>
</code></pre></div><p>**注意：**启动进程的时候要加上if <strong>name</strong> == '<strong>main</strong>':，为什么要加呢，因为开启进程，Python解释器需要你要当前执行文件开启，如果判断你是否在当前文件执行开启，还是用自定义模块开启，所以就需要加上if <strong>name</strong> == '<strong>main</strong>':</p> <h3 id="启动进程-run"><a href="#启动进程-run" class="header-anchor">#</a> 启动进程 - .run()</h3> <p>进程启动时运行的方法，正是它去调用target指定的函数，我们自定义类的类中一定要实现该方法</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
执行结果：
<span class="token number">1</span>
</code></pre></div><h3 id="强制终止进程-terminate"><a href="#强制终止进程-terminate" class="header-anchor">#</a> 强制终止进程 - .terminate()</h3> <p>强制终止进程，不会进行任何清理操作，如果创建了子进程，该子进程就成了僵尸进程，使用该方法需要特别小心这种情况。如果还保存了一个锁那么也将不会被释放，进而导致死锁</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>使用了time模块的停止方法，让子进程暂时保留，让terminate()去结束这个子进程</p> <h3 id="检查子进程是否存活-is-alive"><a href="#检查子进程是否存活-is-alive" class="header-anchor">#</a> 检查子进程是否存活 - .is_alive()</h3> <p>如果子进程仍然运行，返回True</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
执行结果：
<span class="token boolean">True</span>
<span class="token number">1</span>
</code></pre></div><h3 id="等待子进程执行完毕-join"><a href="#等待子进程执行完毕-join" class="header-anchor">#</a> 等待子进程执行完毕 - .join()</h3> <p>主进程等待终止（强调：是主进程处于等的状态，而子进程是处于运行的状态）。timeout是可选的超时时间，需要强调的是，<strong>.join只能join住start开启的进程，而不能join住run开启的进程</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    
执行结果：
<span class="token number">1</span>
<span class="token number">2</span>
</code></pre></div><h3 id="主进程作为子进程的守护进程-daemon"><a href="#主进程作为子进程的守护进程-daemon" class="header-anchor">#</a> 主进程作为子进程的守护进程 .daemon()</h3> <p>默认值为False，如果设为True，代表子进程为后台运行的守护进程，当子进程的父进程终止时，子进程也随之终止，并且设定为True后，子进程不能创建自己的新进程，必须在.start()之前设置</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="设置并查看子进程的名称-name"><a href="#设置并查看子进程的名称-name" class="header-anchor">#</a> 设置并查看子进程的名称 - .name</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span>   <span class="token comment">## 设置子进程名称</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment">## 查看子进程名称</span>
    
执行结果：
name
<span class="token number">1</span>
</code></pre></div><h3 id="查看子进程的pid-pid"><a href="#查看子进程的pid-pid" class="header-anchor">#</a> 查看子进程的PID - .pid()</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">so</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>so<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
    
执行结果：
<span class="token number">17332</span>
<span class="token number">1</span>
</code></pre></div><h3 id="不常用的方法"><a href="#不常用的方法" class="header-anchor">#</a> 不常用的方法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">.</span>exitcode   
<span class="token comment">## 进程在运行时为None、如果为–N，表示被信号N结束(了解即可)</span>

<span class="token punctuation">.</span>authkey  
<span class="token comment">##进程的身份验证键,默认是由os.urandom()随机生成的32字符的字符串。这个键的用途是为涉及网络连接的底层进程间通信提供安全性，这类连接只有在具有相同的身份验证键时才能成功（了解即可）</span>
</code></pre></div><h2 id="thread模块创建线程"><a href="#thread模块创建线程" class="header-anchor">#</a> Thread模块创建线程</h2> <h3 id="常规版"><a href="#常规版" class="header-anchor">#</a> 常规版</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;看什么看&quot;</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>a<span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;我就看你，咋地&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="类版"><a href="#类版" class="header-anchor">#</a> 类版</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">class</span> <span class="token class-name">a</span><span class="token punctuation">(</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;看什么看&quot;</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> a<span class="token punctuation">(</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;我就看你，咋地&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="实验-进程跟线程的效率对比"><a href="#实验-进程跟线程的效率对比" class="header-anchor">#</a> 实验 - 进程跟线程的效率对比</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开100个进程的时间:'</span><span class="token punctuation">,</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span>

    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开100个线程的时间:'</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span>
    
执行结果：
开<span class="token number">100</span>个进程的时间<span class="token punctuation">:</span> <span class="token number">9.228498935699463</span>
开<span class="token number">100</span>个线程的时间<span class="token punctuation">:</span> <span class="token number">0.337414026260376</span>
    
<span class="token comment">## 效率对比，线程完胜进程</span>
<span class="token comment">## cpu切换进程要比cpu切换线程 慢很多</span>
<span class="token comment">## 在python中，如果IO操作过多的话，使用多线程最好了</span>
<span class="token comment">## 使用TCP协议也是属于IO操作的一种</span>
</code></pre></div><h2 id="实验-进程跟线程的pid对比"><a href="#实验-进程跟线程的pid对比" class="header-anchor">#</a> 实验 - 进程跟线程的PID对比</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time<span class="token punctuation">,</span>os
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'我是一个%s，我的pid是%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'我是main，我的pid是%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'进程'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'线程'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
执行结果：
我是main，我的pid是<span class="token number">9284</span>
我是一个线程，我的pid是<span class="token number">9284</span>
我是一个线程，我的pid是<span class="token number">9284</span>
我是一个进程，我的pid是<span class="token number">5972</span>
我是一个进程，我的pid是<span class="token number">9032</span>


<span class="token comment">## 在同一个进程内，所有线程共享这个进程的pid，也就是说所有线程共享所属进程的所有资源和内存地址</span>
</code></pre></div><h2 id="实验-线程的共享数据问题"><a href="#实验-线程的共享数据问题" class="header-anchor">#</a> 实验 - 线程的共享数据问题</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span>Lock
<span class="token keyword">import</span> time<span class="token punctuation">,</span>os
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> num
    tmp <span class="token operator">=</span> num
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">)</span>
    num <span class="token operator">=</span> tmp <span class="token operator">-</span> <span class="token number">1</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token number">100</span>
    t_l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    <span class="token comment"># time.sleep(1)</span>
    <span class="token punctuation">[</span>t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> t <span class="token keyword">in</span> t_l<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    
执行结果：
<span class="token comment"># 执行的结果每次都在变化 </span>

<span class="token comment">## 在同一个进程内，所有线程共享该进程中的全局变量，但是线程之间不能共享</span>
<span class="token comment">## 因为GIL限制在同个时间片中只能运行一个线程，线程是无法做到并行的效果的</span>
<span class="token comment">## 因为有了GIL数据如果没有进行加锁之类的操作，可能会产生数据混乱的情况</span>
<span class="token comment">## 因为有GIL锁的存在，在Cpython中，没有真正的线程并行。但是有真正的多进程并行</span>
<span class="token comment">## 当你的任务是计算密集的情况下，使用多进程好</span>
<span class="token comment">## 总结：在CPython中，IO密集用多线程，计算密集用多进程</span>
</code></pre></div><h2 id="实验-线程的守护进程"><a href="#实验-线程的守护进程" class="header-anchor">#</a> 实验 - 线程的守护进程</h2> <p><strong>注意：线程的守护进程，是要等所属进程完全结束，并不是代码执行结果，线程才会退出</strong></p> <p>进程的守护进程，是主进程的代码执行完毕后，立即退出</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>

t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">)</span>
t<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 守护线程是根据主线程执行结束才结束</span>
<span class="token comment"># 守护线程不是根据主线程的代码执行结束而结束</span>
<span class="token comment"># 主线程会等待普通线程执行结束，再结束</span>
<span class="token comment"># 守护线程会等待主线程结束，再结束</span>
<span class="token comment"># 所以，一般把不重要的事情设置为守护线程</span>
<span class="token comment"># 守护进程是根据主进程的代码执行完毕，守护进程就结束</span>

<span class="token comment"># 对主进程来说，运行完毕指的是主进程代码运行完毕</span>
<span class="token comment"># 对主线程来说，运行完毕指的是主线程所在的进程内所有非守护线程统统运行完毕，主线程才算运行完毕</span>

<span class="token comment"># 主进程在其代码结束后就已经算运行完毕了（守护进程在此时就被回收）,然后主进程会一直等非守护的子进程都运行完毕后回收子进程的资源(否则会产生僵尸进程)，才会结束，</span>
<span class="token comment"># 主线程在其他非守护线程运行完毕后才算运行完毕（守护线程在此时就被回收）。因为主线程的结束意味着进程的结束，进程整体的资源都将被回收，而进程必须保证非守护线程都运行完毕后才能结束。</span>


<span class="token comment"># 守护进程是随着父进程的代码执行结束而结束</span>
<span class="token comment"># 守护线程不是随着父线程的代码执行结束而结束</span>
<span class="token comment"># 守护线程是随着父线程的执行结束而结束</span>
</code></pre></div><h2 id="实验-多线程的socket聊天"><a href="#实验-多线程的socket聊天" class="header-anchor">#</a> 实验 -  多线程的socket聊天</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">## 服务端</span>
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> socket

sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
sk<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sk<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        info <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
        conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>info<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        conn<span class="token punctuation">,</span>addr <span class="token operator">=</span> sk<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">## 客户端</span>
<span class="token keyword">import</span> socket


sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
sk<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    msg_s <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;'</span><span class="token punctuation">)</span>
    sk<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg_s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sk<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="threading-lock互斥锁模块"><a href="#threading-lock互斥锁模块" class="header-anchor">#</a> Threading.Lock互斥锁模块</h1> <p>互斥锁：一把钥匙配一把锁</p> <h2 id="lock模块的功能介绍"><a href="#lock模块的功能介绍" class="header-anchor">#</a> Lock模块的功能介绍</h2> <p>Lock模块的功能就只有二个，一个是解锁，一个是锁上</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Lock
lc <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 实例化Lock类，不用加参数</span>
lc<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 锁上，把以下的资源全部锁上，不让其他进程操作，除非解锁了</span>
lc<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 解锁，把以上的资源释放了，可以让其他进程进行操作</span>
</code></pre></div><h2 id="锁的用处"><a href="#锁的用处" class="header-anchor">#</a> 锁的用处</h2> <p>当多个进程使用同一份数据资源的时候，就会引发数据安全或顺序混乱问题，</p> <p>可以使用加锁的形式确保了程序的顺序执行，但是执行又变成了串行，降低了效率，但是不得不说，它确保了数据的安全性。</p> <p>让一份数据资源，保证只有一个进程进行操作，这样才不会出现数据混乱的现象</p> <h2 id="lock模块的简单使用"><a href="#lock模块的简单使用" class="header-anchor">#</a> Lock模块的简单使用</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Lock

l <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 一把钥匙配一把锁</span>
l<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
l<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 程序会阻塞住   陷入死锁了</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>

<span class="token comment">## 这里实现了，但是程序因为拿了钥匙没还，现在遇到另一把锁，就无法获取到钥匙，进入了死锁状态</span>
</code></pre></div><h2 id="实验-死锁的模块"><a href="#实验-死锁的模块" class="header-anchor">#</a> 实验 - 死锁的模块</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span>Lock
<span class="token keyword">import</span> time<span class="token punctuation">,</span>os

<span class="token keyword">def</span> <span class="token function">man</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l_tot<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 是男的获得厕所资源，把厕所锁上了</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小年在厕所上厕所'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    l_pap<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 男的拿纸资源</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小年拿到卫生纸了！'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小年完事了!'</span><span class="token punctuation">)</span>
    l_pap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 男的先还纸</span>
    l_tot<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 男的还厕所</span>

<span class="token keyword">def</span> <span class="token function">woman</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l_pap<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 女的拿纸资源</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小雪拿到卫生纸了！'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    l_tot<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 是女的获得厕所资源，把厕所锁上了</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小雪在厕所上厕所'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小雪完事了!'</span><span class="token punctuation">)</span>
    l_tot<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 女的还厕所</span>
    l_pap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 女的先还纸</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    l_tot <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
    l_pap <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t_man <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>man<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">)</span>
    t_woman <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>woman<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">)</span>
    t_man<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t_woman<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token comment">## 实例化出二个锁跟二个钥匙，分别锁到厕所跟卫生纸中，钥匙也放进去，现在同时有二个人，一男一女，男的先去了厕所，就拿走了厕所的资源，等于拿走了厕所的钥匙，并把厕所锁上了，别一个女的，先去了卫生纸，获取了卫生纸的资源，拿走了钥匙并锁上了，这时女的就在等男的上完厕所，过会，男的上完了，在找卫生纸，但是卫生纸的钥匙在女的手里，所以他得不到卫生纸，没卫生纸擦屁股，谁敢出去，所以男的就一直等，等到可以获取卫生纸的钥匙，</span>
<span class="token comment">## 男的等卫生纸的资源 ，女的等厕所资源，所以进入了死锁状态</span>
</code></pre></div><p><strong>注意：使用互斥锁是不能解决死锁的问题，但是可以使用以下的模块，递归锁模块来解决死锁的问题</strong></p> <h1 id="threading-rlock递归锁模块"><a href="#threading-rlock递归锁模块" class="header-anchor">#</a> Threading.RLock递归锁模块</h1> <p>递归锁：可以有无止尽的锁，但是会有一把万能钥匙，这把钥匙可以开所有的锁</p> <h2 id="rlock模块的功能介绍"><a href="#rlock模块的功能介绍" class="header-anchor">#</a> RLock模块的功能介绍</h2> <p>RLock模块的功能就只有二个，一个是锁，一个是钥匙，锁可以无限的上，钥匙是万能钥匙，能开所有的锁</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> RLock
rc <span class="token operator">=</span> RLock<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 实例化Lock类，不用加参数</span>
rc<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 锁上，把以下的资源全部锁上，不让其他进程操作，除非解锁了</span>
rc<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 解锁，把以上的资源释放了，可以让其他进程进行操作</span>
</code></pre></div><h2 id="rlcok模块的简单使用"><a href="#rlcok模块的简单使用" class="header-anchor">#</a> RLcok模块的简单使用</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> RLock

s <span class="token operator">=</span> RLock<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>

执行结果：
<span class="token number">123</span>

<span class="token comment">## 只要是同一个实例化对象，那么锁对于有钥匙的对象来说，都是虚无的，都可以开</span>
</code></pre></div><h2 id="实验-解决死锁"><a href="#实验-解决死锁" class="header-anchor">#</a> 实验 - 解决死锁</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span>RLock
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">man</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l_tot<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 是男的获得厕所资源，把厕所锁上了</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小年在厕所上厕所'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    l_pap<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 男的拿纸资源</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小年拿到卫生纸了！'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小年完事了!'</span><span class="token punctuation">)</span>
    l_pap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 男的先还纸</span>
    l_tot<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 男的还厕所</span>

<span class="token keyword">def</span> <span class="token function">woman</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l_pap<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 女的拿纸资源</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小雪拿到卫生纸了！'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    l_tot<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 是女的获得厕所资源，把厕所锁上了</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小雪在厕所上厕所'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'小雪完事了!'</span><span class="token punctuation">)</span>
    l_tot<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 女的还厕所</span>
    l_pap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 女的先还纸</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    l_tot <span class="token operator">=</span> l_pap <span class="token operator">=</span> RLock<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t_man <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>man<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">)</span>
    t_woman <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>woman<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>l_tot<span class="token punctuation">,</span>l_pap<span class="token punctuation">)</span><span class="token punctuation">)</span>
    t_man<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t_woman<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 实例化出一把万能锁跟无限的锁，把厕所跟卫生纸的资源全锁上，男的跟女的，就要看谁先到，因为钥匙只有一把，但是这把钥匙能解开所有的锁，就是说，这把钥匙可以解开厕所跟卫生纸的锁并获取他们的资源</span>
<span class="token comment"># 这样就不会进入死锁状态</span>

<span class="token comment"># RLock是递归锁 --- 是无止尽的锁，但是所有锁都有一个共同的钥匙</span>
<span class="token comment"># 想解决死锁，配一把公共的钥匙就可以了。</span>
</code></pre></div><h1 id="threading-semaphorew信号量模块"><a href="#threading-semaphorew信号量模块" class="header-anchor">#</a> Threading.Semaphorew信号量模块</h1> <p>信号量则是多把钥匙配备多把锁，也就是说同时允许锁住多个数据。</p> <p>信号量同步基于内部计数器，用户初始化一个计数器初值，每调用一次acquire()，计数器减1；每调用一次release()，计数器加1。当计数器为0时，acquire()调用被阻塞。这是迪科斯彻（Dijkstra）信号量概念P()和V()的Python实现。信号量同步机制适用于访问像服务器这样的有限资源。信号量与进程池的概念很像，但是要区分开，信号量涉及到加锁的概念</p> <h2 id="semaphore模块的功能介绍"><a href="#semaphore模块的功能介绍" class="header-anchor">#</a> Semaphore模块的功能介绍</h2> <p>Semaphore模块的功能就只有二个，一个是解锁，一个是锁上，能解锁的数量是由实例化的时候控制的</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Semaphore
s <span class="token operator">=</span> Semaphore<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>   <span class="token comment">## 实例化一个对象，参数为 n ，能有几个可以解锁的，4为有4个钥匙可以解锁</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 锁上，拿走一把钥匙</span>
s<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 解锁，释放一把钥匙</span>
</code></pre></div><h2 id="semaphore模块的简单使用"><a href="#semaphore模块的简单使用" class="header-anchor">#</a> Semaphore模块的简单使用</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Semaphore
s <span class="token operator">=</span> Semaphore<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">789</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>

执行结果：
<span class="token number">123</span>
<span class="token number">456</span>
<span class="token number">789</span>

<span class="token comment">## 程序执行到789之后的s.acquire()，就会进入阻塞，等待程序释放钥匙</span>
</code></pre></div><h2 id="实验-模拟休息室"><a href="#实验-模拟休息室" class="header-anchor">#</a> 实验 - 模拟休息室</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Semaphore<span class="token punctuation">,</span>Thread
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>sem<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sem<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%s个人进入屋子'</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%s个人离开屋子'</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
    sem<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

sem <span class="token operator">=</span> Semaphore<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>sem<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token comment">## 模拟休息室，休息室最多可以供五个人休息，来了20个人，先进去五个人，剩下的只能排队在外面等，出来一个就能进去一个</span>
</code></pre></div><h1 id="threading-event事件模块"><a href="#threading-event事件模块" class="header-anchor">#</a> Threading.Event事件模块</h1> <p>python中的事件机制，主要用于主进程控制其他进程的执行</p> <ol><li>线程的一个关键特性是每个线程都是独立运行且状态不可预测。</li> <li>如果程序中的其他线程需要通过判断某个线程的状态来确定自己下一步的操作，这时线程同步问题就会变得非常棘手。为了解决这些问题,我们需要使用threading库中的Event对象。</li> <li>对象包含一个可由线程设置的信号标志,它允许线程等待某些事件的发生。默认Event对象中的信号标志被设置为假。</li> <li>如果有线程等待一个Event对象, 而这个Event对象的标志为假,那么这个线程将会被一直阻塞直至该标志为真。</li> <li>一个线程如果将一个Event对象的信号标志设置为真,它将唤醒所有等待这个Event对象的线程。</li> <li>如果一个线程等待一个已经被设置为真的Event对象,那么它将忽略这个事件, 继续执行。</li></ol> <h2 id="event模块的功能介绍"><a href="#event模块的功能介绍" class="header-anchor">#</a> Event模块的功能介绍</h2> <p>事件主要提供了三个方法 set、wait、clear</p> <p>事件处理的机制：全局定义了一个“Flag”（event.is_set()），如果“Flag”值为 False，那么当程序执行 event.wait 方法时就会阻塞，如果“Flag”值为True，那么event.wait 方法时便不再阻塞。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Event
e <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#实例化一个对象</span>
e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#将is_set()设为True</span>
e<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 将is_set()设为False</span>
e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#判断is_set的bool值，如果bool为True，则非阻塞，bool值为False，则阻塞</span>
e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 标识，查看bool值</span>

<span class="token comment"># 事件是通过is_set()的bool值，去标识e.wait() 的阻塞状态</span>
<span class="token comment"># 当is_set()的bool值为False时，e.wait()是阻塞状态</span>
<span class="token comment"># 当is_set()的bool值为True时，e.wait()是非阻塞状态</span>
<span class="token comment"># 当使用set()时，是把is_set的bool变为True</span>
<span class="token comment"># 当使用clear()时，是把is_set的bool变为False</span>
</code></pre></div><h2 id="event模块的简单使用"><a href="#event模块的简单使用" class="header-anchor">#</a> Event模块的简单使用</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Event
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># False wait应该是阻塞住</span>
e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 将is_set 的bool值变为True，将wait变为非阻塞</span>
e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

执行结果：
<span class="token boolean">False</span>
<span class="token boolean">True</span>

<span class="token comment">#################################################################################</span>

<span class="token keyword">from</span> threading <span class="token keyword">import</span> Event
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># False wait应该是阻塞住</span>
e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 将is_set 的bool值变为True，将wait变为非阻塞</span>
e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
e<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>

执行结果：
<span class="token boolean">False</span>
<span class="token boolean">True</span>
<span class="token number">123</span>
<span class="token boolean">False</span>

<span class="token comment">## 程序进行阻塞等待</span>
</code></pre></div><h2 id="实验-模拟数据库连接"><a href="#实验-模拟数据库连接" class="header-anchor">#</a> 实验 - 模拟数据库连接</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span>Event
<span class="token keyword">import</span> time
<span class="token keyword">import</span> random

<span class="token keyword">def</span> <span class="token function">conn_mysql</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># 如果为True，就是可以连接上数据库</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'连接超时'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%s个人正在尝试第%s次连接!'</span><span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>
        e<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment"># 在这里阻塞等待0.5秒，模拟用户连接时的等待</span>
        count<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%s个人连接成功'</span><span class="token operator">%</span>i<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">check_mysql</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\033[45m 数据库正在维护 \033[0m'</span><span class="token punctuation">)</span><span class="token comment"># 让数据库初始状态处于维护状态，默认所有用户连接不上</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 随机1秒或2秒，如果随机1秒的话，用户就可以连接上，2秒就连接不上</span>
    e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 将e.is_set()设为True</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    e <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>check_mysql<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># 产生10个线程都去尝试连接数据库</span>
        t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>conn_mysql<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="threading-condition条件模块"><a href="#threading-condition条件模块" class="header-anchor">#</a> Threading.Condition条件模块</h1> <p>使得线程等待，只有满足某条件时，才释放指定几个线程</p> <p>Python提供的Condition对象提供了对复杂线程同步问题的支持。</p> <p>Condition被称为条件变量，除了提供与Lock类似的acquire和release方法外，还提供了wait和notify方法。线程首先acquire一个条件变量，然后判断一些条件。如果条件不满足则wait；如果条件满足，进行一些处理改变条件后，通过notify方法通知其他线程，其他处于wait状态的线程接到通知后会重新判断条件。</p> <p>不断的重复这一过程，从而解决复杂的同步问题。</p> <h2 id="condition模块的功能介绍"><a href="#condition模块的功能介绍" class="header-anchor">#</a> Condition模块的功能介绍</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Condition
acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 锁</span>
release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 解锁</span>
<span class="token comment">## 这二个方法的底层是引用RLock递归锁</span>

wait<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">## 是指让线程阻塞住</span>
notify<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token comment">## 是指给wait发一个信号，让wait变成不阻塞</span>
	<span class="token builtin">int</span> <span class="token comment">## 是指，你要给多少给wait发信号</span>
</code></pre></div><h2 id="实例-模拟进行"><a href="#实例-模拟进行" class="header-anchor">#</a> 实例 - 模拟进行</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span>Condition
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>con<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    con<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 锁上，只有当前线程可以调用</span>
    con<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 线程执行到这里，会阻塞住，等待notify发送信号，来唤醒此线程</span>
    con<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 解锁</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%s个线程开始执行了！'</span><span class="token operator">%</span>i<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    con <span class="token operator">=</span> Condition<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>func<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>con<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        con<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 锁上</span>
        con<span class="token punctuation">.</span>notify<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token comment"># 发送一个信号给num个正在阻塞在wait的线程，让这些线程正常执行</span>
        con<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 解锁</span>
        
<span class="token comment"># 主线程和10个子线程都在抢夺递归锁的一把钥匙。</span>
<span class="token comment"># 如果主线程抢到钥匙，主线程执行while 1，input，然后notify发信号，还钥匙。但是，此时如果主线程执行特别快</span>
<span class="token comment"># 极有可能接下来主线程又会拿到钥匙，那么此时哪怕其他10个子线程的wait接收到信号，但是因为没有拿到钥匙，所以其他子线程还是不会执行</span>
</code></pre></div><h1 id="threading-timer定时器模块"><a href="#threading-timer定时器模块" class="header-anchor">#</a> Threading.Timer定时器模块</h1> <p>定时器，指定n秒后执行某个操作</p> <h2 id="timer模块的功能介绍"><a href="#timer模块的功能介绍" class="header-anchor">#</a> Timer模块的功能介绍</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Timer
Timer<span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span>func<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Timer(time,func)</span>
<span class="token comment"># time：睡眠的时间，以秒为单位</span>
<span class="token comment"># func：睡眠时间之后，需要执行的任务</span>
<span class="token comment"># .start() ：启动</span>
</code></pre></div><h2 id="timer模块的简单使用"><a href="#timer模块的简单使用" class="header-anchor">#</a> Timer模块的简单使用</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Timer
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'就是这么nb!'</span><span class="token punctuation">)</span>

Timer<span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span>func<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">## 执行时，先阻塞睡眠2.5秒，在执行</span>
</code></pre></div><h1 id="queue队列模块-同一进程内的队列"><a href="#queue队列模块-同一进程内的队列" class="header-anchor">#</a> <strong>queue队列模块 - 同一进程内的队列</strong></h1> <p>queue队列 ：使用import queue，用法与进程Queue一样</p> <p>为什么说，queue队列是同一进程内的队列，因为这模块的队列不能跨进程，就只能在当前进程中使用</p> <ol><li>比如，我在代码中使用了queue队列，但是使用了子进程，发送了子进程无法使用父进程的队列
<ol><li>进程，拥有所有的资源单位，每个进程的资源都是独立的，包含子进程跟父进程</li></ol></li> <li>但是，线程：无法拥有资源，只能依赖所属进程的资源，所以线程中使用的队列就是queue队列
<ol><li>线程，无法拥有资源，依赖所属进程的资源，可以使用所属进程的资源，但是每个线程中又是独立的个体</li></ol></li></ol> <p>queue模块目前学习三种队列</p> <ol><li>queue.Queue()：遵守先进先出规则</li> <li>queue.LifoQueue()：遵守后进先出、先进后出的规则</li> <li>queue.PriorityQueue()：遵守优先级先出的规则
<ol><li>优先级的比较（首先保证整个队列中，所有表示优先级的东西类型必须一致）
<ol><li>如果都是int，比数值的大小</li> <li>如果都是str，比较字符串的大小（从第一个字符的ASCII码开始比较）</li></ol></li></ol></li></ol> <h2 id="必看"><a href="#必看" class="header-anchor">#</a> 必看</h2> <p><strong>以下三个模块的方法跟使用都跟进程的multiprocess.Queue模块基本一样，所以这样不会写太多实验之类的了，如果有需要，可以去看一下进程的multiprocess.Queue模块，或自行百度</strong></p> <h2 id="queue-queue队列模块-先进先出"><a href="#queue-queue队列模块-先进先出" class="header-anchor">#</a> queue.Queue队列模块 - 先进先出</h2> <p><strong>跟进程的multiprocess.Queue模块基本一样，可以去考虑一下</strong></p> <h3 id="queue-queue模块的简单功能介绍"><a href="#queue-queue模块的简单功能介绍" class="header-anchor">#</a> queue.Queue模块的简单功能介绍</h3> <p>目前只介绍二个功能，一个是存，一个是取</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> queue
qe <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment">## 实例化，n：代表指定队列容量，如果不指定，默认是无限制</span>

<span class="token comment">## 取值</span>
qe<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 接收数据，从队列获取值，阻塞等待获取数据，如果有数据直接获取，如果没有数据，阻塞等待</span>
qe<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 不接收数据，从队列获取值，阻塞，如果有数据直接获取，没有数据就报错</span>

<span class="token comment">## 存值</span>
qe<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 存入数据，把数据存入在队列中，阻塞，如果可以继续往队列中放数据，就直接放，不能放就阻塞等待</span>
qe<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 存入数据，把数据存入在队列中，不阻塞，如果可以继续往队列中放数据，就直接放，不能放就报错</span>
</code></pre></div><h3 id="queue-queue模块的简单使用"><a href="#queue-queue模块的简单使用" class="header-anchor">#</a> queue.Queue模块的简单使用</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> queue
qe <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    qe<span class="token punctuation">.</span>put<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>qe<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token comment">## 循环存入1-99，循环取出1-99</span>
</code></pre></div><h2 id="queue-lifoqueue队列模块-后进先出"><a href="#queue-lifoqueue队列模块-后进先出" class="header-anchor">#</a> queue.LifoQueue队列模块 - 后进先出</h2> <p><strong>跟进程的multiprocess.Queue模块基本一样，可以去考虑一下</strong></p> <h3 id="queue-lifoqueue模块的简单功能介绍"><a href="#queue-lifoqueue模块的简单功能介绍" class="header-anchor">#</a> queue.LifoQueue模块的简单功能介绍</h3> <p>目前只介绍二个功能，一个是存，一个是取</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> queue
lq <span class="token operator">=</span> queue<span class="token punctuation">.</span>LifoQueue<span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment">## 实例化，n：代表指定队列容量，如果不指定，默认是无限制</span>

<span class="token comment">## 取值</span>
lq<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 接收数据，从队列获取值，阻塞等待获取数据，如果有数据直接获取，如果没有数据，阻塞等待</span>
lq<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 不接收数据，从队列获取值，阻塞，如果有数据直接获取，没有数据就报错</span>

<span class="token comment">## 存值</span>
lq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 存入数据，把数据存入在队列中，阻塞，如果可以继续往队列中放数据，就直接放，不能放就阻塞等待</span>
lq<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 存入数据，把数据存入在队列中，不阻塞，如果可以继续往队列中放数据，就直接放，不能放就报错</span>
</code></pre></div><h3 id="queue-lifoqueue模块的简单使用"><a href="#queue-lifoqueue模块的简单使用" class="header-anchor">#</a> queue.LifoQueue模块的简单使用</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> queue
lq <span class="token operator">=</span> queue<span class="token punctuation">.</span>LifoQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    lq<span class="token punctuation">.</span>put<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>lq<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
执行结果：
<span class="token number">4</span>
<span class="token number">3</span>
<span class="token number">2</span>
<span class="token number">1</span>
<span class="token number">0</span>
</code></pre></div><h2 id="queue-priorityqueue队列模块-优先级先出"><a href="#queue-priorityqueue队列模块-优先级先出" class="header-anchor">#</a> queue.PriorityQueue队列模块 - 优先级先出</h2> <p><strong>跟进程的multiprocess.Queue模块基本一样，可以去考虑一下</strong></p> <h3 id="queue-priorityqueue模块的简单功能介绍"><a href="#queue-priorityqueue模块的简单功能介绍" class="header-anchor">#</a> queue.PriorityQueue模块的简单功能介绍</h3> <p>目前只介绍二个功能，一个是存，一个是取</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> queue
pq <span class="token operator">=</span> queue<span class="token punctuation">.</span>PriorityQueue<span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment">## 实例化，n：代表指定队列容量，如果不指定，默认是无限制</span>

<span class="token comment">## 取值</span>
pq<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 接收数据，从队列获取值，阻塞等待获取数据，如果有数据直接获取，如果没有数据，阻塞等待</span>
pq<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 不接收数据，从队列获取值，阻塞，如果有数据直接获取，没有数据就报错</span>

<span class="token comment">## 存值</span>
pq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>优先级<span class="token punctuation">,</span>数据<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">## 存入数据，把数据存入在队列中，阻塞，如果可以继续往队列中放数据，就直接放，不能放就阻塞等待</span>
pq<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span><span class="token punctuation">(</span>优先级<span class="token punctuation">,</span>数据<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">## 存入数据，把数据存入在队列中，不阻塞，如果可以继续往队列中放数据，就直接放，不能放就报错</span>
	<span class="token comment"># 元组中第一个参数是：表示当前数据的优先级</span>
    <span class="token comment"># 元组中第二个参数是：需要存放到队列中的数据</span>
    <span class="token comment"># 优先级的比较（首先保证整个队列中，所有表示优先级的东西类型必须一致）</span>
    	<span class="token comment"># 如果都是int，比数值的大小</span>
    	<span class="token comment"># 如果都是str，比较字符串的大小（从第一个字符的ASCII码开始比较）</span>
    <span class="token comment"># 优先级队列，put()方法接收的是一个元组（），第一个位置是优先级，第二个位置是数据</span>
    <span class="token comment"># 优先级如果是数字，直接比较数值</span>
    <span class="token comment"># 如果是字符串，已字符串的第一位字符按照 ASCII 码比较的。当ASCII码相同时，会按照先进先出的原则</span>
</code></pre></div><h3 id="queue-lifoqueue模块的简单使用-2"><a href="#queue-lifoqueue模块的简单使用-2" class="header-anchor">#</a> queue.LifoQueue模块的简单使用</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> queue
pq <span class="token operator">=</span> queue<span class="token punctuation">.</span>PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;陈&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;江&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">&quot;李&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">&quot;龙&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token string">&quot;唐&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    get <span class="token operator">=</span> pq<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;优先级：%s，数据：%s&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>get<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>get<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     
执行结果：
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'江'</span><span class="token punctuation">)</span>
优先级：<span class="token number">1</span>，数据：江
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'陈'</span><span class="token punctuation">)</span>
优先级：<span class="token number">2</span>，数据：陈
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'龙'</span><span class="token punctuation">)</span>
优先级：<span class="token number">8</span>，数据：龙
<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'李'</span><span class="token punctuation">)</span>
优先级：<span class="token number">12</span>，数据：李
<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">'唐'</span><span class="token punctuation">)</span>
优先级：<span class="token number">24</span>，数据：唐

<span class="token comment"># 优先级队列，put()方法接收的是一个元组（），第一个位置是优先级，第二个位置是数据</span>
<span class="token comment"># 优先级如果是数字，直接比较数值</span>
<span class="token comment"># 如果是字符串，是按照 ASCII 码比较的。当ASCII码相同时，会按照先进先出的原则</span>
</code></pre></div><h1 id="concurrent-futures模块-进程池跟线程池"><a href="#concurrent-futures模块-进程池跟线程池" class="header-anchor">#</a> concurrent.futures模块 - 进程池跟线程池</h1> <p>Python标准库为我们提供了threading和multiprocessing模块编写相应的多线程/多进程代码，但是当项目达到一定的规模，频繁创建/销毁进程或者线程是非常消耗资源的，这个时候我们就要编写自己的线程池/进程池，以空间换时间。</p> <p>但从Python3.2开始，标准库为我们提供了concurrent.futures模块，它提供了ThreadPoolExecutor和ProcessPoolExecutor两个类，实现了对threading和multiprocessing的进一步抽象，对编写线程池/进程池提供了直接的支持。</p> <p>threading：异步模式的线程池模块</p> <p>multiprocessing：异步模块的进程池模块</p> <h2 id="concurrent-futures模块的功能介绍"><a href="#concurrent-futures模块的功能介绍" class="header-anchor">#</a> concurrent.futures模块的功能介绍</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span>ProcessPoolExecutor

ThreadPoolExecutor：线程池，只提供异步调用
ProcessPoolExecutor<span class="token punctuation">:</span> 进程池，只提供异步调用
Both implement the same interface<span class="token punctuation">,</span> which <span class="token keyword">is</span> defined by the abstract Executor <span class="token keyword">class</span><span class="token punctuation">.</span>

<span class="token comment">#基本方法</span>
submit<span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># 异步提交任务</span>
    <span class="token comment"># 比如：submit(func, i)</span>
        <span class="token comment"># fun：调用的函数</span>
        <span class="token comment"># i ：要转递给函数的参数</span>

<span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>iterables<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> chunksize<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 取代for循环submit的操作</span>
    <span class="token comment"># 是map的方式提交任务，结果是一个生成器</span>
    <span class="token comment"># 比如：map(func,range(1000))</span>

shutdown<span class="token punctuation">(</span>wait<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 相当于进程池的pool.close()+pool.join()操作</span>
    <span class="token comment"># wait=True，默认值就是True</span>
    <span class="token comment"># wait=True，等待池内所有任务执行完毕回收完资源后才继续</span>
    <span class="token comment"># wait=False，立即返回，并不会等待池内的任务执行完毕</span>
    <span class="token comment"># 但不管wait参数为何值，整个程序都会等到所有任务执行完毕</span>
    <span class="token comment"># submit和map必须在shutdown之前</span>

result<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 取得结果</span>

add_done_callback<span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment"># 回调函数 fn：代表要调用的方法</span>
</code></pre></div><h2 id="多线程使用submit-方法传递多个值"><a href="#多线程使用submit-方法传递多个值" class="header-anchor">#</a> 多线程使用submit()方法传递多个值</h2> <div class="language-python extra-class"><pre class="language-python"><code>te<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>函数<span class="token punctuation">,</span>值<span class="token punctuation">,</span>值<span class="token punctuation">)</span>
te<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>core<span class="token punctuation">.</span>server_user<span class="token punctuation">,</span>i<span class="token punctuation">,</span>logger<span class="token punctuation">)</span>
</code></pre></div><h2 id="实验-使用线程池来计算平方求和"><a href="#实验-使用线程池来计算平方求和" class="header-anchor">#</a> 实验 - 使用线程池来计算平方求和</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    su <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        su <span class="token operator">+=</span> i <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token keyword">return</span> su

te <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">## 线程池的等待线程为20个</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
te_l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    te_a <span class="token operator">=</span> te<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>a<span class="token punctuation">,</span>i<span class="token punctuation">)</span>  <span class="token comment">## 开启线程，该线程要执行完把结果返回到te_a</span>
    te_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>te_a<span class="token punctuation">)</span>   <span class="token comment">## 返回到te_a后，还要等把te_a的值写入到te_l中，之后该线程才可以接下一个任务</span>
te<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 等待线程全部执行完毕</span>
<span class="token punctuation">[</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> te_l<span class="token punctuation">]</span>  <span class="token comment">## 注意，得到的结果是一个内存地址，想要得到真正的结果要使用.result()来获取</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'消耗时间为%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>

执行结果：
<span class="token number">997002999</span>
消耗时间为<span class="token number">0.2991969585418701</span>
<span class="token comment">## 结果只取最后二行</span>
</code></pre></div><h2 id="实验-使用进程池来计算平方求和"><a href="#实验-使用进程池来计算平方求和" class="header-anchor">#</a> 实验 - 使用进程池来计算平方求和</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ProcessPoolExecutor
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    su <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        su <span class="token operator">+=</span> i <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token keyword">return</span> su

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    pe <span class="token operator">=</span> ProcessPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">## 进程池的等待线程为20个</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pe_l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pe_a <span class="token operator">=</span> pe<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>a<span class="token punctuation">,</span>i<span class="token punctuation">)</span>  <span class="token comment">## 开启进程，该线程要执行完把结果返回到te_a</span>
        pe_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pe_a<span class="token punctuation">)</span>   <span class="token comment">## 返回到te_a后，还要等把te_a的值写入到te_l中，之后该线程才可以接下一个任务</span>
    pe<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 等待进程全部执行完毕</span>
    <span class="token punctuation">[</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> pe_l<span class="token punctuation">]</span>  <span class="token comment">## 注意，得到的结果是一个内存地址，想要得到真正的结果要使用.result()来获取</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'消耗时间为%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>

执行结果：
<span class="token number">997002999</span>
消耗时间为<span class="token number">4.066568613052368</span>
<span class="token comment">## 结果只取最后二行</span>
</code></pre></div><h2 id="实验-使用线程池来计算平方求和-map方法"><a href="#实验-使用线程池来计算平方求和-map方法" class="header-anchor">#</a> 实验 - 使用线程池来计算平方求和 - map方法</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    su <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        su <span class="token operator">+=</span> i <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token keyword">return</span> su

te <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">## 线程池的等待线程为20个</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
te_a <span class="token operator">=</span> te<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">## 使用map方法来调用线程，分配1000个任务，让线程循环启动执行</span>
te<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 等待线程全部执行完毕</span>
<span class="token punctuation">[</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> te_a<span class="token punctuation">]</span>  <span class="token comment">## 生成的结果，是一个生成器，可以直接for循环取结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'消耗时间为%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>

执行结果：
<span class="token number">997002999</span>
消耗时间为<span class="token number">0.31017208099365234</span>
<span class="token comment">## 结果只取最后二行</span>
</code></pre></div><h2 id="实验-使用线程池来计算平方求和-回调函数"><a href="#实验-使用线程池来计算平方求和-回调函数" class="header-anchor">#</a> 实验 - 使用线程池来计算平方求和 - 回调函数</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    su <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        su <span class="token operator">+=</span> i <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token keyword">return</span> su

<span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span>su<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;回调函数：&quot;</span><span class="token punctuation">,</span>su<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">## 注意，得到的结果是一个内存地址，想要得到真正的结果要使用.result()来获取</span>

te <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">## 线程池的等待线程为20个</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    te<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>a<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>b<span class="token punctuation">)</span>  <span class="token comment">## 开启线程，设置返回结果给回调函数要调用的函数</span>
te<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">## 等待线程全部执行完毕</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'消耗时间为%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>

执行结果：
回调函数： <span class="token number">997002999</span>
消耗时间为<span class="token number">0.35057926177978516</span>
<span class="token comment">## 结果只取最后二行</span>


<span class="token comment"># 线程池中的回调函数是谁在调用？</span>
    <span class="token comment"># 线程池中的回调函数是子线程调用的，和父线程没有关系</span>
    <span class="token comment"># 进程池中的回调函数是父进程调用的，和子进程没有关系</span>
</code></pre></div><h2 id="实验-证明线程的回调函数是谁调用的"><a href="#实验-证明线程的回调函数是谁调用的" class="header-anchor">#</a> 实验 - 证明线程的回调函数是谁调用的</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> current_thread  <span class="token comment">## current_thread方法，查看线程对象信息，要使用这方法来证明</span>
<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token builtin">sum</span> <span class="token operator">+=</span> i
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是在子线程中'</span><span class="token punctuation">,</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">## 打印子线程的线程对象信息</span>
    <span class="token keyword">return</span> <span class="token builtin">sum</span>

<span class="token keyword">def</span> <span class="token function">call_back</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是在回调函数中'</span><span class="token punctuation">,</span><span class="token builtin">sum</span><span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">## 打印回调函数的线程对象信息</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>func<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>call_back<span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是在主线程中'</span><span class="token punctuation">,</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">## 打印主线程的线程对象信息</span>
    
执行结果：
这是在子线程中 <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>ThreadPoolExecutor<span class="token operator">-</span>0_0<span class="token punctuation">,</span> started daemon <span class="token number">15812</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
这是在回调函数中 <span class="token number">0</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>ThreadPoolExecutor<span class="token operator">-</span>0_0<span class="token punctuation">,</span> started daemon <span class="token number">15812</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
这是在主线程中 <span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">15548</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>

<span class="token comment">## 这样就可以看出来，在线程中回调函数是那个调用的</span>
<span class="token comment">## 简洁一下结果：</span>
这是在子线程中 <span class="token punctuation">(</span>ThreadPoolExecutor<span class="token operator">-</span>0_0<span class="token punctuation">,</span> started daemon <span class="token number">15812</span><span class="token punctuation">)</span>
这是在回调函数中 <span class="token punctuation">(</span>ThreadPoolExecutor<span class="token operator">-</span>0_0<span class="token punctuation">,</span> started daemon <span class="token number">15812</span><span class="token punctuation">)</span>
这是在主线程中 <span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">15548</span><span class="token punctuation">)</span>
<span class="token comment">## 这样更容易看出来</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p><strong>针对计算密集的程序来说</strong></p> <ol><li>不管是Pool的进程池还是ProcessPoolExecutor()的进程池，执行效率相当</li> <li>ThreadPoolExecutor 的效率要差很多</li> <li>所以 当计算密集时，使用多进程。</li></ol> <p><strong>不同的方式提交多个任务（for+submit  或者 map），拥有不同的拿结果的方式</strong></p> <ol><li>如果是 for+submit 的方式提交任务，拿结果用 result 方法</li> <li>如果是 map 的方式提交任务，结果是一个生成器，采用__next__()的方式去拿结果，或for循环</li></ol> <p><strong>线程池中的回调函数是谁在调用:</strong></p> <ol><li>线程池中的回调函数是子线程调用的，和父线程没有关系</li> <li>进程池中的回调函数是父进程调用的，和子进程没有关系</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Python/4. Python-network/51. 线程 - 理念知识.html" class="prev">
        51. 线程 - 理念知识
      </a></span> <span class="next"><a href="/Python/4. Python-network/53. 协程、Greenlet模块、Gevent模块.html">
        53. 协程、Greenlet模块、Gevent模块
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d65bef42.js" defer></script><script src="/assets/js/2.2249178e.js" defer></script><script src="/assets/js/118.ebb58ddb.js" defer></script>
  </body>
</html>
