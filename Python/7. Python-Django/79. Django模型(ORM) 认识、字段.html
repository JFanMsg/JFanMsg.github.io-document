<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>79. Django模型(ORM) 认识、字段 | MSG</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="在追寻技术的同时享受生活">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.d65bef42.js" as="script"><link rel="preload" href="/assets/js/2.2249178e.js" as="script"><link rel="preload" href="/assets/js/152.7f1c2792.js" as="script"><link rel="prefetch" href="/assets/js/10.4785e2e5.js"><link rel="prefetch" href="/assets/js/100.33fceff2.js"><link rel="prefetch" href="/assets/js/101.62e1e5d4.js"><link rel="prefetch" href="/assets/js/102.8551fe71.js"><link rel="prefetch" href="/assets/js/103.47754d79.js"><link rel="prefetch" href="/assets/js/104.4adf114f.js"><link rel="prefetch" href="/assets/js/105.6206a08a.js"><link rel="prefetch" href="/assets/js/106.1c4561f3.js"><link rel="prefetch" href="/assets/js/107.e1531a5a.js"><link rel="prefetch" href="/assets/js/108.c637743a.js"><link rel="prefetch" href="/assets/js/109.3f150913.js"><link rel="prefetch" href="/assets/js/11.bd8ec7a6.js"><link rel="prefetch" href="/assets/js/110.088c1ac3.js"><link rel="prefetch" href="/assets/js/111.66d8d491.js"><link rel="prefetch" href="/assets/js/112.231663ee.js"><link rel="prefetch" href="/assets/js/113.a38bc531.js"><link rel="prefetch" href="/assets/js/114.e165daea.js"><link rel="prefetch" href="/assets/js/115.994b087a.js"><link rel="prefetch" href="/assets/js/116.ea3cfdfb.js"><link rel="prefetch" href="/assets/js/117.7be5e4f3.js"><link rel="prefetch" href="/assets/js/118.ebb58ddb.js"><link rel="prefetch" href="/assets/js/119.90018646.js"><link rel="prefetch" href="/assets/js/12.0d8f43df.js"><link rel="prefetch" href="/assets/js/120.bb5be863.js"><link rel="prefetch" href="/assets/js/121.3d1db670.js"><link rel="prefetch" href="/assets/js/122.d29ed1b2.js"><link rel="prefetch" href="/assets/js/123.38cc4704.js"><link rel="prefetch" href="/assets/js/124.cc8549d4.js"><link rel="prefetch" href="/assets/js/125.6ee3e9c8.js"><link rel="prefetch" href="/assets/js/126.48710eba.js"><link rel="prefetch" href="/assets/js/127.d7a1fd83.js"><link rel="prefetch" href="/assets/js/128.e5017f6b.js"><link rel="prefetch" href="/assets/js/129.4c33e121.js"><link rel="prefetch" href="/assets/js/13.2dbde7aa.js"><link rel="prefetch" href="/assets/js/130.cda66247.js"><link rel="prefetch" href="/assets/js/131.ad76f669.js"><link rel="prefetch" href="/assets/js/132.aca88758.js"><link rel="prefetch" href="/assets/js/133.a1cf5903.js"><link rel="prefetch" href="/assets/js/134.b1386377.js"><link rel="prefetch" href="/assets/js/135.94edcf53.js"><link rel="prefetch" href="/assets/js/136.24be4170.js"><link rel="prefetch" href="/assets/js/137.db57772e.js"><link rel="prefetch" href="/assets/js/138.dc67bcaa.js"><link rel="prefetch" href="/assets/js/139.5453d1f6.js"><link rel="prefetch" href="/assets/js/14.2187dbf4.js"><link rel="prefetch" href="/assets/js/140.938e5c07.js"><link rel="prefetch" href="/assets/js/141.99c7cf2c.js"><link rel="prefetch" href="/assets/js/142.428e3958.js"><link rel="prefetch" href="/assets/js/143.68b01530.js"><link rel="prefetch" href="/assets/js/144.f67389cc.js"><link rel="prefetch" href="/assets/js/145.d952a130.js"><link rel="prefetch" href="/assets/js/146.b933dcad.js"><link rel="prefetch" href="/assets/js/147.2d8e4c0a.js"><link rel="prefetch" href="/assets/js/148.6d76ac94.js"><link rel="prefetch" href="/assets/js/149.6b4d6378.js"><link rel="prefetch" href="/assets/js/15.a53b356c.js"><link rel="prefetch" href="/assets/js/150.5bf39cb4.js"><link rel="prefetch" href="/assets/js/151.17af677c.js"><link rel="prefetch" href="/assets/js/153.98dd0727.js"><link rel="prefetch" href="/assets/js/154.eb44bf23.js"><link rel="prefetch" href="/assets/js/155.5a9840ea.js"><link rel="prefetch" href="/assets/js/156.7ba01fd0.js"><link rel="prefetch" href="/assets/js/157.2296a048.js"><link rel="prefetch" href="/assets/js/158.6bb1f699.js"><link rel="prefetch" href="/assets/js/159.073bb8df.js"><link rel="prefetch" href="/assets/js/16.cef7bf44.js"><link rel="prefetch" href="/assets/js/160.25a837f9.js"><link rel="prefetch" href="/assets/js/161.93d886a1.js"><link rel="prefetch" href="/assets/js/162.5d2714b2.js"><link rel="prefetch" href="/assets/js/17.96f36904.js"><link rel="prefetch" href="/assets/js/18.fd04b310.js"><link rel="prefetch" href="/assets/js/19.3e1377d1.js"><link rel="prefetch" href="/assets/js/20.ac195ac8.js"><link rel="prefetch" href="/assets/js/21.c2d7729c.js"><link rel="prefetch" href="/assets/js/22.dd8c621b.js"><link rel="prefetch" href="/assets/js/23.ad7d0350.js"><link rel="prefetch" href="/assets/js/24.8559c4c3.js"><link rel="prefetch" href="/assets/js/25.783a8116.js"><link rel="prefetch" href="/assets/js/26.25e0e459.js"><link rel="prefetch" href="/assets/js/27.c0616e2a.js"><link rel="prefetch" href="/assets/js/28.30656c2e.js"><link rel="prefetch" href="/assets/js/29.2be5114c.js"><link rel="prefetch" href="/assets/js/3.be8c8f3b.js"><link rel="prefetch" href="/assets/js/30.230a74a7.js"><link rel="prefetch" href="/assets/js/31.760f46ad.js"><link rel="prefetch" href="/assets/js/32.c9533fef.js"><link rel="prefetch" href="/assets/js/33.dcacfb38.js"><link rel="prefetch" href="/assets/js/34.4370a466.js"><link rel="prefetch" href="/assets/js/35.bf299eea.js"><link rel="prefetch" href="/assets/js/36.336e435a.js"><link rel="prefetch" href="/assets/js/37.1d1d2eea.js"><link rel="prefetch" href="/assets/js/38.0d58b7d0.js"><link rel="prefetch" href="/assets/js/39.d43564ba.js"><link rel="prefetch" href="/assets/js/4.4a6cb970.js"><link rel="prefetch" href="/assets/js/40.bc4e4bde.js"><link rel="prefetch" href="/assets/js/41.b71231a5.js"><link rel="prefetch" href="/assets/js/42.9d46f400.js"><link rel="prefetch" href="/assets/js/43.50c5be69.js"><link rel="prefetch" href="/assets/js/44.60406e7f.js"><link rel="prefetch" href="/assets/js/45.ec3569ae.js"><link rel="prefetch" href="/assets/js/46.1bd3ce7b.js"><link rel="prefetch" href="/assets/js/47.1e1b5326.js"><link rel="prefetch" href="/assets/js/48.64c631ea.js"><link rel="prefetch" href="/assets/js/49.b4abacd8.js"><link rel="prefetch" href="/assets/js/5.e6d0b165.js"><link rel="prefetch" href="/assets/js/50.c3e320c0.js"><link rel="prefetch" href="/assets/js/51.5ec7fb8c.js"><link rel="prefetch" href="/assets/js/52.2d234f86.js"><link rel="prefetch" href="/assets/js/53.f3b69623.js"><link rel="prefetch" href="/assets/js/54.c85ff450.js"><link rel="prefetch" href="/assets/js/55.b07597b5.js"><link rel="prefetch" href="/assets/js/56.444129cf.js"><link rel="prefetch" href="/assets/js/57.df1329ba.js"><link rel="prefetch" href="/assets/js/58.5afb51cf.js"><link rel="prefetch" href="/assets/js/59.d98936d9.js"><link rel="prefetch" href="/assets/js/6.809376cd.js"><link rel="prefetch" href="/assets/js/60.02813ecf.js"><link rel="prefetch" href="/assets/js/61.37a4812d.js"><link rel="prefetch" href="/assets/js/62.5da94048.js"><link rel="prefetch" href="/assets/js/63.8e2c2bca.js"><link rel="prefetch" href="/assets/js/64.d290398f.js"><link rel="prefetch" href="/assets/js/65.44e28313.js"><link rel="prefetch" href="/assets/js/66.9acf0206.js"><link rel="prefetch" href="/assets/js/67.85688aa2.js"><link rel="prefetch" href="/assets/js/68.45bda7fc.js"><link rel="prefetch" href="/assets/js/69.9074feb0.js"><link rel="prefetch" href="/assets/js/7.5d7bce6e.js"><link rel="prefetch" href="/assets/js/70.b4cd2ddc.js"><link rel="prefetch" href="/assets/js/71.53219b13.js"><link rel="prefetch" href="/assets/js/72.af2a7290.js"><link rel="prefetch" href="/assets/js/73.c28fc506.js"><link rel="prefetch" href="/assets/js/74.64c81a90.js"><link rel="prefetch" href="/assets/js/75.05191ece.js"><link rel="prefetch" href="/assets/js/76.f516d464.js"><link rel="prefetch" href="/assets/js/77.c345180b.js"><link rel="prefetch" href="/assets/js/78.4a09d0ba.js"><link rel="prefetch" href="/assets/js/79.65f41bcf.js"><link rel="prefetch" href="/assets/js/8.f6cfdc07.js"><link rel="prefetch" href="/assets/js/80.b77151f3.js"><link rel="prefetch" href="/assets/js/81.824fa371.js"><link rel="prefetch" href="/assets/js/82.3f91c09b.js"><link rel="prefetch" href="/assets/js/83.9539f074.js"><link rel="prefetch" href="/assets/js/84.dd89f1de.js"><link rel="prefetch" href="/assets/js/85.15210b99.js"><link rel="prefetch" href="/assets/js/86.e14553e1.js"><link rel="prefetch" href="/assets/js/87.6dc95177.js"><link rel="prefetch" href="/assets/js/88.09c5e890.js"><link rel="prefetch" href="/assets/js/89.0d61f4d0.js"><link rel="prefetch" href="/assets/js/9.759f1986.js"><link rel="prefetch" href="/assets/js/90.a9b14d80.js"><link rel="prefetch" href="/assets/js/91.1a4aabe2.js"><link rel="prefetch" href="/assets/js/92.12070bdb.js"><link rel="prefetch" href="/assets/js/93.b5dc76d0.js"><link rel="prefetch" href="/assets/js/94.690498a6.js"><link rel="prefetch" href="/assets/js/95.b17961e6.js"><link rel="prefetch" href="/assets/js/96.a2f06f3e.js"><link rel="prefetch" href="/assets/js/97.64ef6721.js"><link rel="prefetch" href="/assets/js/98.443eba26.js"><link rel="prefetch" href="/assets/js/99.b6ba7c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">MSG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python-Django</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/7.%20Python-Django/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/Python/7. Python-Django/68. request相关的属性.html" class="sidebar-link">68. request相关的属性</a></li><li><a href="/Python/7. Python-Django/69. WEB框架的本质.html" class="sidebar-link">69. WEB框架的本质</a></li><li><a href="/Python/7. Python-Django/70. Django框架、基础.html" class="sidebar-link">70. Django框架、基础</a></li><li><a href="/Python/7. Python-Django/71. Django图书馆之出版社的增删改查 - 单表.html" class="sidebar-link">71. Django图书馆之出版社的增删改查 - 单表</a></li><li><a href="/Python/7. Python-Django/72. Django图书馆之书籍的增删改查 - 多表(外键).html" class="sidebar-link">72. Django图书馆之书籍的增删改查 - 多表(外键)</a></li><li><a href="/Python/7. Python-Django/73. Django图书馆之作者的增删改查 - 多对多关系表.html" class="sidebar-link">73. Django图书馆之作者的增删改查 - 多对多关系表</a></li><li><a href="/Python/7. Python-Django/74. Django简单上传文件.html" class="sidebar-link">74. Django简单上传文件</a></li><li><a href="/Python/7. Python-Django/75. Django模板语言之变量.html" class="sidebar-link">75. Django模板语言之变量</a></li><li><a href="/Python/7. Python-Django/76. Django模板语言之逻辑.html" class="sidebar-link">76. Django模板语言之逻辑</a></li><li><a href="/Python/7. Python-Django/77. Django视图、request方法大全.html" class="sidebar-link">77. Django视图、request方法大全</a></li><li><a href="/Python/7. Python-Django/78. Django路由系统(url).html" class="sidebar-link">78. Django路由系统(url)</a></li><li><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html" class="active sidebar-link">79. Django模型(ORM) 认识、字段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm介绍" class="sidebar-link">ORM介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm概念" class="sidebar-link">ORM概念</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm由来" class="sidebar-link">ORM由来</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm的优势" class="sidebar-link">ORM的优势</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm的劣势" class="sidebar-link">ORM的劣势</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm总结" class="sidebar-link">ORM总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#django中的orm" class="sidebar-link">Django中的ORM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#model" class="sidebar-link">Model</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#orm使用数据库-基础五步曲" class="sidebar-link">ORM使用数据库 - 基础五步曲</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#快速入门" class="sidebar-link">快速入门</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#常用字段" class="sidebar-link">常用字段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#autofield-自增的整形字段" class="sidebar-link">AutoField - 自增的整形字段</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#integerfield-整数类型" class="sidebar-link">IntegerField - 整数类型</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#charfield-字符类型" class="sidebar-link">CharField - 字符类型</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#datefield-日期类型" class="sidebar-link">DateField - 日期类型</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#datetimefield-日期时间字段类型" class="sidebar-link">DatetimeField - 日期时间字段类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#其他常用字段" class="sidebar-link">其他常用字段</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#自定义字段-了解为主" class="sidebar-link">自定义字段 - （了解为主）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#自定义一个char类型字段" class="sidebar-link">自定义一个char类型字段：</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#使用自定义char类型字段" class="sidebar-link">使用自定义char类型字段：</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#创建的表结构" class="sidebar-link">创建的表结构：</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#字段常用参数" class="sidebar-link">字段常用参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#null-可为空" class="sidebar-link">null - 可为空</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#unique-唯一" class="sidebar-link">unique - 唯一</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#db-index-索引" class="sidebar-link">db_index - 索引</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#default-设置默认值" class="sidebar-link">default - 设置默认值</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#时间字段独有" class="sidebar-link">时间字段独有</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#auto-now-add-创建时把当前时间添加到行中" class="sidebar-link">autonowadd - 创建时把当前时间添加到行中</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#auto-now-更新数据记录都会按当前时间更新" class="sidebar-link">auto_now - 更新数据记录都会按当前时间更新</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#其他常用字段函数" class="sidebar-link">其他常用字段函数</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#model-meta参数" class="sidebar-link">Model Meta参数</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#字段参数" class="sidebar-link">字段参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#to" class="sidebar-link">to</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#to-field" class="sidebar-link">to_field</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#on-delete" class="sidebar-link">on_delete</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#字段参数-2" class="sidebar-link">字段参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#to-2" class="sidebar-link">to</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#to-field-2" class="sidebar-link">to_field</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#related-name" class="sidebar-link">related_name</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#related-query-name" class="sidebar-link">relatedqueryname</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#on-delete-2" class="sidebar-link">on_delete</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#db-constraint" class="sidebar-link">db_constraint</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#字段参数-3" class="sidebar-link">字段参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#to-3" class="sidebar-link">to</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#related-name-2" class="sidebar-link">related_name</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#related-query-name-2" class="sidebar-link">relatedqueryname</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#symmetrical" class="sidebar-link">symmetrical</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#through" class="sidebar-link">through</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#through-fields" class="sidebar-link">through_fields</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#db-table" class="sidebar-link">db_table</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#多对多关联关系的三种方式" class="sidebar-link">多对多关联关系的三种方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#方式一-自行创建第三张表" class="sidebar-link">方式一：自行创建第三张表</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#方式二-通过manytomanyfield自动创建第三张表" class="sidebar-link">方式二：通过ManyToManyField自动创建第三张表</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#方式三-设置manytomanyfield并指定自行创建的第三张表" class="sidebar-link">方式三：设置ManyTomanyField并指定自行创建的第三张表</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#注意事项" class="sidebar-link">注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#元信息" class="sidebar-link">元信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#db-table-2" class="sidebar-link">db_table</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#index-together" class="sidebar-link">index_together</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#unique-together" class="sidebar-link">unique_together</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html#ordering" class="sidebar-link">ordering</a></li></ul></li></ul></li><li><a href="/Python/7. Python-Django/80. Django模型(ORM) 操作、进阶.html" class="sidebar-link">80. Django模型(ORM) 操作、进阶</a></li><li><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html" class="sidebar-link">81. Django - Cookie、Session、自定义分页</a></li><li><a href="/Python/7. Python-Django/82. Django - 中间件.html" class="sidebar-link">82. Django - 中间件</a></li><li><a href="/Python/7. Python-Django/83. Django - ajax、csrf中间件补充.html" class="sidebar-link">83. Django - ajax、csrf中间件补充</a></li><li><a href="/Python/7. Python-Django/84. Django - Form、ModelForm.html" class="sidebar-link">84. Django - Form、ModelForm</a></li><li><a href="/Python/7. Python-Django/85. Django - auth认证组件.html" class="sidebar-link">85. Django - auth认证组件</a></li><li><a href="/Python/7. Python-Django/86. 权限控制.html" class="sidebar-link">86. 权限控制</a></li><li><a href="/Python/7. Python-Django/87. django小技巧.html" class="sidebar-link">87. django小技巧</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content__default"><h1 id="_79-django模型-orm-认识、字段"><a href="#_79-django模型-orm-认识、字段" class="header-anchor">#</a> 79. Django模型(ORM) 认识、字段</h1> <h1 id="object-relational-mapping-orm"><a href="#object-relational-mapping-orm" class="header-anchor">#</a> <strong>Object Relational Mapping(ORM)</strong></h1> <h2 id="orm介绍"><a href="#orm介绍" class="header-anchor">#</a> <strong>ORM介绍</strong></h2> <h3 id="orm概念"><a href="#orm概念" class="header-anchor">#</a> ORM概念</h3> <p>对象关系映射（Object Relational Mapping，简称ORM）模式是一种为了解决面向对象与关系数据库存在的互不匹配的现象的技术。</p> <p>简单的说，ORM是通过使用描述对象和数据库之间映射的元数据，将程序中的对象自动持久化到关系数据库中。</p> <p>ORM在业务逻辑层和数据库层之间充当了桥梁的作用。</p> <h3 id="orm由来"><a href="#orm由来" class="header-anchor">#</a> ORM由来</h3> <p>让我们从O/R开始。字母O起源于&quot;对象&quot;(Object)，而R则来自于&quot;关系&quot;(Relational)。</p> <p>几乎所有的软件开发过程中都会涉及到对象和关系数据库。在用户层面和业务逻辑层面，我们是面向对象的。当对象的信息发生变化的时候，我们就需要把对象的信息保存在关系数据库中。</p> <p>按照之前的方式来进行开发就会出现程序员会在自己的业务逻辑代码中夹杂很多SQL语句用来增加、读取、修改、删除相关数据，而这些代码通常都是极其相似或者重复的。</p> <h3 id="orm的优势"><a href="#orm的优势" class="header-anchor">#</a> ORM的优势</h3> <p>ORM解决的主要问题是对象和关系的映射。它通常将一个类和一张表一一对应，类的每个实例对应表中的一条记录，类的每个属性对应表中的每个字段。</p> <p>ORM提供了对数据库的映射，不用直接编写SQL代码，只需操作对象就能对数据库操作数据。</p> <p>让软件开发人员专注于业务逻辑的处理，提高了开发效率。</p> <h3 id="orm的劣势"><a href="#orm的劣势" class="header-anchor">#</a> ORM的劣势</h3> <p>ORM的缺点是会在一定程度上牺牲程序的执行效率。</p> <p>ORM的操作是有限的，也就是ORM定义好的操作是可以完成的，一些复杂的查询操作是完成不了。</p> <p>ORM用多了SQL语句就不会写了，关系数据库相关技能退化...</p> <h3 id="orm总结"><a href="#orm总结" class="header-anchor">#</a> ORM总结</h3> <p>ORM只是一种工具，工具确实能解决一些重复，简单的劳动。这是不可否认的。</p> <p>但我们不能指望某个工具能一劳永逸地解决所有问题，一些特殊问题还是需要特殊处理的。</p> <p>但是在整个软件开发过程中需要特殊处理的情况应该都是很少的，否则所谓的工具也就失去了它存在的意义。</p> <h2 id="django中的orm"><a href="#django中的orm" class="header-anchor">#</a> <strong>Django中的ORM</strong></h2> <h3 id="model"><a href="#model" class="header-anchor">#</a> Model</h3> <p>在Django中model是你数据的单一、明确的信息来源。它包含了你存储的数据的重要字段和行为。通常，一个模型（model）映射到一个数据库表。</p> <p>基本情况：</p> <ol><li>每个模型都是一个Python类，它是django.db.models.Model的子类。</li> <li>模型的每个属性都代表一个数据库字段。</li> <li>综上所述，Django为您提供了一个自动生成的数据库访问API，详询<a href="https://docs.djangoproject.com/en/1.11/topics/db/queries/" target="_blank" rel="noopener noreferrer">官方文档链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ol> <p><img src="https://s2.ax1x.com/2019/12/14/QRsmT0.png" alt="QRsmT0.png"></p> <h3 id="orm使用数据库-基础五步曲"><a href="#orm使用数据库-基础五步曲" class="header-anchor">#</a> <strong>ORM使用数据库 - 基础五步曲</strong></h3> <h4 id="_1-修改django的默认数据库模块"><a href="#_1-修改django的默认数据库模块" class="header-anchor">#</a> 1. 修改django的默认数据库模块</h4> <p>django中默认的数据库模块是mysqldb，但是这模块比较少人使用，在加上，mysqldb不支持Python3，所以我们要修改django中的默认数据库模块</p> <p>在项目中，找到主项目名的目录中的__init__文件</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pymysql
pymysql<span class="token punctuation">.</span>install_as_MySQLdb<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">## 告诉django，要使用pymysql来作为数据库模块</span>
</code></pre></div><h4 id="_2-配置数据库配置区"><a href="#_2-配置数据库配置区" class="header-anchor">#</a> 2.  配置数据库配置区</h4> <p>找到settings.py文件，在里面有个数据库配置区，默认是使用自带的db.sqlite3数据库文件</p> <div class="language-python extra-class"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>  <span class="token comment"># 连接数据库的类型</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'project'</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库名</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'192.168.0.73'</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库主机地址</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库的端口</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token comment"># 用户名</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span> <span class="token comment"># 密码，如果为空，也要写上 空字符串</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-创建表"><a href="#_3-创建表" class="header-anchor">#</a> 3. 创建表</h4> <p>在django中使用orm，需要在子项目中的models.py的文件中创建类</p> <p>在ORM中</p> <ol><li>类 == 数据表</li> <li>属性 == 字段</li> <li>对象 == 数据行</li></ol> <p>在django中，用于orm的类，必须继承models.Model</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># -&gt; 创建一个自增的ID列作为主键</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>  <span class="token comment"># -&gt; varchar(32)</span>
    pwd <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>  <span class="token comment"># -&gt; varchar(32)</span>
</code></pre></div><h4 id="_4-生成记录跟提交修改"><a href="#_4-生成记录跟提交修改" class="header-anchor">#</a> 4. 生成记录跟提交修改</h4> <p>写在models.py文件中，如果有关数据库操作的，比如，添加表、增加行、删除行、修改行等，都需要执行以下的步骤，让需要变更的操作，先记录在子项目的migrations目录中，在进行提交更改</p> <p>生成记录命令：python3 manage.py makemigrations</p> <p>提交变更记录修改命令：python3 manage.py migrate</p> <p><strong>错误</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">## No changes detected</span>
<span class="token comment">## 如果遇到以上的错误，本人的解决方案：检查你的子项目有没有添加在主项目包的配置文件中</span>
</code></pre></div><h4 id="_5-简单使用"><a href="#_5-简单使用" class="header-anchor">#</a> 5. 简单使用</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> app_admin<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
ret <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>user<span class="token operator">=</span>user<span class="token punctuation">,</span> pwd<span class="token operator">=</span>pwd<span class="token punctuation">)</span>  <span class="token comment">## 查询</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>

执行结果：
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token comment">## 查询没有</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>User<span class="token punctuation">:</span> User <span class="token builtin">object</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>  <span class="token comment">## 查询有值</span>

<span class="token comment">## 查询返回的是一个列表，要是查询有值，那么就会返回一个带对象的列表，要是查询没有，那么就会返回空列表</span>
</code></pre></div><h4 id="注意-数据库迁移的时候出现一个警告"><a href="#注意-数据库迁移的时候出现一个警告" class="header-anchor">#</a> 注意：数据库迁移的时候出现一个警告</h4> <div class="language-python extra-class"><pre class="language-python"><code>WARNINGS<span class="token punctuation">:</span> 
?<span class="token punctuation">:</span> <span class="token punctuation">(</span>mysql<span class="token punctuation">.</span>W002<span class="token punctuation">)</span> MySQL Strict Mode <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token builtin">set</span> <span class="token keyword">for</span> database connection <span class="token string">'default'</span>
HINT<span class="token punctuation">:</span> MySQL's Strict Mode fixes many data integrity problems <span class="token keyword">in</span> MySQL<span class="token punctuation">,</span> such <span class="token keyword">as</span> data truncation upon insertion<span class="token punctuation">,</span> by escalating warnings into errors<span class="token punctuation">.</span> It <span class="token keyword">is</span> strongly recommended you activate it<span class="token punctuation">.</span>
</code></pre></div><p>在配置中多加一个OPTIONS参数：<a href="https://docs.djangoproject.com/en/1.11/ref/databases/#setting-sql-mode" target="_blank" rel="noopener noreferrer">Django官网解释<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'init_command'</span><span class="token punctuation">:</span> <span class="token string">&quot;SET sql_mode='STRICT_TRANS_TABLES'&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="快速入门"><a href="#快速入门" class="header-anchor">#</a> <strong>快速入门</strong></h3> <p>下面这个例子定义了一个 <strong>Person</strong> 模型，包含 <strong>first_name</strong> 和 <strong>last_name</strong>。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
 
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    first_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    last_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>first_name</strong> 和 <strong>last_name</strong> 是模型的字段。每个字段被指定为一个类属性，每个属性映射到一个数据库列。</p> <p>上面的 <strong>Person</strong> 模型将会像这样创建一个数据库表：</p> <div class="language-mysql extra-class"><pre class="language-text"><code>CREATE TABLE myapp_person (
    &quot;id&quot; serial NOT NULL PRIMARY KEY,
    &quot;first_name&quot; varchar(30) NOT NULL,
    &quot;last_name&quot; varchar(30) NOT NULL
);
</code></pre></div><h4 id="orm类中属性说明"><a href="#orm类中属性说明" class="header-anchor">#</a> ORM类中属性说明：</h4> <ol><li>表myapp_person的名称是自动生成的，如果你要自定义表名，需要在model的Meta类中指定 db_table 参数，强烈建议使用小写表名，特别是使用MySQL作为数据库时。</li> <li>id字段是自动添加的，如果你想要指定自定义主键，只需在其中一个字段中指定 primary_key=True 即可。如果Django发现你已经明确地设置了Field.primary_key，它将不会添加自动ID列。</li> <li>本示例中的CREATE TABLE SQL使用PostgreSQL语法进行格式化，但值得注意的是，Django会根据配置文件中指定的数据库类型来生成相应的SQL语句。</li> <li>Django支持MySQL5.5及更高版本。</li></ol> <h1 id="django-orm-常用字段和参数"><a href="#django-orm-常用字段和参数" class="header-anchor">#</a> <strong>Django ORM 常用字段和参数</strong></h1> <h2 id="常用字段"><a href="#常用字段" class="header-anchor">#</a> <strong>常用字段</strong></h2> <h3 id="autofield-自增的整形字段"><a href="#autofield-自增的整形字段" class="header-anchor">#</a> AutoField - 自增的整形字段</h3> <p>自增的整形字段，必填参数primary_key=True，则成为数据库的主键。无该字段时，django自动创建。</p> <p>一个model不能有两个AutoField字段。</p> <h3 id="integerfield-整数类型"><a href="#integerfield-整数类型" class="header-anchor">#</a> IntegerField - 整数类型</h3> <p>一个整数类型。数值的范围是 -2147483648 ~ 2147483647。</p> <h3 id="charfield-字符类型"><a href="#charfield-字符类型" class="header-anchor">#</a> CharField - 字符类型</h3> <p>字符类型，必须提供max_length参数。max_length表示字符的长度。</p> <h3 id="datefield-日期类型"><a href="#datefield-日期类型" class="header-anchor">#</a> DateField - 日期类型</h3> <p>日期类型，日期格式为YYYY-MM-DD，相当于Python中的datetime.date的实例。</p> <p>参数：</p> <ol><li>auto_now：每次修改时修改为当前日期时间。</li> <li>auto_now_add：新创建对象时自动添加当前日期时间。</li></ol> <p>auto_now和auto_now_add和default参数是互斥的，不能同时设置。</p> <h3 id="datetimefield-日期时间字段类型"><a href="#datetimefield-日期时间字段类型" class="header-anchor">#</a> DatetimeField - 日期时间字段类型</h3> <p>日期时间字段，格式为YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]，相当于Python中的datetime.datetime的实例。</p> <p>字段类型，详情可点击查询<a href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#field-types" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="其他常用字段"><a href="#其他常用字段" class="header-anchor">#</a> <strong>其他常用字段</strong></h2> <div class="language-python extra-class"><pre class="language-python"><code>    AutoField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> <span class="token builtin">int</span>自增列，必须填入参数 primary_key<span class="token operator">=</span><span class="token boolean">True</span>

    BigAutoField<span class="token punctuation">(</span>AutoField<span class="token punctuation">)</span>
        <span class="token operator">-</span> bigint自增列，必须填入参数 primary_key<span class="token operator">=</span><span class="token boolean">True</span>

        注：当model中如果没有自增列，则自动会创建一个列名为<span class="token builtin">id</span>的列
        <span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

        <span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 自动创建一个列名为id的且为自增的整数列</span>
            username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

        <span class="token keyword">class</span> <span class="token class-name">Group</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 自定义自增列</span>
            nid <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

    SmallIntegerField<span class="token punctuation">(</span>IntegerField<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token operator">-</span> 小整数 <span class="token operator">-</span><span class="token number">32768</span> ～ <span class="token number">32767</span>

    PositiveSmallIntegerField<span class="token punctuation">(</span>PositiveIntegerRelDbTypeMixin<span class="token punctuation">,</span> IntegerField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 正小整数 <span class="token number">0</span> ～ <span class="token number">32767</span>

    IntegerField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 整数列<span class="token punctuation">(</span>有符号的<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">2147483648</span> ～ <span class="token number">2147483647</span>

    PositiveIntegerField<span class="token punctuation">(</span>PositiveIntegerRelDbTypeMixin<span class="token punctuation">,</span> IntegerField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 正整数 <span class="token number">0</span> ～ <span class="token number">2147483647</span>

    BigIntegerField<span class="token punctuation">(</span>IntegerField<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token operator">-</span> 长整型<span class="token punctuation">(</span>有符号的<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">9223372036854775808</span> ～ <span class="token number">9223372036854775807</span>

    BooleanField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 布尔值类型

    NullBooleanField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token operator">-</span> 可以为空的布尔值

    CharField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符类型
        <span class="token operator">-</span> 必须提供max_length参数， max_length表示字符长度

    TextField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 文本类型

    EmailField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>：
        <span class="token operator">-</span> 字符串类型，Django Admin以及ModelForm中提供验证机制

    IPAddressField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制

    GenericIPAddressField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6
        <span class="token operator">-</span> 参数：
            protocol，用于指定Ipv4或Ipv6， <span class="token string">'both'</span><span class="token punctuation">,</span><span class="token string">&quot;ipv4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ipv6&quot;</span>
            unpack_ipv4， 如果指定为<span class="token boolean">True</span>，则输入<span class="token punctuation">:</span><span class="token punctuation">:</span>ffff<span class="token punctuation">:</span><span class="token number">192.0</span><span class="token number">.2</span><span class="token number">.1</span>时候，可解析为<span class="token number">192.0</span><span class="token number">.2</span><span class="token number">.1</span>，开启此功能，需要protocol<span class="token operator">=</span><span class="token string">&quot;both&quot;</span>

    URLField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串类型，Django Admin以及ModelForm中提供验证 URL

    SlugField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）

    CommaSeparatedIntegerField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串类型，格式必须为逗号分割的数字

    UUIDField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证

    FilePathField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能
        <span class="token operator">-</span> 参数：
                path<span class="token punctuation">,</span>                      文件夹路径
                match<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                正则匹配
                recursive<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>           递归下面的文件夹
                allow_files<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>          允许文件
                allow_folders<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>       允许文件夹

    FileField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串，路径保存在数据库，文件上传到指定目录
        <span class="token operator">-</span> 参数：
            upload_to <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>      上传文件的保存路径
            storage <span class="token operator">=</span> <span class="token boolean">None</span>      存储组件，默认django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>files<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>FileSystemStorage

    ImageField<span class="token punctuation">(</span>FileField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 字符串，路径保存在数据库，文件上传到指定目录
        <span class="token operator">-</span> 参数：
            upload_to <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>      上传文件的保存路径
            storage <span class="token operator">=</span> <span class="token boolean">None</span>      存储组件，默认django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>files<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>FileSystemStorage
            width_field<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>   上传图片的高度保存的数据库字段名（字符串）
            height_field<span class="token operator">=</span><span class="token boolean">None</span>   上传图片的宽度保存的数据库字段名（字符串）

    DateTimeField<span class="token punctuation">(</span>DateField<span class="token punctuation">)</span>
        <span class="token operator">-</span> 日期<span class="token operator">+</span>时间格式 YYYY<span class="token operator">-</span>MM<span class="token operator">-</span>DD HH<span class="token punctuation">:</span>MM<span class="token punctuation">[</span><span class="token punctuation">:</span>ss<span class="token punctuation">[</span><span class="token punctuation">.</span>uuuuuu<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>TZ<span class="token punctuation">]</span>

    DateField<span class="token punctuation">(</span>DateTimeCheckMixin<span class="token punctuation">,</span> Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 日期格式      YYYY<span class="token operator">-</span>MM<span class="token operator">-</span>DD

    TimeField<span class="token punctuation">(</span>DateTimeCheckMixin<span class="token punctuation">,</span> Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 时间格式      HH<span class="token punctuation">:</span>MM<span class="token punctuation">[</span><span class="token punctuation">:</span>ss<span class="token punctuation">[</span><span class="token punctuation">.</span>uuuuuu<span class="token punctuation">]</span><span class="token punctuation">]</span>

    DurationField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime<span class="token punctuation">.</span>timedelta类型

    FloatField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 浮点型

    DecimalField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> <span class="token number">10</span>进制小数
        <span class="token operator">-</span> 参数：
            max_digits，小数总长度
            decimal_places，小数位长度

    BinaryField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
        <span class="token operator">-</span> 二进制类型
</code></pre></div><h2 id="自定义字段-了解为主"><a href="#自定义字段-了解为主" class="header-anchor">#</a> <strong>自定义字段 - （了解为主）</strong></h2> <p>自定义一个二进制字段，以及Django字段与数据库字段类型的对应关系。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UnsignedIntegerField</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">db_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'integer UNSIGNED'</span>

<span class="token comment"># PS: 返回值为字段在数据库中的属性。</span>
<span class="token comment"># Django字段与数据库字段类型对应关系如下：</span>
    <span class="token string">'AutoField'</span><span class="token punctuation">:</span> <span class="token string">'integer AUTO_INCREMENT'</span><span class="token punctuation">,</span>
    <span class="token string">'BigAutoField'</span><span class="token punctuation">:</span> <span class="token string">'bigint AUTO_INCREMENT'</span><span class="token punctuation">,</span>
    <span class="token string">'BinaryField'</span><span class="token punctuation">:</span> <span class="token string">'longblob'</span><span class="token punctuation">,</span>
    <span class="token string">'BooleanField'</span><span class="token punctuation">:</span> <span class="token string">'bool'</span><span class="token punctuation">,</span>
    <span class="token string">'CharField'</span><span class="token punctuation">:</span> <span class="token string">'varchar(%(max_length)s)'</span><span class="token punctuation">,</span>
    <span class="token string">'CommaSeparatedIntegerField'</span><span class="token punctuation">:</span> <span class="token string">'varchar(%(max_length)s)'</span><span class="token punctuation">,</span>
    <span class="token string">'DateField'</span><span class="token punctuation">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span>
    <span class="token string">'DateTimeField'</span><span class="token punctuation">:</span> <span class="token string">'datetime'</span><span class="token punctuation">,</span>
    <span class="token string">'DecimalField'</span><span class="token punctuation">:</span> <span class="token string">'numeric(%(max_digits)s, %(decimal_places)s)'</span><span class="token punctuation">,</span>
    <span class="token string">'DurationField'</span><span class="token punctuation">:</span> <span class="token string">'bigint'</span><span class="token punctuation">,</span>
    <span class="token string">'FileField'</span><span class="token punctuation">:</span> <span class="token string">'varchar(%(max_length)s)'</span><span class="token punctuation">,</span>
    <span class="token string">'FilePathField'</span><span class="token punctuation">:</span> <span class="token string">'varchar(%(max_length)s)'</span><span class="token punctuation">,</span>
    <span class="token string">'FloatField'</span><span class="token punctuation">:</span> <span class="token string">'double precision'</span><span class="token punctuation">,</span>
    <span class="token string">'IntegerField'</span><span class="token punctuation">:</span> <span class="token string">'integer'</span><span class="token punctuation">,</span>
    <span class="token string">'BigIntegerField'</span><span class="token punctuation">:</span> <span class="token string">'bigint'</span><span class="token punctuation">,</span>
    <span class="token string">'IPAddressField'</span><span class="token punctuation">:</span> <span class="token string">'char(15)'</span><span class="token punctuation">,</span>
    <span class="token string">'GenericIPAddressField'</span><span class="token punctuation">:</span> <span class="token string">'char(39)'</span><span class="token punctuation">,</span>
    <span class="token string">'NullBooleanField'</span><span class="token punctuation">:</span> <span class="token string">'bool'</span><span class="token punctuation">,</span>
    <span class="token string">'OneToOneField'</span><span class="token punctuation">:</span> <span class="token string">'integer'</span><span class="token punctuation">,</span>
    <span class="token string">'PositiveIntegerField'</span><span class="token punctuation">:</span> <span class="token string">'integer UNSIGNED'</span><span class="token punctuation">,</span>
    <span class="token string">'PositiveSmallIntegerField'</span><span class="token punctuation">:</span> <span class="token string">'smallint UNSIGNED'</span><span class="token punctuation">,</span>
    <span class="token string">'SlugField'</span><span class="token punctuation">:</span> <span class="token string">'varchar(%(max_length)s)'</span><span class="token punctuation">,</span>
    <span class="token string">'SmallIntegerField'</span><span class="token punctuation">:</span> <span class="token string">'smallint'</span><span class="token punctuation">,</span>
    <span class="token string">'TextField'</span><span class="token punctuation">:</span> <span class="token string">'longtext'</span><span class="token punctuation">,</span>
    <span class="token string">'TimeField'</span><span class="token punctuation">:</span> <span class="token string">'time'</span><span class="token punctuation">,</span>
    <span class="token string">'UUIDField'</span><span class="token punctuation">:</span> <span class="token string">'char(32)'</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="自定义一个char类型字段"><a href="#自定义一个char类型字段" class="header-anchor">#</a> 自定义一个char类型字段：</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyCharField</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Field<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    自定义的char类型的字段类
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_length<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>max_length <span class="token operator">=</span> max_length
        <span class="token builtin">super</span><span class="token punctuation">(</span>MyCharField<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>max_length<span class="token operator">=</span>max_length<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">db_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        限定生成数据库表的字段类型为char，长度为max_length指定的值
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token string">'char(%s)'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>max_length
</code></pre></div><h3 id="使用自定义char类型字段"><a href="#使用自定义char类型字段" class="header-anchor">#</a> 使用自定义char类型字段：</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Class</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token comment"># 使用自定义的char类型的字段</span>
    cname <span class="token operator">=</span> MyCharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="创建的表结构"><a href="#创建的表结构" class="header-anchor">#</a> 创建的表结构：</h3> <p><img src="https://s2.ax1x.com/2019/12/15/QhMc6O.png" alt="QhMc6O.png"></p> <h2 id="字段常用参数"><a href="#字段常用参数" class="header-anchor">#</a> <strong>字段常用参数</strong></h2> <h3 id="null-可为空"><a href="#null-可为空" class="header-anchor">#</a> null - 可为空</h3> <p>用于表示某个字段可以为空。</p> <h3 id="unique-唯一"><a href="#unique-唯一" class="header-anchor">#</a> unique - 唯一</h3> <p>如果设置为unique=True 则该字段在此表中必须是唯一的 。</p> <h3 id="db-index-索引"><a href="#db-index-索引" class="header-anchor">#</a> db_index - 索引</h3> <p>如果db_index=True 则代表着为此字段设置数据库索引。</p> <h3 id="default-设置默认值"><a href="#default-设置默认值" class="header-anchor">#</a> default - 设置默认值</h3> <p>为该字段设置默认值。</p> <h2 id="时间字段独有"><a href="#时间字段独有" class="header-anchor">#</a> <strong>时间字段独有</strong></h2> <p>DatetimeField、DateField、TimeField这个三个时间字段，都可以设置如下属性。</p> <h3 id="auto-now-add-创建时把当前时间添加到行中"><a href="#auto-now-add-创建时把当前时间添加到行中" class="header-anchor">#</a> auto_now_add - 创建时把当前时间添加到行中</h3> <p>配置auto_now_add=True，创建数据记录的时候会把当前时间添加到数据库。</p> <h3 id="auto-now-更新数据记录都会按当前时间更新"><a href="#auto-now-更新数据记录都会按当前时间更新" class="header-anchor">#</a> auto_now - 更新数据记录都会按当前时间更新</h3> <p>配置上auto_now=True，每次更新数据记录的时候会更新该字段</p> <h2 id="其他常用字段函数"><a href="#其他常用字段函数" class="header-anchor">#</a> <strong>其他常用字段函数</strong></h2> <p>字段参数，详情可点击查看<a href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#field-options" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-python extra-class"><pre class="language-python"><code>    null                数据库中字段是否可以为空
    db_column           数据库中字段的列名
    default             数据库中字段的默认值
    primary_key         数据库中字段是否为主键
    db_index            数据库中字段是否可以建立索引
    unique              数据库中字段是否可以建立唯一索引
    unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引
    unique_for_month    数据库中字段【月】部分是否可以建立唯一索引
    unique_for_year     数据库中字段【年】部分是否可以建立唯一索引
 
    verbose_name        Admin中显示的字段名称
    blank               Admin中是否允许用户输入为空
    editable            Admin中是否可以编辑
    help_text           Admin中该字段的提示信息
    choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作
                        如：gf <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'何穗'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'大表姐'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
 
    error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；
                        字典健：null<span class="token punctuation">,</span> blank<span class="token punctuation">,</span> invalid<span class="token punctuation">,</span> invalid_choice<span class="token punctuation">,</span> unique<span class="token punctuation">,</span> <span class="token keyword">and</span> unique_for_date
                        如：<span class="token punctuation">{</span><span class="token string">'null'</span><span class="token punctuation">:</span> <span class="token string">&quot;不能为空.&quot;</span><span class="token punctuation">,</span> <span class="token string">'invalid'</span><span class="token punctuation">:</span> <span class="token string">'格式错误'</span><span class="token punctuation">}</span>
 
    validators          自定义错误验证（列表类型），从而定制想要的验证规则
                        <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> RegexValidator
                        <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> EmailValidator<span class="token punctuation">,</span>URLValidator<span class="token punctuation">,</span>DecimalValidator<span class="token punctuation">,</span>\
                        MaxLengthValidator<span class="token punctuation">,</span>MinLengthValidator<span class="token punctuation">,</span>MaxValueValidator<span class="token punctuation">,</span>MinValueValidator
                        如：
                            test <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
                                max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>
                                error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
                                    <span class="token string">'c1'</span><span class="token punctuation">:</span> <span class="token string">'优先错信息1'</span><span class="token punctuation">,</span>
                                    <span class="token string">'c2'</span><span class="token punctuation">:</span> <span class="token string">'优先错信息2'</span><span class="token punctuation">,</span>
                                    <span class="token string">'c3'</span><span class="token punctuation">:</span> <span class="token string">'优先错信息3'</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                validators<span class="token operator">=</span><span class="token punctuation">[</span>
                                    RegexValidator<span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'root_\d+'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'错误了'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'c1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    RegexValidator<span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'root_112233\d+'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'又错误了'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'c2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    EmailValidator<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">'又错误了'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'c3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
                            <span class="token punctuation">)</span>
</code></pre></div><h2 id="model-meta参数"><a href="#model-meta参数" class="header-anchor">#</a> Model Meta参数</h2> <p>这个不是很常用，如果你有特殊需要可以使用。详情点击查看<a href="https://docs.djangoproject.com/en/1.11/ref/models/options/#model-meta-options" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nid <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
 
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        <span class="token comment"># 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span>
        db_table <span class="token operator">=</span> <span class="token string">&quot;table_name&quot;</span>
 
        <span class="token comment"># admin中显示的表名称</span>
        verbose_name <span class="token operator">=</span> <span class="token string">'个人信息'</span>
 
        <span class="token comment"># verbose_name加s</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">'所有用户信息'</span>
 
        <span class="token comment"># 联合索引 </span>
        index_together <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">&quot;pub_date&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deadline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 应为两个存在的字段</span>
        <span class="token punctuation">]</span>
 
        <span class="token comment"># 联合唯一索引</span>
        unique_together <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;restaurant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>   <span class="token comment"># 应为两个存在的字段</span>
</code></pre></div><h1 id="onetoonefield-一对一字段"><a href="#onetoonefield-一对一字段" class="header-anchor">#</a> <strong>OneToOneField - 一对一字段</strong></h1> <p>一对一字段，通常一对一字段用来扩展已有字段。</p> <p>一对一的关联关系多用在当一张表的不同字段查询频次差距过大的情况下，将本可以存储在一张表的字段拆开放置在两张表中，然后将两张表建立一对一的关联关系。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'AuthorInfo'</span><span class="token punctuation">)</span>
    

<span class="token keyword">class</span> <span class="token class-name">AuthorInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="字段参数"><a href="#字段参数" class="header-anchor">#</a> <strong>字段参数</strong></h2> <h3 id="to"><a href="#to" class="header-anchor">#</a> to</h3> <p>设置要关联的表。</p> <h3 id="to-field"><a href="#to-field" class="header-anchor">#</a> to_field</h3> <p>设置要关联的字段。</p> <h3 id="on-delete"><a href="#on-delete" class="header-anchor">#</a> on_delete</h3> <p>同ForeignKey字段。</p> <h1 id="foreignkey-一对多或多对一字段-外键"><a href="#foreignkey-一对多或多对一字段-外键" class="header-anchor">#</a> <strong>ForeignKey - 一对多或多对一字段</strong> (外键)</h1> <p>外键类型在ORM中用来表示外键关联关系，一般把ForeignKey字段设置在 '一对多'中'多'的一方。</p> <p>ForeignKey可以和其他表做关联关系同时也可以和自身做关联关系。</p> <h2 id="字段参数-2"><a href="#字段参数-2" class="header-anchor">#</a> <strong>字段参数</strong></h2> <h3 id="to-2"><a href="#to-2" class="header-anchor">#</a> to</h3> <p>设置要关联的表</p> <h3 id="to-field-2"><a href="#to-field-2" class="header-anchor">#</a> to_field</h3> <p>设置要关联的表的字段</p> <h3 id="related-name"><a href="#related-name" class="header-anchor">#</a> related_name</h3> <p>反向操作时，使用的字段名，用于代替原反向查询时的'表名_set'。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Classes</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    theclass <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Classes&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>当我们要查询某个班级关联的所有学生（反向查询）时，我们会这么写：</p> <div class="language-django extra-class"><pre class="language-django"><code>models.Classes.objects.first().student_set.all()
</code></pre></div><p>当我们在ForeignKey字段中添加了参数 related_name 后，</p> <div class="language-django extra-class"><pre class="language-django"><code>class Student(models.Model):
    name = models.CharField(max_length=32)
    theclass = models.ForeignKey(to=&quot;Classes&quot;, related_name=&quot;students&quot;)
</code></pre></div><p>当我们要查询某个班级关联的所有学生（反向查询）时，我们会这么写：</p> <div class="language-django extra-class"><pre class="language-django"><code>models.Classes.objects.first().students.all()
</code></pre></div><h3 id="related-query-name"><a href="#related-query-name" class="header-anchor">#</a> related_query_name</h3> <p>反向查询操作时，使用的连接前缀，用于替换表名。</p> <h3 id="on-delete-2"><a href="#on-delete-2" class="header-anchor">#</a> on_delete</h3> <p>当删除关联表中的数据时，当前表与其关联的行的行为。</p> <ol><li><strong>models.CASCADE</strong>：删除关联数据，与之关联也删除</li> <li><strong>models.DO_NOTHING</strong>：删除关联数据，引发错误IntegrityError</li> <li><strong>models.PROTECT</strong>：删除关联数据，引发错误ProtectedError</li> <li><strong>models.SET_NULL</strong>：删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</li> <li><strong>models.SET_DEFAULT</strong>：删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）、</li> <li><strong>models.SET</strong>：删除关联数据，
<ol><li>与之关联的值设置为指定值，设置：models.SET(值)</li> <li>与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</li></ol></li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">10</span>

<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
        to<span class="token operator">=</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        to_field<span class="token operator">=</span><span class="token string">&quot;id&quot;</span>，
        on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>SET<span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><h3 id="db-constraint"><a href="#db-constraint" class="header-anchor">#</a> db_constraint</h3> <p>是否在数据库中创建外键约束，默认为True。</p> <h1 id="manytomanyfield-多对多字段"><a href="#manytomanyfield-多对多字段" class="header-anchor">#</a> <strong>ManyToManyField - 多对多字段</strong></h1> <p>用于表示多对多的关联关系。在数据库中通过第三张表来建立关联关系。</p> <h2 id="字段参数-3"><a href="#字段参数-3" class="header-anchor">#</a> <strong>字段参数</strong></h2> <h3 id="to-3"><a href="#to-3" class="header-anchor">#</a> to</h3> <p>设置要关联的表</p> <h3 id="related-name-2"><a href="#related-name-2" class="header-anchor">#</a> related_name</h3> <p>同ForeignKey字段。</p> <h3 id="related-query-name-2"><a href="#related-query-name-2" class="header-anchor">#</a> related_query_name</h3> <p>同ForeignKey字段。</p> <h3 id="symmetrical"><a href="#symmetrical" class="header-anchor">#</a> symmetrical</h3> <p>仅用于多对多自关联时，指定内部是否创建反向操作的字段。默认为True。</p> <p>举个例子：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    friends <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token string">&quot;self&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>此时，person对象就没有person_set属性。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    friends <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token string">&quot;self&quot;</span><span class="token punctuation">,</span> symmetrical<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><p>此时，person对象现在就可以使用person_set属性进行反向查询。</p> <h3 id="through"><a href="#through" class="header-anchor">#</a> through</h3> <p>在使用ManyToManyField字段时，Django将自动生成一张表来管理多对多的关联关系。</p> <p>但我们也可以手动创建第三张表来管理多对多关系，此时就需要通过through来指定第三张表的表名。</p> <h3 id="through-fields"><a href="#through-fields" class="header-anchor">#</a> through_fields</h3> <p>设置关联的字段。</p> <h3 id="db-table"><a href="#db-table" class="header-anchor">#</a> db_table</h3> <p>默认创建第三张表时，数据库中表的名称。</p> <h2 id="多对多关联关系的三种方式"><a href="#多对多关联关系的三种方式" class="header-anchor">#</a> <strong>多对多关联关系的三种方式</strong></h2> <h3 id="方式一-自行创建第三张表"><a href="#方式一-自行创建第三张表" class="header-anchor">#</a> 方式一：自行创建第三张表</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&quot;书名&quot;</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&quot;作者姓名&quot;</span><span class="token punctuation">)</span>


<span class="token comment"># 自己创建第三张表，分别通过外键关联书和作者</span>
<span class="token keyword">class</span> <span class="token class-name">Author2Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Author&quot;</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Book&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        unique_together <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="方式二-通过manytomanyfield自动创建第三张表"><a href="#方式二-通过manytomanyfield自动创建第三张表" class="header-anchor">#</a> 方式二：通过ManyToManyField自动创建第三张表</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&quot;书名&quot;</span><span class="token punctuation">)</span>


<span class="token comment"># 通过ORM自带的ManyToManyField自动创建第三张表</span>
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&quot;作者姓名&quot;</span><span class="token punctuation">)</span>
    books <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Book&quot;</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">&quot;authors&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="方式三-设置manytomanyfield并指定自行创建的第三张表"><a href="#方式三-设置manytomanyfield并指定自行创建的第三张表" class="header-anchor">#</a> 方式三：设置ManyTomanyField并指定自行创建的第三张表</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&quot;书名&quot;</span><span class="token punctuation">)</span>


<span class="token comment"># 自己创建第三张表，并通过ManyToManyField指定关联</span>
<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&quot;作者姓名&quot;</span><span class="token punctuation">)</span>
    books <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Book&quot;</span><span class="token punctuation">,</span> through<span class="token operator">=</span><span class="token string">&quot;Author2Book&quot;</span><span class="token punctuation">,</span> through_fields<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># through_fields接受一个2元组（'field1'，'field2'）：</span>
    <span class="token comment"># 其中field1是定义ManyToManyField的模型外键的名（author），field2是关联目标模型（book）的外键名。</span>


<span class="token keyword">class</span> <span class="token class-name">Author2Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Author&quot;</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Book&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        unique_together <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <p>当我们需要在第三张关系表中存储额外的字段时，就要使用第三种方式。</p> <p>但是当我们使用第三种方式创建多对多关联关系时，就无法使用set、add、remove、clear方法来管理多对多的关系了，需要通过第三张表的model来管理多对多关系。</p> <h1 id="多表关系的其他字段参数"><a href="#多表关系的其他字段参数" class="header-anchor">#</a> 多表关系的其他字段参数</h1> <div class="language-python extra-class"><pre class="language-python"><code>ForeignKey<span class="token punctuation">(</span>ForeignObject<span class="token punctuation">)</span> <span class="token comment"># ForeignObject(RelatedField)</span>
    to<span class="token punctuation">,</span>                 <span class="token comment"># 要进行关联的表名</span>
    to_field<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>      <span class="token comment"># 要关联的表中的字段名称</span>
    on_delete<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>     <span class="token comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span>
                        <span class="token operator">-</span> models<span class="token punctuation">.</span>CASCADE，删除关联数据，与之关联也删除
                        <span class="token operator">-</span> models<span class="token punctuation">.</span>DO_NOTHING，删除关联数据，引发错误IntegrityError
                        <span class="token operator">-</span> models<span class="token punctuation">.</span>PROTECT，删除关联数据，引发错误ProtectedError
                        <span class="token operator">-</span> models<span class="token punctuation">.</span>SET_NULL，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）
                        <span class="token operator">-</span> models<span class="token punctuation">.</span>SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）
                        <span class="token operator">-</span> models<span class="token punctuation">.</span>SET，删除关联数据，
                               a<span class="token punctuation">.</span> 与之关联的值设置为指定值，设置：models<span class="token punctuation">.</span>SET<span class="token punctuation">(</span>值<span class="token punctuation">)</span>
                               b<span class="token punctuation">.</span> 与之关联的值设置为可执行对象的返回值，设置：models<span class="token punctuation">.</span>SET<span class="token punctuation">(</span>可执行对象<span class="token punctuation">)</span>
 
                                    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        <span class="token keyword">return</span> <span class="token number">10</span>
 
                                    <span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
                                            to<span class="token operator">=</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
                                            to_field<span class="token operator">=</span><span class="token string">&quot;id&quot;</span>
                                            on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>SET<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    related_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>          <span class="token comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span>
    related_query_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>    <span class="token comment"># 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span>
    limit_choices_to<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>      <span class="token comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span>
                                <span class="token comment"># 如：</span>
                        <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'nid__gt'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
                        <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'nid__gt'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
 
                        <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q
                        <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span>Q<span class="token punctuation">(</span>nid__gt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span>Q<span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>nid__gt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span> Q<span class="token punctuation">(</span>Q<span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>nid__gt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Q<span class="token punctuation">(</span>caption<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">)</span>
    db_constraint<span class="token operator">=</span><span class="token boolean">True</span>          <span class="token comment"># 是否在数据库中创建外键约束</span>
    parent_link<span class="token operator">=</span><span class="token boolean">False</span>           <span class="token comment"># 在Admin中是否显示关联数据</span>
 
 
OneToOneField<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">)</span>
    to<span class="token punctuation">,</span>                 <span class="token comment"># 要进行关联的表名</span>
    to_field<span class="token operator">=</span><span class="token boolean">None</span>       <span class="token comment"># 要关联的表中的字段名称</span>
    on_delete<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>     <span class="token comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span>
 
                        <span class="token comment">###### 对于一对一 ######</span>
                        <span class="token comment"># 1. 一对一其实就是 一对多 + 唯一索引</span>
                        <span class="token comment"># 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span>
                        <span class="token comment"># 如下会在A表中额外增加一个c_ptr_id列且唯一：</span>
                                <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    nid <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                                    part <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
 
                                <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                                    code <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
 
ManyToManyField<span class="token punctuation">(</span>RelatedField<span class="token punctuation">)</span>
    to<span class="token punctuation">,</span>                         <span class="token comment"># 要进行关联的表名</span>
    related_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>          <span class="token comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span>
    related_query_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>    <span class="token comment"># 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span>
    limit_choices_to<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>      <span class="token comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span>
                                <span class="token comment"># 如：</span>
                                    <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'nid__gt'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
                                    <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'nid__gt'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
 
                                    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q
                                    <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span>Q<span class="token punctuation">(</span>nid__gt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
                                    <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span>Q<span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>nid__gt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
                                    <span class="token operator">-</span> limit_choices_to<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span> Q<span class="token punctuation">(</span>Q<span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>nid__gt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Q<span class="token punctuation">(</span>caption<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">)</span>
    symmetrical<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>           <span class="token comment"># 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span>
                                <span class="token comment"># 做如下操作时，不同的symmetrical会有不同的可选字段</span>
                                    models<span class="token punctuation">.</span>BB<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
 
                                    <span class="token comment"># 可选字段有：code, id, m1</span>
                                        <span class="token keyword">class</span> <span class="token class-name">BB</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
                                        code <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
                                        m1 <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token string">'self'</span><span class="token punctuation">,</span>symmetrical<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 
                                    <span class="token comment"># 可选字段有: bb, code, id, m1</span>
                                        <span class="token keyword">class</span> <span class="token class-name">BB</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
                                        code <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
                                        m1 <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token string">'self'</span><span class="token punctuation">,</span>symmetrical<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
 
    through<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token comment"># 自定义第三张表时，使用字段用于指定关系表</span>
    through_fields<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>        <span class="token comment"># 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span>
                                    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
 
                                    <span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
 
                                    <span class="token keyword">class</span> <span class="token class-name">Group</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span>
                                        members <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>
                                            Person<span class="token punctuation">,</span>
                                            through<span class="token operator">=</span><span class="token string">'Membership'</span><span class="token punctuation">,</span>
                                            through_fields<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'group'</span><span class="token punctuation">,</span> <span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                        <span class="token punctuation">)</span>
 
                                    <span class="token keyword">class</span> <span class="token class-name">Membership</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        group <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Group<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
                                        person <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Person<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
                                        inviter <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
                                            Person<span class="token punctuation">,</span>
                                            on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span>
                                            related_name<span class="token operator">=</span><span class="token string">&quot;membership_invites&quot;</span><span class="token punctuation">,</span>
                                        <span class="token punctuation">)</span>
                                        invite_reason <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
    db_constraint<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>         <span class="token comment"># 是否在数据库中创建外键约束</span>
    db_table<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># 默认创建第三张表时，数据库中表的名称</span>
</code></pre></div><h2 id="元信息"><a href="#元信息" class="header-anchor">#</a> <strong>元信息</strong></h2> <p>ORM对应的类里面包含另一个Meta类，而Meta类封装了一些数据库的信息。主要字段如下:</p> <h3 id="db-table-2"><a href="#db-table-2" class="header-anchor">#</a> db_table</h3> <p>ORM在数据库中的表名默认是 <strong>app_<strong>类名，可以通过</strong>db_table</strong>可以重写表名。</p> <h3 id="index-together"><a href="#index-together" class="header-anchor">#</a> index_together</h3> <p>联合索引。</p> <h3 id="unique-together"><a href="#unique-together" class="header-anchor">#</a> unique_together</h3> <p>联合唯一索引。</p> <h3 id="ordering"><a href="#ordering" class="header-anchor">#</a> ordering</h3> <p>指定默认按什么字段排序。</p> <p>只有设置了该属性，我们查询到的结果才可以被reverse()</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Python/7. Python-Django/78. Django路由系统(url).html" class="prev">
        78. Django路由系统(url)
      </a></span> <span class="next"><a href="/Python/7. Python-Django/80. Django模型(ORM) 操作、进阶.html">
        80. Django模型(ORM) 操作、进阶
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d65bef42.js" defer></script><script src="/assets/js/2.2249178e.js" defer></script><script src="/assets/js/152.7f1c2792.js" defer></script>
  </body>
</html>
