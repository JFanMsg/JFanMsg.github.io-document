<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>81. Django - Cookie、Session、自定义分页 | MSG</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="在追寻技术的同时享受生活">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.d65bef42.js" as="script"><link rel="preload" href="/assets/js/2.2249178e.js" as="script"><link rel="preload" href="/assets/js/154.eb44bf23.js" as="script"><link rel="prefetch" href="/assets/js/10.4785e2e5.js"><link rel="prefetch" href="/assets/js/100.33fceff2.js"><link rel="prefetch" href="/assets/js/101.62e1e5d4.js"><link rel="prefetch" href="/assets/js/102.8551fe71.js"><link rel="prefetch" href="/assets/js/103.47754d79.js"><link rel="prefetch" href="/assets/js/104.4adf114f.js"><link rel="prefetch" href="/assets/js/105.6206a08a.js"><link rel="prefetch" href="/assets/js/106.1c4561f3.js"><link rel="prefetch" href="/assets/js/107.e1531a5a.js"><link rel="prefetch" href="/assets/js/108.c637743a.js"><link rel="prefetch" href="/assets/js/109.3f150913.js"><link rel="prefetch" href="/assets/js/11.bd8ec7a6.js"><link rel="prefetch" href="/assets/js/110.088c1ac3.js"><link rel="prefetch" href="/assets/js/111.66d8d491.js"><link rel="prefetch" href="/assets/js/112.231663ee.js"><link rel="prefetch" href="/assets/js/113.a38bc531.js"><link rel="prefetch" href="/assets/js/114.e165daea.js"><link rel="prefetch" href="/assets/js/115.994b087a.js"><link rel="prefetch" href="/assets/js/116.ea3cfdfb.js"><link rel="prefetch" href="/assets/js/117.7be5e4f3.js"><link rel="prefetch" href="/assets/js/118.ebb58ddb.js"><link rel="prefetch" href="/assets/js/119.90018646.js"><link rel="prefetch" href="/assets/js/12.0d8f43df.js"><link rel="prefetch" href="/assets/js/120.bb5be863.js"><link rel="prefetch" href="/assets/js/121.3d1db670.js"><link rel="prefetch" href="/assets/js/122.d29ed1b2.js"><link rel="prefetch" href="/assets/js/123.38cc4704.js"><link rel="prefetch" href="/assets/js/124.cc8549d4.js"><link rel="prefetch" href="/assets/js/125.6ee3e9c8.js"><link rel="prefetch" href="/assets/js/126.48710eba.js"><link rel="prefetch" href="/assets/js/127.d7a1fd83.js"><link rel="prefetch" href="/assets/js/128.e5017f6b.js"><link rel="prefetch" href="/assets/js/129.4c33e121.js"><link rel="prefetch" href="/assets/js/13.2dbde7aa.js"><link rel="prefetch" href="/assets/js/130.cda66247.js"><link rel="prefetch" href="/assets/js/131.ad76f669.js"><link rel="prefetch" href="/assets/js/132.aca88758.js"><link rel="prefetch" href="/assets/js/133.a1cf5903.js"><link rel="prefetch" href="/assets/js/134.b1386377.js"><link rel="prefetch" href="/assets/js/135.94edcf53.js"><link rel="prefetch" href="/assets/js/136.24be4170.js"><link rel="prefetch" href="/assets/js/137.db57772e.js"><link rel="prefetch" href="/assets/js/138.dc67bcaa.js"><link rel="prefetch" href="/assets/js/139.5453d1f6.js"><link rel="prefetch" href="/assets/js/14.2187dbf4.js"><link rel="prefetch" href="/assets/js/140.938e5c07.js"><link rel="prefetch" href="/assets/js/141.99c7cf2c.js"><link rel="prefetch" href="/assets/js/142.428e3958.js"><link rel="prefetch" href="/assets/js/143.68b01530.js"><link rel="prefetch" href="/assets/js/144.f67389cc.js"><link rel="prefetch" href="/assets/js/145.d952a130.js"><link rel="prefetch" href="/assets/js/146.b933dcad.js"><link rel="prefetch" href="/assets/js/147.2d8e4c0a.js"><link rel="prefetch" href="/assets/js/148.6d76ac94.js"><link rel="prefetch" href="/assets/js/149.6b4d6378.js"><link rel="prefetch" href="/assets/js/15.a53b356c.js"><link rel="prefetch" href="/assets/js/150.5bf39cb4.js"><link rel="prefetch" href="/assets/js/151.17af677c.js"><link rel="prefetch" href="/assets/js/152.7f1c2792.js"><link rel="prefetch" href="/assets/js/153.98dd0727.js"><link rel="prefetch" href="/assets/js/155.5a9840ea.js"><link rel="prefetch" href="/assets/js/156.7ba01fd0.js"><link rel="prefetch" href="/assets/js/157.2296a048.js"><link rel="prefetch" href="/assets/js/158.6bb1f699.js"><link rel="prefetch" href="/assets/js/159.073bb8df.js"><link rel="prefetch" href="/assets/js/16.cef7bf44.js"><link rel="prefetch" href="/assets/js/160.25a837f9.js"><link rel="prefetch" href="/assets/js/161.93d886a1.js"><link rel="prefetch" href="/assets/js/162.5d2714b2.js"><link rel="prefetch" href="/assets/js/17.96f36904.js"><link rel="prefetch" href="/assets/js/18.fd04b310.js"><link rel="prefetch" href="/assets/js/19.3e1377d1.js"><link rel="prefetch" href="/assets/js/20.ac195ac8.js"><link rel="prefetch" href="/assets/js/21.c2d7729c.js"><link rel="prefetch" href="/assets/js/22.dd8c621b.js"><link rel="prefetch" href="/assets/js/23.ad7d0350.js"><link rel="prefetch" href="/assets/js/24.8559c4c3.js"><link rel="prefetch" href="/assets/js/25.783a8116.js"><link rel="prefetch" href="/assets/js/26.25e0e459.js"><link rel="prefetch" href="/assets/js/27.c0616e2a.js"><link rel="prefetch" href="/assets/js/28.30656c2e.js"><link rel="prefetch" href="/assets/js/29.2be5114c.js"><link rel="prefetch" href="/assets/js/3.be8c8f3b.js"><link rel="prefetch" href="/assets/js/30.230a74a7.js"><link rel="prefetch" href="/assets/js/31.760f46ad.js"><link rel="prefetch" href="/assets/js/32.c9533fef.js"><link rel="prefetch" href="/assets/js/33.dcacfb38.js"><link rel="prefetch" href="/assets/js/34.4370a466.js"><link rel="prefetch" href="/assets/js/35.bf299eea.js"><link rel="prefetch" href="/assets/js/36.336e435a.js"><link rel="prefetch" href="/assets/js/37.1d1d2eea.js"><link rel="prefetch" href="/assets/js/38.0d58b7d0.js"><link rel="prefetch" href="/assets/js/39.d43564ba.js"><link rel="prefetch" href="/assets/js/4.4a6cb970.js"><link rel="prefetch" href="/assets/js/40.bc4e4bde.js"><link rel="prefetch" href="/assets/js/41.b71231a5.js"><link rel="prefetch" href="/assets/js/42.9d46f400.js"><link rel="prefetch" href="/assets/js/43.50c5be69.js"><link rel="prefetch" href="/assets/js/44.60406e7f.js"><link rel="prefetch" href="/assets/js/45.ec3569ae.js"><link rel="prefetch" href="/assets/js/46.1bd3ce7b.js"><link rel="prefetch" href="/assets/js/47.1e1b5326.js"><link rel="prefetch" href="/assets/js/48.64c631ea.js"><link rel="prefetch" href="/assets/js/49.b4abacd8.js"><link rel="prefetch" href="/assets/js/5.e6d0b165.js"><link rel="prefetch" href="/assets/js/50.c3e320c0.js"><link rel="prefetch" href="/assets/js/51.5ec7fb8c.js"><link rel="prefetch" href="/assets/js/52.2d234f86.js"><link rel="prefetch" href="/assets/js/53.f3b69623.js"><link rel="prefetch" href="/assets/js/54.c85ff450.js"><link rel="prefetch" href="/assets/js/55.b07597b5.js"><link rel="prefetch" href="/assets/js/56.444129cf.js"><link rel="prefetch" href="/assets/js/57.df1329ba.js"><link rel="prefetch" href="/assets/js/58.5afb51cf.js"><link rel="prefetch" href="/assets/js/59.d98936d9.js"><link rel="prefetch" href="/assets/js/6.809376cd.js"><link rel="prefetch" href="/assets/js/60.02813ecf.js"><link rel="prefetch" href="/assets/js/61.37a4812d.js"><link rel="prefetch" href="/assets/js/62.5da94048.js"><link rel="prefetch" href="/assets/js/63.8e2c2bca.js"><link rel="prefetch" href="/assets/js/64.d290398f.js"><link rel="prefetch" href="/assets/js/65.44e28313.js"><link rel="prefetch" href="/assets/js/66.9acf0206.js"><link rel="prefetch" href="/assets/js/67.85688aa2.js"><link rel="prefetch" href="/assets/js/68.45bda7fc.js"><link rel="prefetch" href="/assets/js/69.9074feb0.js"><link rel="prefetch" href="/assets/js/7.5d7bce6e.js"><link rel="prefetch" href="/assets/js/70.b4cd2ddc.js"><link rel="prefetch" href="/assets/js/71.53219b13.js"><link rel="prefetch" href="/assets/js/72.af2a7290.js"><link rel="prefetch" href="/assets/js/73.c28fc506.js"><link rel="prefetch" href="/assets/js/74.64c81a90.js"><link rel="prefetch" href="/assets/js/75.05191ece.js"><link rel="prefetch" href="/assets/js/76.f516d464.js"><link rel="prefetch" href="/assets/js/77.c345180b.js"><link rel="prefetch" href="/assets/js/78.4a09d0ba.js"><link rel="prefetch" href="/assets/js/79.65f41bcf.js"><link rel="prefetch" href="/assets/js/8.f6cfdc07.js"><link rel="prefetch" href="/assets/js/80.b77151f3.js"><link rel="prefetch" href="/assets/js/81.824fa371.js"><link rel="prefetch" href="/assets/js/82.3f91c09b.js"><link rel="prefetch" href="/assets/js/83.9539f074.js"><link rel="prefetch" href="/assets/js/84.dd89f1de.js"><link rel="prefetch" href="/assets/js/85.15210b99.js"><link rel="prefetch" href="/assets/js/86.e14553e1.js"><link rel="prefetch" href="/assets/js/87.6dc95177.js"><link rel="prefetch" href="/assets/js/88.09c5e890.js"><link rel="prefetch" href="/assets/js/89.0d61f4d0.js"><link rel="prefetch" href="/assets/js/9.759f1986.js"><link rel="prefetch" href="/assets/js/90.a9b14d80.js"><link rel="prefetch" href="/assets/js/91.1a4aabe2.js"><link rel="prefetch" href="/assets/js/92.12070bdb.js"><link rel="prefetch" href="/assets/js/93.b5dc76d0.js"><link rel="prefetch" href="/assets/js/94.690498a6.js"><link rel="prefetch" href="/assets/js/95.b17961e6.js"><link rel="prefetch" href="/assets/js/96.a2f06f3e.js"><link rel="prefetch" href="/assets/js/97.64ef6721.js"><link rel="prefetch" href="/assets/js/98.443eba26.js"><link rel="prefetch" href="/assets/js/99.b6ba7c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">MSG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python-Django</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/7.%20Python-Django/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/Python/7. Python-Django/68. request相关的属性.html" class="sidebar-link">68. request相关的属性</a></li><li><a href="/Python/7. Python-Django/69. WEB框架的本质.html" class="sidebar-link">69. WEB框架的本质</a></li><li><a href="/Python/7. Python-Django/70. Django框架、基础.html" class="sidebar-link">70. Django框架、基础</a></li><li><a href="/Python/7. Python-Django/71. Django图书馆之出版社的增删改查 - 单表.html" class="sidebar-link">71. Django图书馆之出版社的增删改查 - 单表</a></li><li><a href="/Python/7. Python-Django/72. Django图书馆之书籍的增删改查 - 多表(外键).html" class="sidebar-link">72. Django图书馆之书籍的增删改查 - 多表(外键)</a></li><li><a href="/Python/7. Python-Django/73. Django图书馆之作者的增删改查 - 多对多关系表.html" class="sidebar-link">73. Django图书馆之作者的增删改查 - 多对多关系表</a></li><li><a href="/Python/7. Python-Django/74. Django简单上传文件.html" class="sidebar-link">74. Django简单上传文件</a></li><li><a href="/Python/7. Python-Django/75. Django模板语言之变量.html" class="sidebar-link">75. Django模板语言之变量</a></li><li><a href="/Python/7. Python-Django/76. Django模板语言之逻辑.html" class="sidebar-link">76. Django模板语言之逻辑</a></li><li><a href="/Python/7. Python-Django/77. Django视图、request方法大全.html" class="sidebar-link">77. Django视图、request方法大全</a></li><li><a href="/Python/7. Python-Django/78. Django路由系统(url).html" class="sidebar-link">78. Django路由系统(url)</a></li><li><a href="/Python/7. Python-Django/79. Django模型(ORM) 认识、字段.html" class="sidebar-link">79. Django模型(ORM) 认识、字段</a></li><li><a href="/Python/7. Python-Django/80. Django模型(ORM) 操作、进阶.html" class="sidebar-link">80. Django模型(ORM) 操作、进阶</a></li><li><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html" class="active sidebar-link">81. Django - Cookie、Session、自定义分页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#cookie的由来" class="sidebar-link">Cookie的由来</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#什么是cookie" class="sidebar-link">什么是Cookie</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#cookie的原理" class="sidebar-link">Cookie的原理</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#查看cookie" class="sidebar-link">查看Cookie</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#获取cookie" class="sidebar-link">获取Cookie</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#设置cookie" class="sidebar-link">设置Cookie</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#删除cookie" class="sidebar-link">删除Cookie</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#cookie版登陆校验" class="sidebar-link">Cookie版登陆校验</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#cookie版登陆校验-简化" class="sidebar-link">Cookie版登陆校验 - 简化</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#session的由来" class="sidebar-link">Session的由来</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#session使用说明-必看" class="sidebar-link">Session使用说明 - 必看</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#session流程解析" class="sidebar-link">Session流程解析</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#django中的session配置" class="sidebar-link">Django中的Session配置</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#session版登陆验证" class="sidebar-link">Session版登陆验证</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#session版登陆验证-简化" class="sidebar-link">Session版登陆验证 - 简化</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#cbv中加装饰器相关" class="sidebar-link">CBV中加装饰器相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#_1-加在cbv视图的get或post方法上" class="sidebar-link">1. 加在CBV视图的get或post方法上</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#_2-加在dispatch方法上" class="sidebar-link">2. 加在dispatch方法上</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#_3-直接加在视图类上-但method-decorator必须传-name-关键字参数" class="sidebar-link">3. 直接加在视图类上，但method_decorator必须传 name 关键字参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#cbv中加装饰器相关-补充" class="sidebar-link">CBV中加装饰器相关 - 补充</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#自定义分页" class="sidebar-link">自定义分页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#稳扎稳打版" class="sidebar-link">稳扎稳打版</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#封装保存版" class="sidebar-link">封装保存版</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#封装保存版使用示例" class="sidebar-link">封装保存版使用示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#django内置分页" class="sidebar-link">Django内置分页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#内置分页view部分" class="sidebar-link">内置分页view部分</a></li><li class="sidebar-sub-header"><a href="/Python/7. Python-Django/81. Django - Cookie、Session、自定义分页.html#内置分页html部分" class="sidebar-link">内置分页HTML部分</a></li></ul></li></ul></li><li><a href="/Python/7. Python-Django/82. Django - 中间件.html" class="sidebar-link">82. Django - 中间件</a></li><li><a href="/Python/7. Python-Django/83. Django - ajax、csrf中间件补充.html" class="sidebar-link">83. Django - ajax、csrf中间件补充</a></li><li><a href="/Python/7. Python-Django/84. Django - Form、ModelForm.html" class="sidebar-link">84. Django - Form、ModelForm</a></li><li><a href="/Python/7. Python-Django/85. Django - auth认证组件.html" class="sidebar-link">85. Django - auth认证组件</a></li><li><a href="/Python/7. Python-Django/86. 权限控制.html" class="sidebar-link">86. 权限控制</a></li><li><a href="/Python/7. Python-Django/87. django小技巧.html" class="sidebar-link">87. django小技巧</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_81-django-cookie、session、自定义分页"><a href="#_81-django-cookie、session、自定义分页" class="header-anchor">#</a> 81. Django - Cookie、Session、自定义分页</h1> <h1 id="cookie"><a href="#cookie" class="header-anchor">#</a> <strong>cookie</strong></h1> <h2 id="cookie的由来"><a href="#cookie的由来" class="header-anchor">#</a> Cookie的由来</h2> <p>大家都知道HTTP协议是无状态的。</p> <p>无状态的意思是每次请求都是独立的，它的执行情况和结果与前面的请求和之后的请求都无直接关系，它不会受前面的请求响应情况直接影响，也不会直接影响后面的请求响应情况。</p> <p>一句有意思的话来描述就是人生只如初见，对服务器来说，每次的请求都是全新的。</p> <p>状态可以理解为客户端和服务器在某次会话中产生的数据，那无状态的就以为这些数据不会被保留。会话中产生的数据又是我们需要保存的，也就是说要“保持状态”。因此Cookie就是在这样一个场景下诞生。</p> <h2 id="什么是cookie"><a href="#什么是cookie" class="header-anchor">#</a> 什么是Cookie</h2> <p>Cookie具体指的是一段小信息，它是服务器发送出来存储在浏览器上的一组组键值对，下次访问服务器时浏览器会自动携带这些键值对，以便服务器提取有用信息。</p> <h2 id="cookie的原理"><a href="#cookie的原理" class="header-anchor">#</a> Cookie的原理</h2> <p>cookie的工作原理是：由服务器产生内容，浏览器收到请求后保存在本地；当浏览器再次访问时，浏览器会自动带上Cookie，这样服务器就能通过Cookie的内容来判断这个是“谁”了。</p> <h2 id="查看cookie"><a href="#查看cookie" class="header-anchor">#</a> 查看Cookie</h2> <p>我们使用Chrome浏览器，打开开发者工具。</p> <p><img src="https://s2.ax1x.com/2019/12/17/QIKrDS.png" alt="QIKrDS.png"></p> <h1 id="django中操作cookie"><a href="#django中操作cookie" class="header-anchor">#</a> <strong>Django中操作Cookie</strong></h1> <h2 id="获取cookie"><a href="#获取cookie" class="header-anchor">#</a> 获取Cookie</h2> <div class="language-python extra-class"><pre class="language-python"><code>request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span>  <span class="token comment">## 获取普通的cookie</span>

request<span class="token punctuation">.</span>get_signed_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span> salt<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment">## 获取加密的cookie</span>
request<span class="token punctuation">.</span>get_signed_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span> default<span class="token operator">=</span>RAISE_ERROR<span class="token punctuation">,</span> salt<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment">## 获取加密的cookie</span>
</code></pre></div><p>参数：</p> <ol><li>default: 默认值</li></ol> <ul><li>salt: 加密盐</li> <li>max_age: 后台控制过期时间</li></ul> <h2 id="设置cookie"><a href="#设置cookie" class="header-anchor">#</a> 设置Cookie</h2> <div class="language-python extra-class"><pre class="language-python"><code>rep <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
rep ＝ render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token comment">## 设置cookie，需要在django可以返回的对象中设置，比如HttpResponse、render、redirect</span>

rep<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token comment">## 设置生成一个普通的cookie</span>
rep<span class="token punctuation">.</span>set_signed_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>salt<span class="token operator">=</span><span class="token string">'加密盐'</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token comment">## 设置生成一个加盐的cookie</span>
</code></pre></div><p>参数：</p> <ol><li>key, 键</li> <li>value='', 值</li> <li>max_age=None, 超时时间</li> <li>expires=None, 超时时间(IE requires expires, so set it if hasn't been already.)</li> <li>path='/', Cookie生效的路径，/ 表示根路径，特殊的：根路径的cookie可以被任何url的页面访问</li> <li>domain=None, Cookie生效的域名</li> <li>secure=False, https传输</li> <li>httponly=False 只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</li></ol> <h2 id="删除cookie"><a href="#删除cookie" class="header-anchor">#</a> 删除Cookie</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rep <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/login/&quot;</span><span class="token punctuation">)</span>
    rep<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 删除用户浏览器上之前设置的usercookie值</span>
    <span class="token keyword">return</span> rep
</code></pre></div><h2 id="cookie版登陆校验"><a href="#cookie版登陆校验" class="header-anchor">#</a> Cookie版登陆校验</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">check_login</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        next_url <span class="token operator">=</span> request<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>get_signed_cookie<span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span> salt<span class="token operator">=</span><span class="token string">&quot;SSS&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;yes&quot;</span><span class="token punctuation">:</span>
            <span class="token comment"># 已经登录的用户...</span>
            <span class="token keyword">return</span> func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 没有登录的用户，跳转刚到登录页面</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/login/?next={}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>next_url<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> inner


<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
        passwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">&quot;xxx&quot;</span> <span class="token keyword">and</span> passwd <span class="token operator">==</span> <span class="token string">&quot;dashabi&quot;</span><span class="token punctuation">:</span>
            next_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;next&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> next_url <span class="token keyword">and</span> next_url <span class="token operator">!=</span> <span class="token string">&quot;/logout/&quot;</span><span class="token punctuation">:</span>
                response <span class="token operator">=</span> redirect<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                response <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/class_list/&quot;</span><span class="token punctuation">)</span>
            response<span class="token punctuation">.</span>set_signed_cookie<span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yes&quot;</span><span class="token punctuation">,</span> salt<span class="token operator">=</span><span class="token string">&quot;SSS&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> response
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;login.html&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="cookie版登陆校验-简化"><a href="#cookie版登陆校验-简化" class="header-anchor">#</a> Cookie版登陆校验 - 简化</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 装饰器，用于对cookie进行校验，判断是否在登录状态</span>
<span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## 获取到cookie值，判断得到的cookie值不等于指定的值，就执行以下的代码</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_login'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token comment">## 获取当前url</span>
            <span class="token builtin">next</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>path_info
            <span class="token comment">## 把获取到的url，已GET传输方式，让登录界面带上</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login/?next={}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">## 获取到的cookie值等于指定的值，就执行以下的代码</span>
        
        <span class="token comment">## 执行用来装饰的函数</span>
        ret <span class="token operator">=</span> fn<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
		<span class="token comment">## 并返回结果</span>
        <span class="token keyword">return</span> ret
	<span class="token comment">## 返回结果</span>
    <span class="token keyword">return</span> inner


<span class="token comment">## 登录的函数</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment">## 判断前端传递过来的数据是不是POST，如果是执行以下代码</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>  <span class="token comment">## 获取POST值数据</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">)</span>  <span class="token comment">## 获取POST值数据</span>
        <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">'alex'</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">'alexdsb'</span><span class="token punctuation">:</span>   <span class="token comment">## 写死匹配，可以改成动态匹配，判断用户名密码是否正确</span>
            <span class="token builtin">next</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span>  <span class="token comment">## 获取GET中的next值，接上面装饰器的逻辑</span>
            <span class="token keyword">if</span> <span class="token builtin">next</span><span class="token punctuation">:</span>  <span class="token comment">## 判断next，如果有值，就执行以下代码</span>
                ret <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">)</span>  <span class="token comment">## 返回之前记录next的路径页面</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment">## 如果没值，就执行以下代码</span>
                ret <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">'/index/'</span><span class="token punctuation">)</span>  <span class="token comment">## 返回程序主页面</span>

            ret<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'is_login'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">## 生成cookie，并设置有效时间为5秒</span>
            <span class="token keyword">return</span> ret  <span class="token comment">## 返回结果</span>

    <span class="token comment">## 如果前端传递过来的数据不是POST，那么执行以下代码</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">)</span>  <span class="token comment">## 返回结果</span>


<span class="token decorator annotation punctuation">@login_required</span>
<span class="token comment">## home页面函数</span>
<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">## 先进行装饰器函数中的cookie判断，判断cookie正确，执行以下的代码</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'这是home页面'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@login_required</span>
<span class="token comment">## home页面函数</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">## 先进行装饰器函数中的cookie判断，判断cookie正确，执行以下的代码</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span>


<span class="token comment">## 注销登录</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">'/login/'</span><span class="token punctuation">)</span>  <span class="token comment">## 返回登录界面</span>

    ret<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">'is_login'</span><span class="token punctuation">)</span>  <span class="token comment">## 删除cookie</span>
 
    <span class="token keyword">return</span> ret  <span class="token comment">## 返回结果</span>
</code></pre></div><h1 id="session"><a href="#session" class="header-anchor">#</a> <strong>Session</strong></h1> <h2 id="session的由来"><a href="#session的由来" class="header-anchor">#</a> Session的由来</h2> <p>Cookie虽然在一定程度上解决了“保持状态”的需求，但是由于Cookie本身最大支持4096字节，以及Cookie本身保存在客户端，可能被拦截或窃取，因此就需要有一种新的东西，它能支持更多的字节，并且他保存在服务器，有较高的安全性。这就是Session。</p> <p>问题来了，基于HTTP协议的无状态特征，服务器根本就不知道访问者是“谁”。那么上述的Cookie就起到桥接的作用。</p> <p>我们可以给每个客户端的Cookie分配一个唯一的id，这样用户在访问时，通过Cookie，服务器就知道来的人是“谁”。然后我们再根据不同的Cookie的id，在服务器上保存一段时间的私密资料，如“账号密码”等等。</p> <p>总结而言：Cookie弥补了HTTP无状态的不足，让服务器知道来的人是“谁”；但是Cookie以文本的形式保存在本地，自身安全性较差；所以我们就通过Cookie识别不同的用户，对应的在Session里保存私密的信息以及超过4096字节的文本。</p> <p>另外，上述所说的Cookie和Session其实是共通性的东西，不限于语言和框架。</p> <h2 id="session使用说明-必看"><a href="#session使用说明-必看" class="header-anchor">#</a> <strong>Session使用说明 - 必看</strong></h2> <p>session存储引擎默认是存储在数据库中</p> <p>session存储在数据库是以一张表为仓库存储，这张表是就叫django_session</p> <p>如果是新项目，要先做数据库初始化，直接在项目下执行<code>python3 manage.py migrate</code>命令就可以了</p> <p>这样子就会生成django项目所需要的表，django_session也在其中</p> <h1 id="django中session相关方法"><a href="#django中session相关方法" class="header-anchor">#</a> <strong>Django中Session相关方法</strong></h1> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 获取、设置、删除Session中数据</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'k1'</span><span class="token punctuation">]</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'k1'</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'k1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'k1'</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span> <span class="token comment"># 存在则不设置</span>
<span class="token keyword">del</span> request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'k1'</span><span class="token punctuation">]</span>


<span class="token comment"># 所有 键、值、键值对</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>iterkeys<span class="token punctuation">(</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>itervalues<span class="token punctuation">(</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>iteritems<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 会话session的key</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>session_key

<span class="token comment"># 将所有Session失效日期小于当前日期的数据删除</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>clear_expired<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 检查会话session的key在数据库中是否存在</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">&quot;session_key&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 删除当前会话的所有Session数据</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
　　
<span class="token comment"># 删除当前的会话数据并删除会话的Cookie。</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    这用于确保前面的会话数据不可以再次被用户的浏览器访问
    例如，django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>logout<span class="token punctuation">(</span><span class="token punctuation">)</span> 函数中就会调用它。

<span class="token comment"># 设置会话Session和Cookie的超时时间</span>
request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token operator">*</span> 如果value是个整数，session会在些秒数后失效。
    <span class="token operator">*</span> 如果value是个datatime或timedelta，session就会在这个时间后失效。
    <span class="token operator">*</span> 如果value是<span class="token number">0</span><span class="token punctuation">,</span>用户关闭浏览器session就会失效。
    <span class="token operator">*</span> 如果value是<span class="token boolean">None</span><span class="token punctuation">,</span>session会依赖全局session失效策略。
</code></pre></div><h2 id="session流程解析"><a href="#session流程解析" class="header-anchor">#</a> Session流程解析</h2> <p><img src="https://s2.ax1x.com/2019/12/17/QIjbTg.png" alt="QIjbTg.png"></p> <h2 id="django中的session配置"><a href="#django中的session配置" class="header-anchor">#</a> Django中的Session配置</h2> <p>Django中默认支持Session，其内部提供了5种类型的Session供开发者使用。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">## 在settings.py中导入以下的模块</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> global_settings  <span class="token comment"># 从这里，按住ctrl键点击global_settings，修改以下配置</span>

<span class="token number">1</span><span class="token punctuation">.</span> 数据库Session
SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.db'</span>   <span class="token comment"># 引擎（默认）</span>

<span class="token number">2</span><span class="token punctuation">.</span> 缓存Session
SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.cache'</span>  <span class="token comment"># 引擎</span>
SESSION_CACHE_ALIAS <span class="token operator">=</span> <span class="token string">'default'</span>                            <span class="token comment"># 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置</span>

<span class="token number">3</span><span class="token punctuation">.</span> 文件Session
SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.file'</span>    <span class="token comment"># 引擎</span>
SESSION_FILE_PATH <span class="token operator">=</span> <span class="token boolean">None</span>                                    <span class="token comment"># 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir() </span>

<span class="token number">4</span><span class="token punctuation">.</span> 缓存<span class="token operator">+</span>数据库
SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.cached_db'</span>        <span class="token comment"># 引擎</span>

<span class="token number">5</span><span class="token punctuation">.</span> 加密Cookie Session
SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.signed_cookies'</span>   <span class="token comment"># 引擎</span>

其他公用设置项：
SESSION_COOKIE_NAME ＝ <span class="token string">&quot;sessionid&quot;</span>                       <span class="token comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）</span>
SESSION_COOKIE_PATH ＝ <span class="token string">&quot;/&quot;</span>                               <span class="token comment"># Session的cookie保存的路径（默认）</span>
SESSION_COOKIE_DOMAIN <span class="token operator">=</span> <span class="token boolean">None</span>                             <span class="token comment"># Session的cookie保存的域名（默认）</span>
SESSION_COOKIE_SECURE <span class="token operator">=</span> <span class="token boolean">False</span>                            <span class="token comment"># 是否Https传输cookie（默认）</span>
SESSION_COOKIE_HTTPONLY <span class="token operator">=</span> <span class="token boolean">True</span>                           <span class="token comment"># 是否Session的cookie只支持http传输（默认）</span>
SESSION_COOKIE_AGE <span class="token operator">=</span> <span class="token number">1209600</span>                             <span class="token comment"># Session的cookie失效日期（2周）（默认）</span>
SESSION_EXPIRE_AT_BROWSER_CLOSE <span class="token operator">=</span> <span class="token boolean">False</span>                  <span class="token comment"># 是否关闭浏览器使得Session过期（默认）</span>
SESSION_SAVE_EVERY_REQUEST <span class="token operator">=</span> <span class="token boolean">False</span>                       <span class="token comment"># 是否每次请求都保存Session，默认修改之后才保存（默认）</span>
</code></pre></div><h2 id="session版登陆验证"><a href="#session版登陆验证" class="header-anchor">#</a> Session版登陆验证</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps


<span class="token keyword">def</span> <span class="token function">check_login</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        next_url <span class="token operator">=</span> request<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/login/?next={}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>next_url<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> inner


<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">&quot;alex&quot;</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">&quot;alex1234&quot;</span><span class="token punctuation">:</span>
            <span class="token comment"># 设置session</span>
            request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> user
            <span class="token comment"># 获取跳到登陆页面之前的URL</span>
            next_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;next&quot;</span><span class="token punctuation">)</span>
            <span class="token comment"># 如果有，就跳转回登陆之前的URL</span>
            <span class="token keyword">if</span> next_url<span class="token punctuation">:</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>
            <span class="token comment"># 否则默认跳转到index页面</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/index/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;login.html&quot;</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@check_login</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 删除所有当前请求相关的session</span>
    request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/login/&quot;</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@check_login</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    current_user <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> current_user<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="session版登陆验证-简化"><a href="#session版登陆验证-简化" class="header-anchor">#</a> Session版登陆验证 - 简化</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 装饰器，用于对cookie进行校验，判断是否在登录状态</span>
<span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">## 获取到cookie值，判断得到的cookie值不等于指定的值，就执行以下的代码</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_login'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token comment">## 获取当前url</span>
            <span class="token builtin">next</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>path_info
            <span class="token comment">## 把获取到的url，已GET传输方式，让登录界面带上</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login/?next={}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">## 获取到的cookie值等于指定的值，就执行以下的代码</span>
        <span class="token comment">## 执行用来装饰的函数</span>
        ret <span class="token operator">=</span> fn<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
		<span class="token comment">## 并返回结果</span>
        <span class="token keyword">return</span> ret
	<span class="token comment">## 返回结果</span>
    <span class="token keyword">return</span> inner


<span class="token comment">## 登录的函数</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment">## 判断前端传递过来的数据是不是POST，如果是执行以下代码</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>  <span class="token comment">## 获取POST值数据</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">)</span>  <span class="token comment">## 获取POST值数据</span>
        <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">'alex'</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">'alexdsb'</span><span class="token punctuation">:</span>   <span class="token comment">## 写死匹配，可以改成动态匹配，判断用户名密码是否正确</span>
            <span class="token builtin">next</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span>  <span class="token comment">## 获取GET中的next值，接上面装饰器的逻辑</span>
            <span class="token keyword">if</span> <span class="token builtin">next</span><span class="token punctuation">:</span>  <span class="token comment">## 判断next，如果有值，就执行以下代码</span>
                ret <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">)</span>  <span class="token comment">## 返回之前记录next的路径页面</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment">## 如果没值，就执行以下代码</span>
                ret <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">'/index/'</span><span class="token punctuation">)</span>  <span class="token comment">## 返回程序主页面</span>

            ret<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'is_login'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">## 生成cookie，并设置有效时间为5秒</span>
            <span class="token keyword">return</span> ret  <span class="token comment">## 返回结果</span>

    <span class="token comment">## 如果前端传递过来的数据不是POST，那么执行以下代码</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">)</span>  <span class="token comment">## 返回结果</span>


<span class="token decorator annotation punctuation">@login_required</span>
<span class="token comment">## home页面函数</span>
<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">## 先进行装饰器函数中的cookie判断，判断cookie正确，执行以下的代码</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'这是home页面'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@login_required</span>
<span class="token comment">## home页面函数</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">## 先进行装饰器函数中的cookie判断，判断cookie正确，执行以下的代码</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span>


<span class="token comment">## 注销登录</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">'/login/'</span><span class="token punctuation">)</span>  <span class="token comment">## 返回登录界面</span>

    ret<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">'is_login'</span><span class="token punctuation">)</span>  <span class="token comment">## 删除cookie</span>
 
    <span class="token keyword">return</span> ret  <span class="token comment">## 返回结果</span>
</code></pre></div><h2 id="cbv中加装饰器相关"><a href="#cbv中加装饰器相关" class="header-anchor">#</a> <strong>CBV中加装饰器相关</strong></h2> <p>CBV实现的登录视图</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        处理GET请求
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        处理POST请求 
        &quot;&quot;&quot;</span>
        user <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">'alex'</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">&quot;alex1234&quot;</span><span class="token punctuation">:</span>
            next_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;next&quot;</span><span class="token punctuation">)</span>
            <span class="token comment"># 生成随机字符串</span>
            <span class="token comment"># 写浏览器cookie -&gt; session_id: 随机字符串</span>
            <span class="token comment"># 写到服务端session：</span>
            <span class="token comment"># {</span>
            <span class="token comment">#     &quot;随机字符串&quot;: {'user':'alex'}</span>
            <span class="token comment"># }</span>
            request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user
            <span class="token keyword">if</span> next_url<span class="token punctuation">:</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/index/'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">)</span>
</code></pre></div><p>要在CBV视图中使用我们上面的check_login装饰器，有以下三种方式：</p> <p>from django.utils.decorators import method_decorator</p> <h3 id="_1-加在cbv视图的get或post方法上"><a href="#_1-加在cbv视图的get或post方法上" class="header-anchor">#</a> 1. 加在CBV视图的get或post方法上</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator


<span class="token keyword">class</span> <span class="token class-name">HomeView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
  
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>HomeView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;home.html&quot;</span><span class="token punctuation">)</span>
    
    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>check_login<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Home View POST method...&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/index/&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-加在dispatch方法上"><a href="#_2-加在dispatch方法上" class="header-anchor">#</a> 2. 加在dispatch方法上</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator


<span class="token keyword">class</span> <span class="token class-name">HomeView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>check_login<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>HomeView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;home.html&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Home View POST method...&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/index/&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>因为CBV中首先执行的就是dispatch方法，所以这么写相当于给get和post方法都加上了登录校验。</p> <h3 id="_3-直接加在视图类上-但method-decorator必须传-name-关键字参数"><a href="#_3-直接加在视图类上-但method-decorator必须传-name-关键字参数" class="header-anchor">#</a> 3. 直接加在视图类上，但method_decorator必须传 name 关键字参数</h3> <p>如果get方法和post方法都需要登录校验的话就写两个装饰器。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator

<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>check_login<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>check_login<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">HomeView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>HomeView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;home.html&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Home View POST method...&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/index/&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="cbv中加装饰器相关-补充"><a href="#cbv中加装饰器相关-补充" class="header-anchor">#</a> CBV中加装饰器相关 - 补充</h2> <p>CSRF Token相关装饰器在CBV只能加到dispatch方法上，或者加在视图类上然后name参数指定为dispatch方法。</p> <p>备注：</p> <ol><li>csrf_protect，为当前函数强制设置防跨站请求伪造功能，即便settings中没有设置全局中间件。</li> <li>csrf_exempt，取消当前函数防跨站请求伪造功能，即便settings中设置了全局中间件。</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt<span class="token punctuation">,</span> csrf_protect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator


<span class="token keyword">class</span> <span class="token class-name">HomeView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>csrf_exempt<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>HomeView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;home.html&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Home View POST method...&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/index/&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>或者</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt<span class="token punctuation">,</span> csrf_protect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator


<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>csrf_exempt<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'dispatch'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">HomeView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
   
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>HomeView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;home.html&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Home View POST method...&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/index/&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="分页"><a href="#分页" class="header-anchor">#</a> <strong>分页</strong></h1> <p>当数据库中数据有很多，我们通常会在前端页面做分页展示。</p> <p>分页的数据可以在前端页面实现，也可以在后端实现分页。</p> <p>后端实现分页的原理就是每次只请求一页数据。</p> <p><strong>下面的实例，代码有点多，建议按大纲进行跳转</strong></p> <p>准备工作</p> <p>我们使用脚本批量创建一些测试数据（将下面的代码保存到bulk_create.py文件中放到Django项目的根目录，直接执行即可。）</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;about_orm.settings&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">import</span> django
    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> preese <span class="token keyword">import</span> models
    bulk_obj <span class="token operator">=</span> <span class="token punctuation">(</span>models<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'沙河第{}出版社'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>bulk_obj<span class="token punctuation">)</span>
</code></pre></div><h2 id="自定义分页"><a href="#自定义分页" class="header-anchor">#</a> <strong>自定义分页</strong></h2> <h3 id="稳扎稳打版"><a href="#稳扎稳打版" class="header-anchor">#</a> 稳扎稳打版</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">publisher_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 从URL中取当前访问的页码数</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        current_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token comment"># 取不到或者页码数不是数字都默认展示第1页</span>
        current_page <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment"># 总数据量</span>
    total_count <span class="token operator">=</span> models<span class="token punctuation">.</span>Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 定义每页显示多少条数据</span>
    per_page <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token comment"># 计算出总页码数</span>
    total_page<span class="token punctuation">,</span> more <span class="token operator">=</span> <span class="token builtin">divmod</span><span class="token punctuation">(</span>total_count<span class="token punctuation">,</span> per_page<span class="token punctuation">)</span>
    <span class="token keyword">if</span> more<span class="token punctuation">:</span>
        total_page <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token comment"># 定义页面上最多显示多少页码(为了左右对称，一般设为奇数)</span>
    max_show <span class="token operator">=</span> <span class="token number">11</span>
    half_show <span class="token operator">=</span> max_show <span class="token operator">//</span> <span class="token number">2</span>
    <span class="token comment"># 计算一下页面显示的页码范围</span>
    <span class="token keyword">if</span> total_page <span class="token operator">&lt;=</span> max_show<span class="token punctuation">:</span>  <span class="token comment"># 总页码数小于最大显示页码数</span>
        page_start <span class="token operator">=</span> <span class="token number">1</span>
        page_end <span class="token operator">=</span> total_page
    <span class="token keyword">elif</span> current_page <span class="token operator">+</span> half_show <span class="token operator">&gt;=</span> total_page<span class="token punctuation">:</span>  <span class="token comment"># 右边越界</span>
        page_end <span class="token operator">=</span> total_page
        page_start <span class="token operator">=</span> total_page <span class="token operator">-</span> max_show
    <span class="token keyword">elif</span> current_page <span class="token operator">-</span> half_show <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左边越界</span>
        page_start <span class="token operator">=</span> <span class="token number">1</span>
        page_end <span class="token operator">=</span> max_show
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 正常页码区间</span>
        page_start <span class="token operator">=</span> current_page <span class="token operator">-</span> half_show
        page_end <span class="token operator">=</span> current_page <span class="token operator">+</span> half_show
    <span class="token comment"># 数据索引起始位置</span>
    data_start <span class="token operator">=</span> <span class="token punctuation">(</span>current_page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> per_page
    data_end <span class="token operator">=</span> current_page <span class="token operator">*</span> per_page

    publisher_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>data_start<span class="token punctuation">:</span>data_end<span class="token punctuation">]</span>

    <span class="token comment"># 生成页面上显示的页码</span>
    page_html_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&lt;nav aria-label=&quot;Page navigation&quot;&gt;&lt;ul class=&quot;pagination&quot;&gt;'</span><span class="token punctuation">)</span>
    <span class="token comment"># 加首页</span>
    first_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;/publisher_list/?page=1&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;'</span>
    page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>first_li<span class="token punctuation">)</span>
    <span class="token comment"># 加上一页</span>
    <span class="token keyword">if</span> current_page <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        prev_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;laquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        prev_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;/publisher_list/?page={}&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;laquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>current_page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>prev_li<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>page_start<span class="token punctuation">,</span> page_end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> current_page<span class="token punctuation">:</span>
            li_tag <span class="token operator">=</span> <span class="token string">'&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;/publisher_list/?page={0}&quot;&gt;{0}&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            li_tag <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;/publisher_list/?page={0}&quot;&gt;{0}&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>li_tag<span class="token punctuation">)</span>
    <span class="token comment"># 加下一页</span>
    <span class="token keyword">if</span> current_page <span class="token operator">==</span> total_page<span class="token punctuation">:</span>
        next_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;raquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        next_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;/publisher_list/?page={}&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;raquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>current_page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_li<span class="token punctuation">)</span>
    <span class="token comment"># 加尾页</span>
    page_end_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;/publisher_list/?page={}&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>total_page<span class="token punctuation">)</span>
    page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>page_end_li<span class="token punctuation">)</span>
    page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&lt;/ul&gt;&lt;/nav&gt;'</span><span class="token punctuation">)</span>
    page_html <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>page_html_list<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;publisher_list.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;publisher_list&quot;</span><span class="token punctuation">:</span> publisher_list<span class="token punctuation">,</span> <span class="token string">&quot;page_html&quot;</span><span class="token punctuation">:</span> page_html<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="封装保存版"><a href="#封装保存版" class="header-anchor">#</a> 封装保存版</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Pagination</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;自定义分页（Bootstrap版）&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> current_page<span class="token punctuation">,</span> total_count<span class="token punctuation">,</span> base_url<span class="token punctuation">,</span> per_page<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> max_show<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        :param current_page: 当前请求的页码
        :param total_count: 总数据量
        :param base_url: 请求的URL
        :param per_page: 每页显示的数据量，默认值为10
        :param max_show: 页面上最多显示多少个页码，默认值为11
        &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>current_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>current_page<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token comment"># 取不到或者页码数不是数字都默认展示第1页</span>
            self<span class="token punctuation">.</span>current_page <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token comment"># 定义每页显示多少条数据</span>
        self<span class="token punctuation">.</span>per_page <span class="token operator">=</span> per_page
        <span class="token comment"># 计算出总页码数</span>
        total_page<span class="token punctuation">,</span> more <span class="token operator">=</span> <span class="token builtin">divmod</span><span class="token punctuation">(</span>total_count<span class="token punctuation">,</span> per_page<span class="token punctuation">)</span>
        <span class="token keyword">if</span> more<span class="token punctuation">:</span>
            total_page <span class="token operator">+=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>total_page <span class="token operator">=</span> total_page
        <span class="token comment"># 定义页面上最多显示多少页码(为了左右对称，一般设为奇数)</span>
        self<span class="token punctuation">.</span>max_show <span class="token operator">=</span> max_show
        self<span class="token punctuation">.</span>half_show <span class="token operator">=</span> max_show <span class="token operator">//</span> <span class="token number">2</span>
        self<span class="token punctuation">.</span>base_url <span class="token operator">=</span> base_url

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>current_page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>per_page

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">end</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>current_page <span class="token operator">*</span> self<span class="token punctuation">.</span>per_page

    <span class="token keyword">def</span> <span class="token function">page_html</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 计算一下页面显示的页码范围</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>total_page <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>max_show<span class="token punctuation">:</span>  <span class="token comment"># 总页码数小于最大显示页码数</span>
            page_start <span class="token operator">=</span> <span class="token number">1</span>
            page_end <span class="token operator">=</span> self<span class="token punctuation">.</span>total_page
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>current_page <span class="token operator">+</span> self<span class="token punctuation">.</span>half_show <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>total_page<span class="token punctuation">:</span>  <span class="token comment"># 右边越界</span>
            page_end <span class="token operator">=</span> self<span class="token punctuation">.</span>total_page
            page_start <span class="token operator">=</span> self<span class="token punctuation">.</span>total_page <span class="token operator">-</span> self<span class="token punctuation">.</span>max_show
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>current_page <span class="token operator">-</span> self<span class="token punctuation">.</span>half_show <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左边越界</span>
            page_start <span class="token operator">=</span> <span class="token number">1</span>
            page_end <span class="token operator">=</span> self<span class="token punctuation">.</span>max_show
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 正常页码区间</span>
            page_start <span class="token operator">=</span> self<span class="token punctuation">.</span>current_page <span class="token operator">-</span> self<span class="token punctuation">.</span>half_show
            page_end <span class="token operator">=</span> self<span class="token punctuation">.</span>current_page <span class="token operator">+</span> self<span class="token punctuation">.</span>half_show
        <span class="token comment"># 生成页面上显示的页码</span>
        page_html_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&lt;nav aria-label=&quot;Page navigation&quot;&gt;&lt;ul class=&quot;pagination&quot;&gt;'</span><span class="token punctuation">)</span>
        <span class="token comment"># 加首页</span>
        first_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;{}?page=1&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">)</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>first_li<span class="token punctuation">)</span>
        <span class="token comment"># 加上一页</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>current_page <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            prev_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;laquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            prev_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;{}?page={}&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;laquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> self<span class="token punctuation">.</span>current_page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>prev_li<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>page_start<span class="token punctuation">,</span> page_end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> self<span class="token punctuation">.</span>current_page<span class="token punctuation">:</span>
                li_tag <span class="token operator">=</span> <span class="token string">'&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;{0}?page={1}&quot;&gt;{1}&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                li_tag <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;{0}?page={1}&quot;&gt;{1}&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
            page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>li_tag<span class="token punctuation">)</span>
        <span class="token comment"># 加下一页</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>current_page <span class="token operator">==</span> self<span class="token punctuation">.</span>total_page<span class="token punctuation">:</span>
            next_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;raquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            next_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;{}?page={}&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;raquo;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> self<span class="token punctuation">.</span>current_page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_li<span class="token punctuation">)</span>
        <span class="token comment"># 加尾页</span>
        page_end_li <span class="token operator">=</span> <span class="token string">'&lt;li&gt;&lt;a href=&quot;{}?page={}&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> self<span class="token punctuation">.</span>total_page<span class="token punctuation">)</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>page_end_li<span class="token punctuation">)</span>
        page_html_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&lt;/ul&gt;&lt;/nav&gt;'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>page_html_list<span class="token punctuation">)</span>
</code></pre></div><h3 id="封装保存版使用示例"><a href="#封装保存版使用示例" class="header-anchor">#</a> 封装保存版使用示例</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">publisher_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 从URL中取当前访问的页码数</span>
    current_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 比len(models.Publisher.objects.all())更高效</span>
    total_count <span class="token operator">=</span> models<span class="token punctuation">.</span>Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    page_obj <span class="token operator">=</span> Pagination<span class="token punctuation">(</span>current_page<span class="token punctuation">,</span> total_count<span class="token punctuation">,</span> request<span class="token punctuation">.</span>path_info<span class="token punctuation">)</span>
    data <span class="token operator">=</span> models<span class="token punctuation">.</span>Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>page_obj<span class="token punctuation">.</span>start<span class="token punctuation">:</span>page_obj<span class="token punctuation">.</span>end<span class="token punctuation">]</span>
    page_html <span class="token operator">=</span> page_obj<span class="token punctuation">.</span>page_html<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;publisher_list.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;publisher_list&quot;</span><span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token string">&quot;page_html&quot;</span><span class="token punctuation">:</span> page_html<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="django内置分页"><a href="#django内置分页" class="header-anchor">#</a> <strong>Django内置分页</strong></h2> <h3 id="内置分页view部分"><a href="#内置分页view部分" class="header-anchor">#</a> 内置分页view部分</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>paginator <span class="token keyword">import</span> Paginator<span class="token punctuation">,</span> EmptyPage<span class="token punctuation">,</span> PageNotAnInteger

L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    current_page <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

    paginator <span class="token operator">=</span> Paginator<span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token comment"># per_page: 每页显示条目数量</span>
    <span class="token comment"># count:    数据总个数</span>
    <span class="token comment"># num_pages:总页数</span>
    <span class="token comment"># page_range:总页数的索引范围，如: (1,10),(1,200)</span>
    <span class="token comment"># page:     page对象</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        posts <span class="token operator">=</span> paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span>current_page<span class="token punctuation">)</span>
        <span class="token comment"># has_next              是否有下一页</span>
        <span class="token comment"># next_page_number      下一页页码</span>
        <span class="token comment"># has_previous          是否有上一页</span>
        <span class="token comment"># previous_page_number  上一页页码</span>
        <span class="token comment"># object_list           分页之后的数据列表</span>
        <span class="token comment"># number                当前页</span>
        <span class="token comment"># paginator             paginator对象</span>
    <span class="token keyword">except</span> PageNotAnInteger<span class="token punctuation">:</span>
        posts <span class="token operator">=</span> paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> EmptyPage<span class="token punctuation">:</span>
        posts <span class="token operator">=</span> paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span>paginator<span class="token punctuation">.</span>num_pages<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'posts'</span><span class="token punctuation">:</span> posts<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="内置分页html部分"><a href="#内置分页html部分" class="header-anchor">#</a> 内置分页HTML部分</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> posts <span class="token operator">%</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;pagination&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;step-links&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> posts<span class="token punctuation">.</span>has_previous <span class="token operator">%</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;?p={{ posts.previous_page_number }}&quot;</span><span class="token operator">&gt;</span>Previous<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;current&quot;</span><span class="token operator">&gt;</span>
            Page <span class="token punctuation">{</span><span class="token punctuation">{</span> posts<span class="token punctuation">.</span>number <span class="token punctuation">}</span><span class="token punctuation">}</span> of <span class="token punctuation">{</span><span class="token punctuation">{</span> posts<span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>num_pages <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> posts<span class="token punctuation">.</span>has_next <span class="token operator">%</span><span class="token punctuation">}</span>
              <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;?p={{ posts.next_page_number }}&quot;</span><span class="token operator">&gt;</span>Next<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Python/7. Python-Django/80. Django模型(ORM) 操作、进阶.html" class="prev">
        80. Django模型(ORM) 操作、进阶
      </a></span> <span class="next"><a href="/Python/7. Python-Django/82. Django - 中间件.html">
        82. Django - 中间件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d65bef42.js" defer></script><script src="/assets/js/2.2249178e.js" defer></script><script src="/assets/js/154.eb44bf23.js" defer></script>
  </body>
</html>
