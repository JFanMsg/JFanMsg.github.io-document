<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5. Kubernetes之yaml文件详解使用 | MSG</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="在追寻技术的同时享受生活">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.d65bef42.js" as="script"><link rel="preload" href="/assets/js/2.2249178e.js" as="script"><link rel="preload" href="/assets/js/11.bd8ec7a6.js" as="script"><link rel="prefetch" href="/assets/js/10.4785e2e5.js"><link rel="prefetch" href="/assets/js/100.33fceff2.js"><link rel="prefetch" href="/assets/js/101.62e1e5d4.js"><link rel="prefetch" href="/assets/js/102.8551fe71.js"><link rel="prefetch" href="/assets/js/103.47754d79.js"><link rel="prefetch" href="/assets/js/104.4adf114f.js"><link rel="prefetch" href="/assets/js/105.6206a08a.js"><link rel="prefetch" href="/assets/js/106.1c4561f3.js"><link rel="prefetch" href="/assets/js/107.e1531a5a.js"><link rel="prefetch" href="/assets/js/108.c637743a.js"><link rel="prefetch" href="/assets/js/109.3f150913.js"><link rel="prefetch" href="/assets/js/110.088c1ac3.js"><link rel="prefetch" href="/assets/js/111.66d8d491.js"><link rel="prefetch" href="/assets/js/112.231663ee.js"><link rel="prefetch" href="/assets/js/113.a38bc531.js"><link rel="prefetch" href="/assets/js/114.e165daea.js"><link rel="prefetch" href="/assets/js/115.994b087a.js"><link rel="prefetch" href="/assets/js/116.ea3cfdfb.js"><link rel="prefetch" href="/assets/js/117.7be5e4f3.js"><link rel="prefetch" href="/assets/js/118.ebb58ddb.js"><link rel="prefetch" href="/assets/js/119.90018646.js"><link rel="prefetch" href="/assets/js/12.0d8f43df.js"><link rel="prefetch" href="/assets/js/120.bb5be863.js"><link rel="prefetch" href="/assets/js/121.3d1db670.js"><link rel="prefetch" href="/assets/js/122.d29ed1b2.js"><link rel="prefetch" href="/assets/js/123.38cc4704.js"><link rel="prefetch" href="/assets/js/124.cc8549d4.js"><link rel="prefetch" href="/assets/js/125.6ee3e9c8.js"><link rel="prefetch" href="/assets/js/126.48710eba.js"><link rel="prefetch" href="/assets/js/127.d7a1fd83.js"><link rel="prefetch" href="/assets/js/128.e5017f6b.js"><link rel="prefetch" href="/assets/js/129.4c33e121.js"><link rel="prefetch" href="/assets/js/13.2dbde7aa.js"><link rel="prefetch" href="/assets/js/130.cda66247.js"><link rel="prefetch" href="/assets/js/131.ad76f669.js"><link rel="prefetch" href="/assets/js/132.aca88758.js"><link rel="prefetch" href="/assets/js/133.a1cf5903.js"><link rel="prefetch" href="/assets/js/134.b1386377.js"><link rel="prefetch" href="/assets/js/135.94edcf53.js"><link rel="prefetch" href="/assets/js/136.24be4170.js"><link rel="prefetch" href="/assets/js/137.db57772e.js"><link rel="prefetch" href="/assets/js/138.dc67bcaa.js"><link rel="prefetch" href="/assets/js/139.5453d1f6.js"><link rel="prefetch" href="/assets/js/14.2187dbf4.js"><link rel="prefetch" href="/assets/js/140.938e5c07.js"><link rel="prefetch" href="/assets/js/141.99c7cf2c.js"><link rel="prefetch" href="/assets/js/142.428e3958.js"><link rel="prefetch" href="/assets/js/143.68b01530.js"><link rel="prefetch" href="/assets/js/144.f67389cc.js"><link rel="prefetch" href="/assets/js/145.d952a130.js"><link rel="prefetch" href="/assets/js/146.b933dcad.js"><link rel="prefetch" href="/assets/js/147.2d8e4c0a.js"><link rel="prefetch" href="/assets/js/148.6d76ac94.js"><link rel="prefetch" href="/assets/js/149.6b4d6378.js"><link rel="prefetch" href="/assets/js/15.a53b356c.js"><link rel="prefetch" href="/assets/js/150.5bf39cb4.js"><link rel="prefetch" href="/assets/js/151.17af677c.js"><link rel="prefetch" href="/assets/js/152.7f1c2792.js"><link rel="prefetch" href="/assets/js/153.98dd0727.js"><link rel="prefetch" href="/assets/js/154.eb44bf23.js"><link rel="prefetch" href="/assets/js/155.5a9840ea.js"><link rel="prefetch" href="/assets/js/156.7ba01fd0.js"><link rel="prefetch" href="/assets/js/157.2296a048.js"><link rel="prefetch" href="/assets/js/158.6bb1f699.js"><link rel="prefetch" href="/assets/js/159.073bb8df.js"><link rel="prefetch" href="/assets/js/16.cef7bf44.js"><link rel="prefetch" href="/assets/js/160.25a837f9.js"><link rel="prefetch" href="/assets/js/161.93d886a1.js"><link rel="prefetch" href="/assets/js/162.5d2714b2.js"><link rel="prefetch" href="/assets/js/17.96f36904.js"><link rel="prefetch" href="/assets/js/18.fd04b310.js"><link rel="prefetch" href="/assets/js/19.3e1377d1.js"><link rel="prefetch" href="/assets/js/20.ac195ac8.js"><link rel="prefetch" href="/assets/js/21.c2d7729c.js"><link rel="prefetch" href="/assets/js/22.dd8c621b.js"><link rel="prefetch" href="/assets/js/23.ad7d0350.js"><link rel="prefetch" href="/assets/js/24.8559c4c3.js"><link rel="prefetch" href="/assets/js/25.783a8116.js"><link rel="prefetch" href="/assets/js/26.25e0e459.js"><link rel="prefetch" href="/assets/js/27.c0616e2a.js"><link rel="prefetch" href="/assets/js/28.30656c2e.js"><link rel="prefetch" href="/assets/js/29.2be5114c.js"><link rel="prefetch" href="/assets/js/3.be8c8f3b.js"><link rel="prefetch" href="/assets/js/30.230a74a7.js"><link rel="prefetch" href="/assets/js/31.760f46ad.js"><link rel="prefetch" href="/assets/js/32.c9533fef.js"><link rel="prefetch" href="/assets/js/33.dcacfb38.js"><link rel="prefetch" href="/assets/js/34.4370a466.js"><link rel="prefetch" href="/assets/js/35.bf299eea.js"><link rel="prefetch" href="/assets/js/36.336e435a.js"><link rel="prefetch" href="/assets/js/37.1d1d2eea.js"><link rel="prefetch" href="/assets/js/38.0d58b7d0.js"><link rel="prefetch" href="/assets/js/39.d43564ba.js"><link rel="prefetch" href="/assets/js/4.4a6cb970.js"><link rel="prefetch" href="/assets/js/40.bc4e4bde.js"><link rel="prefetch" href="/assets/js/41.b71231a5.js"><link rel="prefetch" href="/assets/js/42.9d46f400.js"><link rel="prefetch" href="/assets/js/43.50c5be69.js"><link rel="prefetch" href="/assets/js/44.60406e7f.js"><link rel="prefetch" href="/assets/js/45.ec3569ae.js"><link rel="prefetch" href="/assets/js/46.1bd3ce7b.js"><link rel="prefetch" href="/assets/js/47.1e1b5326.js"><link rel="prefetch" href="/assets/js/48.64c631ea.js"><link rel="prefetch" href="/assets/js/49.b4abacd8.js"><link rel="prefetch" href="/assets/js/5.e6d0b165.js"><link rel="prefetch" href="/assets/js/50.c3e320c0.js"><link rel="prefetch" href="/assets/js/51.5ec7fb8c.js"><link rel="prefetch" href="/assets/js/52.2d234f86.js"><link rel="prefetch" href="/assets/js/53.f3b69623.js"><link rel="prefetch" href="/assets/js/54.c85ff450.js"><link rel="prefetch" href="/assets/js/55.b07597b5.js"><link rel="prefetch" href="/assets/js/56.444129cf.js"><link rel="prefetch" href="/assets/js/57.df1329ba.js"><link rel="prefetch" href="/assets/js/58.5afb51cf.js"><link rel="prefetch" href="/assets/js/59.d98936d9.js"><link rel="prefetch" href="/assets/js/6.809376cd.js"><link rel="prefetch" href="/assets/js/60.02813ecf.js"><link rel="prefetch" href="/assets/js/61.37a4812d.js"><link rel="prefetch" href="/assets/js/62.5da94048.js"><link rel="prefetch" href="/assets/js/63.8e2c2bca.js"><link rel="prefetch" href="/assets/js/64.d290398f.js"><link rel="prefetch" href="/assets/js/65.44e28313.js"><link rel="prefetch" href="/assets/js/66.9acf0206.js"><link rel="prefetch" href="/assets/js/67.85688aa2.js"><link rel="prefetch" href="/assets/js/68.45bda7fc.js"><link rel="prefetch" href="/assets/js/69.9074feb0.js"><link rel="prefetch" href="/assets/js/7.5d7bce6e.js"><link rel="prefetch" href="/assets/js/70.b4cd2ddc.js"><link rel="prefetch" href="/assets/js/71.53219b13.js"><link rel="prefetch" href="/assets/js/72.af2a7290.js"><link rel="prefetch" href="/assets/js/73.c28fc506.js"><link rel="prefetch" href="/assets/js/74.64c81a90.js"><link rel="prefetch" href="/assets/js/75.05191ece.js"><link rel="prefetch" href="/assets/js/76.f516d464.js"><link rel="prefetch" href="/assets/js/77.c345180b.js"><link rel="prefetch" href="/assets/js/78.4a09d0ba.js"><link rel="prefetch" href="/assets/js/79.65f41bcf.js"><link rel="prefetch" href="/assets/js/8.f6cfdc07.js"><link rel="prefetch" href="/assets/js/80.b77151f3.js"><link rel="prefetch" href="/assets/js/81.824fa371.js"><link rel="prefetch" href="/assets/js/82.3f91c09b.js"><link rel="prefetch" href="/assets/js/83.9539f074.js"><link rel="prefetch" href="/assets/js/84.dd89f1de.js"><link rel="prefetch" href="/assets/js/85.15210b99.js"><link rel="prefetch" href="/assets/js/86.e14553e1.js"><link rel="prefetch" href="/assets/js/87.6dc95177.js"><link rel="prefetch" href="/assets/js/88.09c5e890.js"><link rel="prefetch" href="/assets/js/89.0d61f4d0.js"><link rel="prefetch" href="/assets/js/9.759f1986.js"><link rel="prefetch" href="/assets/js/90.a9b14d80.js"><link rel="prefetch" href="/assets/js/91.1a4aabe2.js"><link rel="prefetch" href="/assets/js/92.12070bdb.js"><link rel="prefetch" href="/assets/js/93.b5dc76d0.js"><link rel="prefetch" href="/assets/js/94.690498a6.js"><link rel="prefetch" href="/assets/js/95.b17961e6.js"><link rel="prefetch" href="/assets/js/96.a2f06f3e.js"><link rel="prefetch" href="/assets/js/97.64ef6721.js"><link rel="prefetch" href="/assets/js/98.443eba26.js"><link rel="prefetch" href="/assets/js/99.b6ba7c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">MSG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link router-link-active">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link router-link-active">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Container/Kubernetes/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/Container/Kubernetes/1. Kubernetes概述.html" class="sidebar-link">1. Kubernetes概述</a></li><li><a href="/Container/Kubernetes/2. Kubernetes1.14集群部署 - 二进制.html" class="sidebar-link">2. Kubernetes1.14集群部署 - 二进制</a></li><li><a href="/Container/Kubernetes/3. kubectl远程连接K8S集群.html" class="sidebar-link">3. kubectl远程连接K8S集群</a></li><li><a href="/Container/Kubernetes/4. kubectl命令行管理工具.html" class="sidebar-link">4. kubectl命令行管理工具</a></li><li><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html" class="active sidebar-link">5. Kubernetes之yaml文件详解使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#yaml语法格式" class="sidebar-link">yaml语法格式</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#yaml-maps" class="sidebar-link">YAML Maps</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#yaml-lists" class="sidebar-link">YAML Lists</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#配置yaml注意事项" class="sidebar-link">配置yaml注意事项</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#kubernetes中的yaml主要组件" class="sidebar-link">kubernetes中的yaml主要组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#查看apiversion" class="sidebar-link">查看apiVersion</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#一个spec典型的容器定义" class="sidebar-link">一个spec典型的容器定义</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#kubectl创建pod" class="sidebar-link">kubectl创建Pod</a></li></ul></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#用run命令生成" class="sidebar-link">用run命令生成</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#用get命令导出" class="sidebar-link">用get命令导出</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#pod容器的字段拼写忘记了" class="sidebar-link">Pod容器的字段拼写忘记了</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#创建一个yaml文件" class="sidebar-link">创建一个yaml文件</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#创建deployment-2" class="sidebar-link">创建deployment</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#查看标签" class="sidebar-link">查看标签</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#通过标签查找pod" class="sidebar-link">通过标签查找Pod</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#deployment创建过程" class="sidebar-link">deployment创建过程</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#升级镜像-nginx1-10-nginx1-11" class="sidebar-link">升级镜像（nginx1.10–&gt;nginx1.11）</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#查看发布状态" class="sidebar-link">查看发布状态</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#查看deployment历史修订版本" class="sidebar-link">查看deployment历史修订版本</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#编辑deployment" class="sidebar-link">编辑deployment</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#查看升级过程" class="sidebar-link">查看升级过程</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#扩容-缩容-指定-replicas的数量" class="sidebar-link">扩容/缩容（指定–replicas的数量）</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#创建service提供对外访问的接口" class="sidebar-link">创建Service提供对外访问的接口</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#创建service" class="sidebar-link">创建service</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#查看service-访问pod是有负载均衡的" class="sidebar-link">查看service（访问Pod是有负载均衡的）</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#对service的描述" class="sidebar-link">对service的描述</a></li></ul></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#回滚到以前的版本" class="sidebar-link">回滚到以前的版本</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html#回滚到指定版本" class="sidebar-link">回滚到指定版本</a></li></ul></li><li><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html" class="sidebar-link">6. Kubernetes之深入理解Pod对象</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_5-kubernetes之yaml文件详解使用"><a href="#_5-kubernetes之yaml文件详解使用" class="header-anchor">#</a> 5. Kubernetes之yaml文件详解使用</h1> <h1 id="kubernetes的yaml基础"><a href="#kubernetes的yaml基础" class="header-anchor">#</a> <strong>kubernetes的yaml基础</strong></h1> <p>YAML是专门用来写配置文件的语言，非常简洁和强大，使用比json更方便。它实质上是一种通用的数据串行化格式</p> <p><strong>注意：在YAML文件中绝对不要使用tab键</strong></p> <h2 id="yaml语法格式"><a href="#yaml语法格式" class="header-anchor">#</a> yaml语法格式</h2> <p><strong>语法格式：</strong></p> <ol><li>缩进表示层级关系</li> <li>不支持制表符“tab”缩进，使用空格缩进</li> <li>通常开头缩进 2 个空格</li> <li>字符后缩进 1 个空格，如冒号、逗号等</li> <li>“---” 表示YAML格式，一个文件的开始</li> <li>“#”注释</li></ol> <p>在Kubernetes一般只有二个结构类型</p> <ol><li>Lists</li> <li>Maps</li></ol> <h2 id="yaml-maps"><a href="#yaml-maps" class="header-anchor">#</a> YAML Maps</h2> <p>Map顾名思义指的是字典，即一个Key:Value 的键值对信息。例如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
　　<span class="token comment"># 注：---为可选的分隔符 ，当需要在一个文件中定义多个结构的时候需要使用。上述内容表示有两个键apiVersion和kind，分别对应的值为v1和Pod。</span>
</code></pre></div><p>Maps的value既能够对应字符串也能够对应一个Maps。例如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube100<span class="token punctuation">-</span>site
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> web
    
<span class="token comment"># 注：上述的YAML文件中，metadata这个KEY对应的值为一个Maps，而嵌套的labels这个KEY的值又是一个Map。实际使用中可视情况进行多层嵌套</span>
</code></pre></div><p>YAML处理器根据行缩进来知道内容之间的关联。上述例子中，使用两个空格作为缩进，但空格的数据量并不重要，只是至少要求一个空格并且所有缩进保持一致的空格数 。例如，name和labels是相同缩进级别，因此YAML处理器知道他们属于同一map；它知道app是lables的值因为app的缩进更大。</p> <h2 id="yaml-lists"><a href="#yaml-lists" class="header-anchor">#</a> YAML Lists</h2> <p>List即列表，说白了就是数组，例如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">args</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span>beijing
 <span class="token punctuation">-</span>shanghai
 <span class="token punctuation">-</span>shenzhen
 <span class="token punctuation">-</span>guangzhou
 
 <span class="token comment">## 可以指定任何数量的项在列表中，每个项的定义以破折号（-）开头，并且与父元素之间存在缩进。在JSON格式中，表示如下：</span>
 
 <span class="token punctuation">{</span>
  <span class="token key atrule">&quot;args&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;beijing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;guangzhou&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然Lists的子项也可以是Maps，Maps的子项也可以是List，例如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube100<span class="token punctuation">-</span>site
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> front<span class="token punctuation">-</span>end
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flaskapp<span class="token punctuation">-</span>demo
      <span class="token key atrule">image</span><span class="token punctuation">:</span> jcdemo/flaskapp
      <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      
<span class="token comment">##  如上述所示，定义一个containers的List对象，每个子项都由name、image、ports组成，每个ports都有一个KEY为containerPort的Map组成，转成JSON格式文件如下：</span>

<span class="token punctuation">{</span>
  <span class="token key atrule">&quot;apiVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;kind&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Pod&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;metadata&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;kube100-site&quot;</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;labels&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">&quot;app&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;web&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;spec&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;containers&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;front-end&quot;</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;image&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;ports&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token key atrule">&quot;containerPort&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;80&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;flaskapp-demo&quot;</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;image&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jcdemo/flaskapp&quot;</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;ports&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token key atrule">&quot;containerPort&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;5000&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="配置yaml注意事项"><a href="#配置yaml注意事项" class="header-anchor">#</a> 配置yaml注意事项</h2> <ol><li>定义配置时，指定最新稳定版API</li> <li>配置文件应该存储在集群之外的版本控制仓库中。如果需要，可以快速回滚配置、重新创建和恢复</li> <li>应该使用YAML格式编写配置文件，而不是json。YAML对用户更加友好</li> <li>可以将相关对象组合成单个文件，通常会更容易管理</li> <li>不要没必要指定默认值，简单和最小配置减小错误</li> <li>在注释中说明一个对象描述更好维护</li></ol> <h1 id="使用yaml创建pod"><a href="#使用yaml创建pod" class="header-anchor">#</a> <strong>使用YAML创建Pod</strong></h1> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube100<span class="token punctuation">-</span>site
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> front<span class="token punctuation">-</span>end
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flaskapp<span class="token punctuation">-</span>demo
      <span class="token key atrule">image</span><span class="token punctuation">:</span> jcdemo/flaskapp
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> 5000　
        
<span class="token comment"># apiVersion：此处值是v1，这个版本号需要根据安装的Kubernetes版本和资源类型进行变化，记住不是写死的。</span>
<span class="token comment"># kind：此处创建的是Pod，根据实际情况，此处资源类型可以是Deployment、Job、Ingress、Service等。</span>
<span class="token comment"># metadata：包含Pod的一些meta信息，比如名称、namespace、标签等信息。</span>
<span class="token comment"># spec：包括一些container，storage，volume以及其他Kubernetes需要的参数，以及诸如是否在容器失败时重新启动容器的属性。可在特定Kubernetes API找到完整的Kubernetes Pod的属性。</span>
</code></pre></div><h2 id="kubernetes中的yaml主要组件"><a href="#kubernetes中的yaml主要组件" class="header-anchor">#</a> <strong>kubernetes中的yaml主要组件</strong></h2> <ol><li>apiVersion：此处值是v1，这个版本号需要根据安装的Kubernetes版本和资源类型进行变化，记住不是写死的。</li> <li>kind：此处创建的是Pod，根据实际情况，此处资源类型可以是Deployment、Job、Ingress、Service等。</li> <li>metadata：包含Pod的一些meta信息，比如名称、namespace、标签等信息。</li> <li>spec：包括一些container，storage，volume以及其他Kubernetes需要的参数，以及诸如是否在容器失败时重新启动容器的属性。可在特定Kubernetes API找到完整的Kubernetes Pod的属性。</li></ol> <h3 id="查看apiversion"><a href="#查看apiversion" class="header-anchor">#</a> 查看apiVersion</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># kubectl api-versions</span>

admissionregistration.k8s.io/v1beta1
apiextensions.k8s.io/v1beta1
apiregistration.k8s.io/v1
apiregistration.k8s.io/v1beta1
apps/v1
apps/v1beta1
apps/v1beta2
authentication.k8s.io/v1
authentication.k8s.io/v1beta1
authorization.k8s.io/v1
authorization.k8s.io/v1beta1
autoscaling/v1
autoscaling/v2beta1
batch/v1
batch/v1beta1
certificates.k8s.io/v1beta1
events.k8s.io/v1beta1
extensions/v1beta1
networking.k8s.io/v1
policy/v1beta1
rbac.authorization.k8s.io/v1
rbac.authorization.k8s.io/v1beta1
storage.k8s.io/v1
storage.k8s.io/v1beta1
v1
</code></pre></div><h3 id="一个spec典型的容器定义"><a href="#一个spec典型的容器定义" class="header-anchor">#</a> 一个spec典型的容器定义</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> front<span class="token punctuation">-</span>end
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><ol><li><p>一个简单的最小定义：一个名字（front-end）、基于nginx的镜像，以及容器将会监听的指定端口号（80）。</p></li> <li><p>除了上面的基本属性外，还能够指定复杂的属性，包括容器启动运行的命令、使用的参数、工作目录以及每次实例化是否拉取新的副本。 还可以指定更深入的信息，例如容器的退出日志的位置。容器可选的设置属性包括：</p> <ol><li>name、image、command、args、workingDir、ports、env、resource、volumeMounts、livenessProbe、readinessProbe、livecycle、terminationMessagePath、imagePullPolicy、securityContext、stdin、stdinOnce、tty</li></ol></li></ol> <h3 id="kubectl创建pod"><a href="#kubectl创建pod" class="header-anchor">#</a> kubectl创建Pod</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>kubectl create <span class="token punctuation">-</span>f test_pod.yaml
pod &quot;kube100<span class="token punctuation">-</span>site&quot; created
</code></pre></div><h1 id="已有的pod导出yaml格式文件"><a href="#已有的pod导出yaml格式文件" class="header-anchor">#</a> <strong>已有的pod导出yaml格式文件</strong></h1> <h2 id="用run命令生成"><a href="#用run命令生成" class="header-anchor">#</a> 用run命令生成</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl run --image<span class="token operator">=</span>nginx my-deploy -o yaml --dry-run <span class="token operator">&gt;</span> my-deploy.yaml 
</code></pre></div><h2 id="用get命令导出"><a href="#用get命令导出" class="header-anchor">#</a> 用get命令导出</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get my-deploy/nginx -o<span class="token operator">=</span>yaml --export <span class="token operator">&gt;</span> my-deploy.yaml
</code></pre></div><h2 id="pod容器的字段拼写忘记了"><a href="#pod容器的字段拼写忘记了" class="header-anchor">#</a> Pod容器的字段拼写忘记了</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl explain pods.spec.containers
</code></pre></div><h1 id="kubernetes的yaml文件名词"><a href="#kubernetes的yaml文件名词" class="header-anchor">#</a> <strong>kubernetes的yaml文件名词</strong></h1> <p><strong>仅供参考</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#test-pod </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1 <span class="token comment">#指定api版本，此值必须在kubectl apiversion中   </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod <span class="token comment">#指定创建资源的角色/类型   </span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span> <span class="token comment">#资源的元数据/属性   </span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pod <span class="token comment">#资源的名字，在同一个namespace中必须唯一   </span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span> <span class="token comment">#设定资源的标签 </span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> apache   
    <span class="token key atrule">version</span><span class="token punctuation">:</span> v1   
    <span class="token key atrule">kubernetes.io/cluster-service</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>   
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>            <span class="token comment">#自定义注解列表   </span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> String        <span class="token comment">#自定义注解名字   </span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span> <span class="token comment">#specification of the resource content 指定该资源的内容   </span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always <span class="token comment">#表明该容器一直运行，默认k8s的策略，在此容器退出后，会立即创建一个相同的容器   </span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>     <span class="token comment">#节点选择，先给主机打标签kubectl label nodes kube-node1 zone=node1   </span>
    <span class="token key atrule">zone</span><span class="token punctuation">:</span> node1   
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>   
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pod <span class="token comment">#容器的名字   </span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.0.173/test/chat<span class="token punctuation">:</span>latest <span class="token comment">#容器使用的镜像地址   </span>
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Never <span class="token comment">#三个选择Always、Never、IfNotPresent，每次启动时检查和更新（从registery）images的策略， </span>
                           <span class="token comment"># Always，每次都检查 </span>
                           <span class="token comment"># Never，每次都不检查（不管本地是否有） </span>
                           <span class="token comment"># IfNotPresent，如果本地有就不检查，如果没有就拉取 </span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">]</span> <span class="token comment">#启动容器的运行命令，将覆盖容器中的Entrypoint,对应Dockefile中的ENTRYPOINT   </span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;$(str)&quot;</span><span class="token punctuation">]</span> <span class="token comment">#启动容器的命令参数，对应Dockerfile中CMD参数   </span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span> <span class="token comment">#指定容器中的环境变量   </span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> str <span class="token comment">#变量的名字   </span>
      <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;/etc/run.sh&quot;</span> <span class="token comment">#变量的值   </span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token comment">#资源管理 </span>
      <span class="token key atrule">requests</span><span class="token punctuation">:</span> <span class="token comment">#容器运行时，最低资源需求，也就是说最少需要多少资源容器才能正常运行   </span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.1</span> <span class="token comment">#CPU资源（核数），两种方式，浮点数或者是整数+m，0.1=100m，最少值为0.001核（1m） </span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> 32Mi <span class="token comment">#内存使用量   </span>
      <span class="token key atrule">limits</span><span class="token punctuation">:</span> <span class="token comment">#资源限制   </span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token number">0.5</span>   
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1000Mi   
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>   
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span> <span class="token comment">#容器开发对外的端口 </span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd  <span class="token comment">#名称 </span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP   
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span> <span class="token comment">#pod内容器健康检查的设置 </span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span> <span class="token comment">#通过httpget检查健康，返回200-399之间，则认为容器正常   </span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> / <span class="token comment">#URI地址   </span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>   
        <span class="token comment">#host: 127.0.0.1 #主机地址   </span>
        <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP   
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">180</span> <span class="token comment">#表明第一次检测在容器启动后多长时间后开始   </span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment">#检测的超时时间   </span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">15</span>  <span class="token comment">#检查间隔时间   </span>
      <span class="token comment">#也可以用这种方法   </span>
      <span class="token comment">#exec: 执行命令的方法进行监测，如果其退出码不为0，则认为容器正常   </span>
      <span class="token comment">#  command:   </span>
      <span class="token comment">#    - cat   </span>
      <span class="token comment">#    - /tmp/health   </span>
      <span class="token comment">#也可以用这种方法   </span>
      <span class="token comment">#tcpSocket: //通过tcpSocket检查健康    </span>
      <span class="token comment">#  port: number    </span>
    <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span> <span class="token comment">#生命周期管理   </span>
      <span class="token key atrule">postStart</span><span class="token punctuation">:</span> <span class="token comment">#容器运行之前运行的任务   </span>
        <span class="token key atrule">exec</span><span class="token punctuation">:</span>   
          <span class="token key atrule">command</span><span class="token punctuation">:</span>   
            <span class="token punctuation">-</span> <span class="token string">'sh'</span>   
            <span class="token punctuation">-</span> <span class="token string">'yum upgrade -y'</span>   
      preStop<span class="token punctuation">:</span><span class="token comment">#容器关闭之前运行的任务   </span>
        <span class="token key atrule">exec</span><span class="token punctuation">:</span>   
          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'service httpd stop'</span><span class="token punctuation">]</span>   
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>  <span class="token comment">#挂载持久存储卷 </span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume <span class="token comment">#挂载设备的名字，与volumes[*].name 需要对应     </span>
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data <span class="token comment">#挂载到容器的某个路径下   </span>
      <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>   
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment">#定义一组挂载设备   </span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume <span class="token comment">#定义一个挂载设备的名字   </span>
    <span class="token comment">#meptyDir: {}   </span>
    <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>   
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /opt <span class="token comment">#挂载设备类型为hostPath，路径为宿主机下的/opt,这里设备类型支持很多种 </span>
    <span class="token comment">#nfs</span>
</code></pre></div><h1 id="创建deployment"><a href="#创建deployment" class="header-anchor">#</a> <strong>创建Deployment</strong></h1> <p><img src="https://s1.ax1x.com/2020/04/28/J48nXV.png" alt="J48nXV.png"></p> <h2 id="创建一个yaml文件"><a href="#创建一个yaml文件" class="header-anchor">#</a> 创建一个yaml文件</h2> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1beta2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.10</span>
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        
<span class="token comment"># 请参数上面的yaml名词解释</span>
</code></pre></div><h2 id="创建deployment-2"><a href="#创建deployment-2" class="header-anchor">#</a> 创建deployment</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f nginx-deployment.yaml
deployment.apps <span class="token string">&quot;nginx-deployment&quot;</span> created


kubectl get pod -o  wide
NAME                                READY     STATUS    RESTARTS   AGE       IP              NODE
nginx-deployment-6b7b4d57b4-26wzj   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          2m        <span class="token number">10.20</span>.184.83    master-01
nginx-deployment-6b7b4d57b4-9w7tm   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          2m        <span class="token number">10.20</span>.190.60    node-01
nginx-deployment-6b7b4d57b4-mhh8t   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          2m        <span class="token number">10.20</span>.254.108   node-03


kubectl get deployment
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>            <span class="token number">3</span>           2m
</code></pre></div><h2 id="查看标签"><a href="#查看标签" class="header-anchor">#</a> 查看标签</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods --show-labels
NAME                                READY     STATUS    RESTARTS   AGE       LABELS
nginx-deployment-6b7b4d57b4-26wzj   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          3m        <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx,pod-template-hash<span class="token operator">=</span><span class="token number">2636081360</span>
nginx-deployment-6b7b4d57b4-9w7tm   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          3m        <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx,pod-template-hash<span class="token operator">=</span><span class="token number">2636081360</span>
nginx-deployment-6b7b4d57b4-mhh8t   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          3m        <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx,pod-template-hash<span class="token operator">=</span><span class="token number">2636081360</span>
</code></pre></div><h2 id="通过标签查找pod"><a href="#通过标签查找pod" class="header-anchor">#</a> 通过标签查找Pod</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods -l <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
NAME                                READY     STATUS    RESTARTS   AGE
nginx-deployment-6b7b4d57b4-26wzj   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          6m
nginx-deployment-6b7b4d57b4-9w7tm   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          6m
nginx-deployment-6b7b4d57b4-mhh8t   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          6m
</code></pre></div><h2 id="deployment创建过程"><a href="#deployment创建过程" class="header-anchor">#</a> deployment创建过程</h2> <p>Deployment 管理的是replicaset-controller，RC会创建Pod。Pod自身会下载镜像并启动镜像</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl describe rs nginx-deployment
<span class="token punctuation">..</span>.
Events:
  Type    Reason            Age   From                   Message
  ----    ------            ----  ----                   -------
  Normal  SuccessfulCreate  33m   replicaset-controller  Created pod: nginx-deployment-6b7b4d57b4-9w7tm
  Normal  SuccessfulCreate  33m   replicaset-controller  Created pod: nginx-deployment-6b7b4d57b4-26wzj
  Normal  SuccessfulCreate  33m   replicaset-controller  Created pod: nginx-deployment-6b7b4d57b4-mhh8t
  

kubectl describe pod nginx-deployment-6b7b4d57b4-26wzj
<span class="token punctuation">..</span>.
Events:
 Type    Reason                 Age   From                Message
 ----    ------                 ----  ----                -------
 Normal  Scheduled              36m   default-scheduler   Successfully assigned nginx-deployment-6b7b4d57b4-26wzj to master-01
 Normal  SuccessfulMountVolume  36m   kubelet, master-01  MountVolume.SetUp succeeded <span class="token keyword">for</span> volume <span class="token string">&quot;default-token-v5vw9&quot;</span>
 Normal  Pulled                 36m   kubelet, master-01  Container image <span class="token string">&quot;nginx:1.10&quot;</span> already present on machine
 Normal  Created                36m   kubelet, master-01  Created container
 Normal  Started                36m   kubelet, master-01  Started container
</code></pre></div><h2 id="升级镜像-nginx1-10-nginx1-11"><a href="#升级镜像-nginx1-10-nginx1-11" class="header-anchor">#</a> 升级镜像（nginx1.10–&gt;nginx1.11）</h2> <p><strong>升级镜像的过程是逐步进行的，pod不会一下子全部关闭，而是一个一个升级</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token builtin class-name">set</span> image deploy/nginx-deployment <span class="token assign-left variable">nginx</span><span class="token operator">=</span>nginx:1.11
deployment.apps <span class="token string">&quot;nginx-deployment&quot;</span> image updated


kubectl <span class="token builtin class-name">exec</span> -it nginx-deployment-b96c97dc-2pxjf <span class="token function">bash</span>
root@nginx-deployment-b96c97dc-2pxjf:/<span class="token comment"># nginx -V</span>
nginx version: nginx/1.11.13
</code></pre></div><h2 id="查看发布状态"><a href="#查看发布状态" class="header-anchor">#</a> 查看发布状态</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl rollout status deploy/nginx-deployment
deployment <span class="token string">&quot;nginx-deployment&quot;</span> successfully rolled out
</code></pre></div><h2 id="查看deployment历史修订版本"><a href="#查看deployment历史修订版本" class="header-anchor">#</a> 查看deployment历史修订版本</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl rollout <span class="token function">history</span> deploy/nginx-deployment
deployments <span class="token string">&quot;nginx-deployment&quot;</span>
REVISION  CHANGE-CAUSE
<span class="token number">1</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">2</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
 
<span class="token comment"># 显示历史有两个版本</span>



kubectl rollout <span class="token function">history</span> deploy/nginx-deployment --revision<span class="token operator">=</span><span class="token number">1</span>
deployments <span class="token string">&quot;nginx-deployment&quot;</span> with revision <span class="token comment">#1</span>
Pod Template:
  Labels:   <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
    pod-template-hash<span class="token operator">=</span><span class="token number">2636081360</span>
  Containers:
   nginx:
    Image:  nginx:1.10
    Port:   <span class="token number">80</span>/TCP
    Host Port:  <span class="token number">0</span>/TCP
    Environment:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts: <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Volumes:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>



kubectl rollout <span class="token function">history</span> deploy/nginx-deployment --revision<span class="token operator">=</span><span class="token number">2</span>
deployments <span class="token string">&quot;nginx-deployment&quot;</span> with revision <span class="token comment">#2</span>
Pod Template:
  Labels:   <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
    pod-template-hash<span class="token operator">=</span><span class="token number">65275387</span>
  Containers:
   nginx:
    Image:  nginx:1.11
    Port:   <span class="token number">80</span>/TCP
    Host Port:  <span class="token number">0</span>/TCP
    Environment:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts: <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Volumes:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><h2 id="编辑deployment"><a href="#编辑deployment" class="header-anchor">#</a> 编辑deployment</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl edit deploy/nginx-deployment
<span class="token punctuation">..</span>.
   spec:
      containers:
      - image: nginx:1.12
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
        - containerPort: <span class="token number">80</span>
        
<span class="token comment"># 将nginx版本改为1.12</span>
</code></pre></div><h2 id="查看升级过程"><a href="#查看升级过程" class="header-anchor">#</a> 查看升级过程</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl rollout status deploy/nginx-deployment
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">1</span> out of <span class="token number">3</span> new replicas have been updated<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">1</span> out of <span class="token number">3</span> new replicas have been updated<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">1</span> out of <span class="token number">3</span> new replicas have been updated<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">2</span> out of <span class="token number">3</span> new replicas have been updated<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">2</span> out of <span class="token number">3</span> new replicas have been updated<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">2</span> out of <span class="token number">3</span> new replicas have been updated<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">1</span> old replicas are pending termination<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> rollout to finish: <span class="token number">1</span> old replicas are pending termination<span class="token punctuation">..</span>.
deployment <span class="token string">&quot;nginx-deployment&quot;</span> successfully rolled out
</code></pre></div><h2 id="扩容-缩容-指定-replicas的数量"><a href="#扩容-缩容-指定-replicas的数量" class="header-anchor">#</a> 扩容/缩容（指定–replicas的数量）</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pod
NAME                                READY     STATUS    RESTARTS   AGE
nginx-deployment-6b47cf4878-8mjkr   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          1m
nginx-deployment-6b47cf4878-kr978   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          1m
nginx-deployment-6b47cf4878-tvhvl   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          1m


kubectl scale deploy/nginx-deployment --replicas<span class="token operator">=</span><span class="token number">5</span>
deployment.extensions <span class="token string">&quot;nginx-deployment&quot;</span> scaled


kubectl get pod
NAME                                READY     STATUS              RESTARTS   AGE
nginx-deployment-6b47cf4878-6r5dz   <span class="token number">0</span>/1       ContainerCreating   <span class="token number">0</span>          4s
nginx-deployment-6b47cf4878-7sjtt   <span class="token number">0</span>/1       ContainerCreating   <span class="token number">0</span>          4s
nginx-deployment-6b47cf4878-8mjkr   <span class="token number">1</span>/1       Running             <span class="token number">0</span>          2m
nginx-deployment-6b47cf4878-kr978   <span class="token number">1</span>/1       Running             <span class="token number">0</span>          2m
nginx-deployment-6b47cf4878-tvhvl   <span class="token number">1</span>/1       Running             <span class="token number">0</span>          2m
</code></pre></div><h2 id="创建service提供对外访问的接口"><a href="#创建service提供对外访问的接口" class="header-anchor">#</a> <strong>创建Service提供对外访问的接口</strong></h2> <div class="language-shell extra-class"><pre class="language-shell"><code>apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  labels:
    app: nginx
spec:
  ports:
  - port: <span class="token number">88</span>
    targetPort: <span class="token number">80</span>
  selector:
    app: nginx
 

<span class="token comment"># apiVersion: 指定版本</span>
<span class="token comment"># kind: 类型</span>
<span class="token comment"># name: 指定服务名称</span>
<span class="token comment"># labels: 标签</span>
<span class="token comment"># port: Service 服务暴露的端口</span>
<span class="token comment"># targetPort: 容器暴露的端口</span>
<span class="token comment"># seletor: 关联的Pod的标签</span>
</code></pre></div><h3 id="创建service"><a href="#创建service" class="header-anchor">#</a> 创建service</h3> <div class="language- extra-class"><pre class="language-text"><code>kubectl create -f nginx-service.yaml
</code></pre></div><h3 id="查看service-访问pod是有负载均衡的"><a href="#查看service-访问pod是有负载均衡的" class="header-anchor">#</a> 查看service（访问Pod是有负载均衡的）</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get svc/nginx-service
NAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
nginx-service   ClusterIP   <span class="token number">10.254</span>.131.176   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">88</span>/TCP    1m



<span class="token function">curl</span> <span class="token number">10.254</span>.131.176:88
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
   body <span class="token punctuation">{</span>
       width: 35em<span class="token punctuation">;</span>
       margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
       font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://nginx.org/&quot;</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://nginx.com/&quot;</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div><h3 id="对service的描述"><a href="#对service的描述" class="header-anchor">#</a> 对service的描述</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl describe svc/nginx-service
Name:              nginx-service
Namespace:         default
Labels:            <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
Annotations:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Selector:          <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
Type:              ClusterIP
IP:                <span class="token number">10.254</span>.131.176
Port:              <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>  <span class="token number">88</span>/TCP
TargetPort:        <span class="token number">80</span>/TCP
Endpoints:         <span class="token number">10.20</span>.184.19:80,10.20.184.84:80,10.20.190.62:80 + <span class="token number">2</span> more<span class="token punctuation">..</span>.
Session Affinity:  None
Events:            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><h2 id="回滚到以前的版本"><a href="#回滚到以前的版本" class="header-anchor">#</a> 回滚到以前的版本</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl rollout <span class="token function">history</span> deploy/nginx-deployment
deployments <span class="token string">&quot;nginx-deployment&quot;</span>
REVISION  CHANGE-CAUSE
<span class="token number">1</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">2</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">3</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>


kubectl rollout <span class="token function">history</span> deploy/nginx-deployment --revision<span class="token operator">=</span><span class="token number">3</span>
deployments <span class="token string">&quot;nginx-deployment&quot;</span> with revision <span class="token comment">#3</span>
Pod Template:
 Labels:   <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
   pod-template-hash<span class="token operator">=</span><span class="token number">2603790434</span>
 Containers:
  nginx:
   Image:  nginx:1.12
   Port:   <span class="token number">80</span>/TCP
   Host Port:  <span class="token number">0</span>/TCP
   Environment:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
   Mounts: <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
 Volumes:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
 
 
 
kubectl rollout undo deploy/nginx-deployment
deployment.apps <span class="token string">&quot;nginx-deployment&quot;</span>
<span class="token comment"># 回滚到上一个版本</span>



kubectl describe deploy/nginx-deployment
<span class="token punctuation">..</span>.
Labels:  <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
 Containers:
  nginx:
   Image:        nginx:1.11
<span class="token comment"># 查看版本</span>
</code></pre></div><h2 id="回滚到指定版本"><a href="#回滚到指定版本" class="header-anchor">#</a> 回滚到指定版本</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl rollout <span class="token function">history</span> deploy/nginx-deployment
deployments <span class="token string">&quot;nginx-deployment&quot;</span>
REVISION  CHANGE-CAUSE
<span class="token number">1</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">3</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">4</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>



kubectl rollout undo deploy/nginx-deployment --to-revision<span class="token operator">=</span><span class="token number">1</span>
deployment.apps <span class="token string">&quot;nginx-deployment&quot;</span>
<span class="token comment"># 指定版本</span>
</code></pre></div><h1 id="一个具体kubernetes的yaml解释文件"><a href="#一个具体kubernetes的yaml解释文件" class="header-anchor">#</a> <strong>一个具体Kubernetes的yaml解释文件</strong></h1> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># yaml格式的pod定义文件完整内容：</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1       <span class="token comment">#必选，版本号，例如v1</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod       <span class="token comment">#必选，Pod</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>       <span class="token comment">#必选，元数据</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> string       <span class="token comment">#必选，Pod名称</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> string    <span class="token comment">#必选，Pod所属的命名空间</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>      <span class="token comment">#自定义标签</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string     <span class="token comment">#自定义标签名字</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>       <span class="token comment">#自定义注释列表</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string
<span class="token key atrule">spec</span><span class="token punctuation">:</span>         <span class="token comment">#必选，Pod中容器的详细定义</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>      <span class="token comment">#必选，Pod中容器列表</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string     <span class="token comment">#必选，容器名称</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> string    <span class="token comment">#必选，容器的镜像名称</span>
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Always <span class="token punctuation">|</span> Never <span class="token punctuation">|</span> IfNotPresent<span class="token punctuation">]</span> <span class="token comment">#获取镜像的策略 Alawys表示下载镜像 IfnotPresent表示优先使用本地镜像，否则下载镜像，Nerver表示仅使用本地镜像</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>string<span class="token punctuation">]</span>    <span class="token comment">#容器的启动命令列表，如不指定，使用打包时使用的启动命令</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>string<span class="token punctuation">]</span>     <span class="token comment">#容器的启动命令参数列表</span>
    <span class="token key atrule">workingDir</span><span class="token punctuation">:</span> string     <span class="token comment">#容器的工作目录</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>    <span class="token comment">#挂载到容器内部的存储卷配置</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string     <span class="token comment">#引用pod定义的共享存储卷的名称，需用volumes[]部分定义的的卷名</span>
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> string    <span class="token comment">#存储卷在容器内mount的绝对路径，应少于512字符</span>
      <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> boolean    <span class="token comment">#是否为只读模式</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>       <span class="token comment">#需要暴露的端口库号列表</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string     <span class="token comment">#端口号名称</span>
      <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> int   <span class="token comment">#容器需要监听的端口号</span>
      <span class="token key atrule">hostPort</span><span class="token punctuation">:</span> int    <span class="token comment">#容器所在主机需要监听的端口号，默认与Container相同</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> string     <span class="token comment">#端口协议，支持TCP和UDP，默认TCP</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>       <span class="token comment">#容器运行前需设置的环境变量列表</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string     <span class="token comment">#环境变量名称</span>
      <span class="token key atrule">value</span><span class="token punctuation">:</span> string    <span class="token comment">#环境变量的值</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>       <span class="token comment">#资源限制和请求的设置</span>
      <span class="token key atrule">limits</span><span class="token punctuation">:</span>      <span class="token comment">#资源限制的设置</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> string    <span class="token comment">#Cpu的限制，单位为core数，将用于docker run --cpu-shares参数</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> string     <span class="token comment">#内存限制，单位可以为Mib/Gib，将用于docker run --memory参数</span>
      <span class="token key atrule">requests</span><span class="token punctuation">:</span>      <span class="token comment">#资源请求的设置</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> string    <span class="token comment">#Cpu请求，容器启动的初始可用数量</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> string     <span class="token comment">#内存清楚，容器启动的初始可用数量</span>
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>     <span class="token comment">#对Pod内个容器健康检查的设置，当探测无响应几次后将自动重启该容器，检查方法有exec、httpGet和tcpSocket，对一个容器只需设置其中一种方法即可</span>
      <span class="token key atrule">exec</span><span class="token punctuation">:</span>      <span class="token comment">#对Pod容器内检查方式设置为exec方式</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>string<span class="token punctuation">]</span>  <span class="token comment">#exec方式需要制定的命令或脚本</span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>       <span class="token comment">#对Pod内个容器健康检查方法设置为HttpGet，需要制定Path、port</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> string
        <span class="token key atrule">port</span><span class="token punctuation">:</span> number
        <span class="token key atrule">host</span><span class="token punctuation">:</span> string
        <span class="token key atrule">scheme</span><span class="token punctuation">:</span> string
        <span class="token key atrule">HttpHeaders</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string
          <span class="token key atrule">value</span><span class="token punctuation">:</span> string
      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>     <span class="token comment">#对Pod内个容器健康检查方式设置为tcpSocket方式</span>
         <span class="token key atrule">port</span><span class="token punctuation">:</span> number
       <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>  <span class="token comment">#容器启动完成后首次探测的时间，单位为秒</span>
       <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>   <span class="token comment">#对容器健康检查探测等待响应的超时时间，单位秒，默认1秒</span>
       <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token comment">#对容器监控检查的定期探测时间设置，单位秒，默认10秒一次</span>
       <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">0</span>
       <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">0</span>
       <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
         privileged<span class="token punctuation">:</span><span class="token boolean important">false</span>
    <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Always <span class="token punctuation">|</span> Never <span class="token punctuation">|</span> OnFailure<span class="token punctuation">]</span><span class="token comment">#Pod的重启策略，Always表示一旦不管以何种方式终止运行，kubelet都将重启，OnFailure表示只有Pod以非0退出码退出才重启，Nerver表示不再重启该Pod</span>
    <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span> obeject  <span class="token comment">#设置NodeSelector表示将该Pod调度到包含这个label的node上，以key：value的格式指定</span>
    <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>    <span class="token comment">#Pull镜像时使用的secret名称，以key：secretkey格式指定</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string
    hostNetwork<span class="token punctuation">:</span><span class="token boolean important">false</span>      <span class="token comment">#是否使用主机网络模式，默认为false，如果设置为true，表示使用宿主机网络</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>       <span class="token comment">#在该pod上定义共享存储卷列表</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> string     <span class="token comment">#共享存储卷名称 （volumes类型有很多种）</span>
      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>     <span class="token comment">#类型为emtyDir的存储卷，与Pod同生命周期的一个临时目录。为空值</span>
      <span class="token key atrule">hostPath</span><span class="token punctuation">:</span> string     <span class="token comment">#类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> string     <span class="token comment">#Pod所在宿主机的目录，将被用于同期中mount的目录</span>
      <span class="token key atrule">secret</span><span class="token punctuation">:</span>      <span class="token comment">#类型为secret的存储卷，挂载集群与定义的secre对象到容器内部</span>
        <span class="token key atrule">scretname</span><span class="token punctuation">:</span> string  
        <span class="token key atrule">items</span><span class="token punctuation">:</span>     
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> string
          <span class="token key atrule">path</span><span class="token punctuation">:</span> string
      <span class="token key atrule">configMap</span><span class="token punctuation">:</span>     <span class="token comment">#类型为configMap的存储卷，挂载预定义的configMap对象到容器内部</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> string
        <span class="token key atrule">items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> string
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Container/Kubernetes/4. kubectl命令行管理工具.html" class="prev">
        4. kubectl命令行管理工具
      </a></span> <span class="next"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html">
        6. Kubernetes之深入理解Pod对象
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d65bef42.js" defer></script><script src="/assets/js/2.2249178e.js" defer></script><script src="/assets/js/11.bd8ec7a6.js" defer></script>
  </body>
</html>
