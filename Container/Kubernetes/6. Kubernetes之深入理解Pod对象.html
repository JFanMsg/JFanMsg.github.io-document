<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6. Kubernetes之深入理解Pod对象 | MSG</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="在追寻技术的同时享受生活">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.d65bef42.js" as="script"><link rel="preload" href="/assets/js/2.2249178e.js" as="script"><link rel="preload" href="/assets/js/12.0d8f43df.js" as="script"><link rel="prefetch" href="/assets/js/10.4785e2e5.js"><link rel="prefetch" href="/assets/js/100.33fceff2.js"><link rel="prefetch" href="/assets/js/101.62e1e5d4.js"><link rel="prefetch" href="/assets/js/102.8551fe71.js"><link rel="prefetch" href="/assets/js/103.47754d79.js"><link rel="prefetch" href="/assets/js/104.4adf114f.js"><link rel="prefetch" href="/assets/js/105.6206a08a.js"><link rel="prefetch" href="/assets/js/106.1c4561f3.js"><link rel="prefetch" href="/assets/js/107.e1531a5a.js"><link rel="prefetch" href="/assets/js/108.c637743a.js"><link rel="prefetch" href="/assets/js/109.3f150913.js"><link rel="prefetch" href="/assets/js/11.bd8ec7a6.js"><link rel="prefetch" href="/assets/js/110.088c1ac3.js"><link rel="prefetch" href="/assets/js/111.66d8d491.js"><link rel="prefetch" href="/assets/js/112.231663ee.js"><link rel="prefetch" href="/assets/js/113.a38bc531.js"><link rel="prefetch" href="/assets/js/114.e165daea.js"><link rel="prefetch" href="/assets/js/115.994b087a.js"><link rel="prefetch" href="/assets/js/116.ea3cfdfb.js"><link rel="prefetch" href="/assets/js/117.7be5e4f3.js"><link rel="prefetch" href="/assets/js/118.ebb58ddb.js"><link rel="prefetch" href="/assets/js/119.90018646.js"><link rel="prefetch" href="/assets/js/120.bb5be863.js"><link rel="prefetch" href="/assets/js/121.3d1db670.js"><link rel="prefetch" href="/assets/js/122.d29ed1b2.js"><link rel="prefetch" href="/assets/js/123.38cc4704.js"><link rel="prefetch" href="/assets/js/124.cc8549d4.js"><link rel="prefetch" href="/assets/js/125.6ee3e9c8.js"><link rel="prefetch" href="/assets/js/126.48710eba.js"><link rel="prefetch" href="/assets/js/127.d7a1fd83.js"><link rel="prefetch" href="/assets/js/128.e5017f6b.js"><link rel="prefetch" href="/assets/js/129.4c33e121.js"><link rel="prefetch" href="/assets/js/13.2dbde7aa.js"><link rel="prefetch" href="/assets/js/130.cda66247.js"><link rel="prefetch" href="/assets/js/131.ad76f669.js"><link rel="prefetch" href="/assets/js/132.aca88758.js"><link rel="prefetch" href="/assets/js/133.a1cf5903.js"><link rel="prefetch" href="/assets/js/134.b1386377.js"><link rel="prefetch" href="/assets/js/135.94edcf53.js"><link rel="prefetch" href="/assets/js/136.24be4170.js"><link rel="prefetch" href="/assets/js/137.db57772e.js"><link rel="prefetch" href="/assets/js/138.dc67bcaa.js"><link rel="prefetch" href="/assets/js/139.5453d1f6.js"><link rel="prefetch" href="/assets/js/14.2187dbf4.js"><link rel="prefetch" href="/assets/js/140.938e5c07.js"><link rel="prefetch" href="/assets/js/141.99c7cf2c.js"><link rel="prefetch" href="/assets/js/142.428e3958.js"><link rel="prefetch" href="/assets/js/143.68b01530.js"><link rel="prefetch" href="/assets/js/144.f67389cc.js"><link rel="prefetch" href="/assets/js/145.d952a130.js"><link rel="prefetch" href="/assets/js/146.b933dcad.js"><link rel="prefetch" href="/assets/js/147.2d8e4c0a.js"><link rel="prefetch" href="/assets/js/148.6d76ac94.js"><link rel="prefetch" href="/assets/js/149.6b4d6378.js"><link rel="prefetch" href="/assets/js/15.a53b356c.js"><link rel="prefetch" href="/assets/js/150.5bf39cb4.js"><link rel="prefetch" href="/assets/js/151.17af677c.js"><link rel="prefetch" href="/assets/js/152.7f1c2792.js"><link rel="prefetch" href="/assets/js/153.98dd0727.js"><link rel="prefetch" href="/assets/js/154.eb44bf23.js"><link rel="prefetch" href="/assets/js/155.5a9840ea.js"><link rel="prefetch" href="/assets/js/156.7ba01fd0.js"><link rel="prefetch" href="/assets/js/157.2296a048.js"><link rel="prefetch" href="/assets/js/158.6bb1f699.js"><link rel="prefetch" href="/assets/js/159.073bb8df.js"><link rel="prefetch" href="/assets/js/16.cef7bf44.js"><link rel="prefetch" href="/assets/js/160.25a837f9.js"><link rel="prefetch" href="/assets/js/161.93d886a1.js"><link rel="prefetch" href="/assets/js/162.5d2714b2.js"><link rel="prefetch" href="/assets/js/17.96f36904.js"><link rel="prefetch" href="/assets/js/18.fd04b310.js"><link rel="prefetch" href="/assets/js/19.3e1377d1.js"><link rel="prefetch" href="/assets/js/20.ac195ac8.js"><link rel="prefetch" href="/assets/js/21.c2d7729c.js"><link rel="prefetch" href="/assets/js/22.dd8c621b.js"><link rel="prefetch" href="/assets/js/23.ad7d0350.js"><link rel="prefetch" href="/assets/js/24.8559c4c3.js"><link rel="prefetch" href="/assets/js/25.783a8116.js"><link rel="prefetch" href="/assets/js/26.25e0e459.js"><link rel="prefetch" href="/assets/js/27.c0616e2a.js"><link rel="prefetch" href="/assets/js/28.30656c2e.js"><link rel="prefetch" href="/assets/js/29.2be5114c.js"><link rel="prefetch" href="/assets/js/3.be8c8f3b.js"><link rel="prefetch" href="/assets/js/30.230a74a7.js"><link rel="prefetch" href="/assets/js/31.760f46ad.js"><link rel="prefetch" href="/assets/js/32.c9533fef.js"><link rel="prefetch" href="/assets/js/33.dcacfb38.js"><link rel="prefetch" href="/assets/js/34.4370a466.js"><link rel="prefetch" href="/assets/js/35.bf299eea.js"><link rel="prefetch" href="/assets/js/36.336e435a.js"><link rel="prefetch" href="/assets/js/37.1d1d2eea.js"><link rel="prefetch" href="/assets/js/38.0d58b7d0.js"><link rel="prefetch" href="/assets/js/39.d43564ba.js"><link rel="prefetch" href="/assets/js/4.4a6cb970.js"><link rel="prefetch" href="/assets/js/40.bc4e4bde.js"><link rel="prefetch" href="/assets/js/41.b71231a5.js"><link rel="prefetch" href="/assets/js/42.9d46f400.js"><link rel="prefetch" href="/assets/js/43.50c5be69.js"><link rel="prefetch" href="/assets/js/44.60406e7f.js"><link rel="prefetch" href="/assets/js/45.ec3569ae.js"><link rel="prefetch" href="/assets/js/46.1bd3ce7b.js"><link rel="prefetch" href="/assets/js/47.1e1b5326.js"><link rel="prefetch" href="/assets/js/48.64c631ea.js"><link rel="prefetch" href="/assets/js/49.b4abacd8.js"><link rel="prefetch" href="/assets/js/5.e6d0b165.js"><link rel="prefetch" href="/assets/js/50.c3e320c0.js"><link rel="prefetch" href="/assets/js/51.5ec7fb8c.js"><link rel="prefetch" href="/assets/js/52.2d234f86.js"><link rel="prefetch" href="/assets/js/53.f3b69623.js"><link rel="prefetch" href="/assets/js/54.c85ff450.js"><link rel="prefetch" href="/assets/js/55.b07597b5.js"><link rel="prefetch" href="/assets/js/56.444129cf.js"><link rel="prefetch" href="/assets/js/57.df1329ba.js"><link rel="prefetch" href="/assets/js/58.5afb51cf.js"><link rel="prefetch" href="/assets/js/59.d98936d9.js"><link rel="prefetch" href="/assets/js/6.809376cd.js"><link rel="prefetch" href="/assets/js/60.02813ecf.js"><link rel="prefetch" href="/assets/js/61.37a4812d.js"><link rel="prefetch" href="/assets/js/62.5da94048.js"><link rel="prefetch" href="/assets/js/63.8e2c2bca.js"><link rel="prefetch" href="/assets/js/64.d290398f.js"><link rel="prefetch" href="/assets/js/65.44e28313.js"><link rel="prefetch" href="/assets/js/66.9acf0206.js"><link rel="prefetch" href="/assets/js/67.85688aa2.js"><link rel="prefetch" href="/assets/js/68.45bda7fc.js"><link rel="prefetch" href="/assets/js/69.9074feb0.js"><link rel="prefetch" href="/assets/js/7.5d7bce6e.js"><link rel="prefetch" href="/assets/js/70.b4cd2ddc.js"><link rel="prefetch" href="/assets/js/71.53219b13.js"><link rel="prefetch" href="/assets/js/72.af2a7290.js"><link rel="prefetch" href="/assets/js/73.c28fc506.js"><link rel="prefetch" href="/assets/js/74.64c81a90.js"><link rel="prefetch" href="/assets/js/75.05191ece.js"><link rel="prefetch" href="/assets/js/76.f516d464.js"><link rel="prefetch" href="/assets/js/77.c345180b.js"><link rel="prefetch" href="/assets/js/78.4a09d0ba.js"><link rel="prefetch" href="/assets/js/79.65f41bcf.js"><link rel="prefetch" href="/assets/js/8.f6cfdc07.js"><link rel="prefetch" href="/assets/js/80.b77151f3.js"><link rel="prefetch" href="/assets/js/81.824fa371.js"><link rel="prefetch" href="/assets/js/82.3f91c09b.js"><link rel="prefetch" href="/assets/js/83.9539f074.js"><link rel="prefetch" href="/assets/js/84.dd89f1de.js"><link rel="prefetch" href="/assets/js/85.15210b99.js"><link rel="prefetch" href="/assets/js/86.e14553e1.js"><link rel="prefetch" href="/assets/js/87.6dc95177.js"><link rel="prefetch" href="/assets/js/88.09c5e890.js"><link rel="prefetch" href="/assets/js/89.0d61f4d0.js"><link rel="prefetch" href="/assets/js/9.759f1986.js"><link rel="prefetch" href="/assets/js/90.a9b14d80.js"><link rel="prefetch" href="/assets/js/91.1a4aabe2.js"><link rel="prefetch" href="/assets/js/92.12070bdb.js"><link rel="prefetch" href="/assets/js/93.b5dc76d0.js"><link rel="prefetch" href="/assets/js/94.690498a6.js"><link rel="prefetch" href="/assets/js/95.b17961e6.js"><link rel="prefetch" href="/assets/js/96.a2f06f3e.js"><link rel="prefetch" href="/assets/js/97.64ef6721.js"><link rel="prefetch" href="/assets/js/98.443eba26.js"><link rel="prefetch" href="/assets/js/99.b6ba7c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">MSG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link router-link-active">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python文档" class="dropdown-title"><span class="title">Python文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python文档" class="mobile-dropdown-title"><span class="title">Python文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/1.Python-Basics/" class="nav-link">
  Python-基础
</a></li><li class="dropdown-item"><!----> <a href="/Python/2. Python-object/" class="nav-link">
  Python-面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Python/3. Python-module/" class="nav-link">
  Python-模块与包
</a></li><li class="dropdown-item"><!----> <a href="/Python/4. Python-network/" class="nav-link">
  Python-网络
</a></li><li class="dropdown-item"><!----> <a href="/Python/5. Python-frontend/" class="nav-link">
  Python-前端
</a></li><li class="dropdown-item"><!----> <a href="/Python/6. Python-MySQL/" class="nav-link">
  Python-数据库
</a></li><li class="dropdown-item"><!----> <a href="/Python/7. Python-Django/" class="nav-link">
  Python-Django
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="容器文档" class="dropdown-title"><span class="title">容器文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="容器文档" class="mobile-dropdown-title"><span class="title">容器文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Container/docker/" class="nav-link">
  docker文檔
</a></li><li class="dropdown-item"><!----> <a href="/Container/Kubernetes/" class="nav-link router-link-active">
  Kubernetes文檔
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GO文档" class="dropdown-title"><span class="title">GO文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="GO文档" class="mobile-dropdown-title"><span class="title">GO文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/GO/basics/" class="nav-link">
  GO快速入门
</a></li><li class="dropdown-item"><!----> <a href="/GO/module/" class="nav-link">
  GO标准库/GO模块
</a></li></ul></div></div><div class="nav-item"><a href="https://www.linux91.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Container/Kubernetes/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/Container/Kubernetes/1. Kubernetes概述.html" class="sidebar-link">1. Kubernetes概述</a></li><li><a href="/Container/Kubernetes/2. Kubernetes1.14集群部署 - 二进制.html" class="sidebar-link">2. Kubernetes1.14集群部署 - 二进制</a></li><li><a href="/Container/Kubernetes/3. kubectl远程连接K8S集群.html" class="sidebar-link">3. kubectl远程连接K8S集群</a></li><li><a href="/Container/Kubernetes/4. kubectl命令行管理工具.html" class="sidebar-link">4. kubectl命令行管理工具</a></li><li><a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html" class="sidebar-link">5. Kubernetes之yaml文件详解使用</a></li><li><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html" class="active sidebar-link">6. Kubernetes之深入理解Pod对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#pod中如何管理多个容器" class="sidebar-link">Pod中如何管理多个容器</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#pod中可以共享两种资源" class="sidebar-link">Pod中可以共享两种资源</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#镜像拉取策略-局部" class="sidebar-link">镜像拉取策略 - 局部</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#镜像拉取策略-全局" class="sidebar-link">镜像拉取策略 - 全局</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#pod和container的资源请求和限制" class="sidebar-link">Pod和Container的资源请求和限制</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#实例" class="sidebar-link">实例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#查看node节点资源使用情况" class="sidebar-link">查看node节点资源使用情况</a></li></ul></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#二种健康检查" class="sidebar-link">二种健康检查</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#probe有以下两种类型" class="sidebar-link">Probe有以下两种类型</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#probe支持三种检查方法" class="sidebar-link">Probe支持三种检查方法</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#一些简单的参数" class="sidebar-link">一些简单的参数</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#exec探针检查方式的示例" class="sidebar-link">exec探针检查方式的示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#编写yaml文件" class="sidebar-link">编写yaml文件</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#使用yaml文件生成示例" class="sidebar-link">使用yaml文件生成示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#调度器的工作机制" class="sidebar-link">调度器的工作机制</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#调度约束的二种机制" class="sidebar-link">调度约束的二种机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#nodename-强制指定" class="sidebar-link">nodeName - 强制指定</a></li><li class="sidebar-sub-header"><a href="/Container/Kubernetes/6. Kubernetes之深入理解Pod对象.html#nodeselector-匹配" class="sidebar-link">nodeSelector - 匹配</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_6-kubernetes之深入理解pod对象"><a href="#_6-kubernetes之深入理解pod对象" class="header-anchor">#</a> 6. Kubernetes之深入理解Pod对象</h1> <h1 id="pod对象"><a href="#pod对象" class="header-anchor">#</a> <strong>Pod对象</strong></h1> <ol><li>最小部署单元</li> <li>一组容器的集合</li> <li>一个Pod中的容器共享网络命名空间</li> <li>Pod是短暂的</li></ol> <h2 id="pod中如何管理多个容器"><a href="#pod中如何管理多个容器" class="header-anchor">#</a> Pod中如何管理多个容器</h2> <ol><li>Pod中可以同时运行多个进程（作为容器运行）协同工作。</li> <li>同一个Pod中的容器会自动的分配到同一个 node 上。</li> <li>同一个Pod中的容器共享资源、网络环境和依赖，它们总是被同时调度。</li></ol> <p>注意在一个Pod中同时运行多个容器是一种比较高级的用法</p> <ol><li>只有当你的容器需要紧密配合协作的时候才考虑用这种模式</li> <li>例如，你有一个容器作为web服务器运行，需要用到共享的volume，有另一个“sidecar”容器来从远端获取资源更新这些文件，如下图所示</li></ol> <p><img src="https://gitee.com/linux91/document-img/raw/master/img/J4ddFf.png" alt="J4ddFf.png"></p> <h2 id="pod中可以共享两种资源"><a href="#pod中可以共享两种资源" class="header-anchor">#</a> Pod中可以共享两种资源</h2> <ol><li><strong>网络：</strong> <ol><li>每个Pod都会被分配一个唯一的IP地址。</li> <li>Pod中的所有容器共享网络空间，包括IP地址和端口。</li> <li>Pod内部的容器可以使用localhost(主机名)互相通信。</li> <li>Pod中的容器与外界通信时，必须分配共享网络资源（例如使用宿主机的端口映射）。</li></ol></li> <li><strong>存储：</strong> <ol><li>可以Pod指定多个共享的Volume。</li> <li>Pod中的所有容器都可以访问共享的volume。</li> <li>Volume也可以用来持久化Pod中的存储资源，以防容器重启后文件丢失</li></ol></li></ol> <h1 id="pod容器分类"><a href="#pod容器分类" class="header-anchor">#</a> <strong>Pod容器分类</strong></h1> <ol><li>Infrastructure Container：基础容器，维护整个Pod网络空间</li> <li>InitContainers：初始化容器，先于业务容器开始执行</li> <li>Containers：业务容器，并行启动</li></ol> <h1 id="镜像拉取策略-imagepullpolicy"><a href="#镜像拉取策略-imagepullpolicy" class="header-anchor">#</a> <strong>镜像拉取策略（imagePullPolicy）</strong></h1> <ol><li>IfNotPresent：默认值，镜像在宿主机上不存在时才拉取</li> <li>Always：每次创建Pod 都会重新拉取一次镜像</li> <li>Never：Pod 永远不会主动拉取这个镜像</li></ol> <h2 id="镜像拉取策略-局部"><a href="#镜像拉取策略-局部" class="header-anchor">#</a> 镜像拉取策略 - 局部</h2> <ol><li>写在containers中，只针对containers中的镜像拉取策略生成</li> <li>就相当于编程中的局部配置跟全局配置一样</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> awesomeapps
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
      <span class="token key atrule">image</span><span class="token punctuation">:</span> janedoe/awesomeapp<span class="token punctuation">:</span>v1
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent 
</code></pre></div><h2 id="镜像拉取策略-全局"><a href="#镜像拉取策略-全局" class="header-anchor">#</a> 镜像拉取策略 - 全局</h2> <ol><li>写在spec中，只针对spec所有的containers中的镜像拉取策略生成</li> <li>就相当于编程中的局部配置跟全局配置一样</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> awesomeapps
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
      <span class="token key atrule">image</span><span class="token punctuation">:</span> janedoe/awesomeapp<span class="token punctuation">:</span>v1
  <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myregistrykey
</code></pre></div><h1 id="资源限制"><a href="#资源限制" class="header-anchor">#</a> <strong>资源限制</strong></h1> <p>官方相关文档地址：https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/</p> <ol><li>创建Pod的时候，可以指定计算资源（目前支持的资源类型有CPU和内存），即指定每个容器的资源请求（Request）和资源限制（Limit），资源请求是容器所需的最小资源需求，资源限制则是容器不能超过的资源上限。它们的大小关系是：0&lt;=request&lt;=limit&lt;=infinity</li> <li>Pod的资源请求就是Pod中容器资源请求之和。Kubernetes在调度Pod时，会根据Node中的资源总量（通过cAdvisor接口获得），以及该Node上已使用的计算资源，来判断该Node是否满足需求。</li> <li>资源请求能够保证Pod有足够的资源来运行，而资源限制则是防止某个Pod无限制地使用资源，导致其他Pod崩溃。特别是在公有云场景，往往会有恶意软件通过抢占内存来攻击平台。</li> <li>原理：Docker 通过使用Linux Cgroup来实现对容器资源的控制，具体到启动参数上是--memory和--cpu-shares。Kubernetes中是通过控制这两个参数来实现对容器资源的控制。</li></ol> <h2 id="pod和container的资源请求和限制"><a href="#pod和container的资源请求和限制" class="header-anchor">#</a> Pod和Container的资源请求和限制</h2> <ol><li>spec.containers[].resources.limits.cpu</li> <li>spec.containers[].resources.limits.memory</li> <li>spec.containers[].resources.requests.cpu</li> <li>spec.containers[].resources.requests.memory</li></ol> <h2 id="实例"><a href="#实例" class="header-anchor">#</a> <strong>实例</strong></h2> <p>以下Pod有两个容器</p> <ol><li>每个Container都有0.25 cpu和64MiB内存的请求。</li> <li>每个Container的内存限制为0.5 cpu和128MiB。</li> <li>你可以说Pod有0.5 cpu和128 MiB内存的请求，并且限制为1 cpu和256MiB的内存</li></ol> <p>以下是yaml文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> frontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> db
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MYSQL_ROOT_PASSWORD
      <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;password&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">requests</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&quot;64Mi&quot;</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">&quot;250m&quot;</span>
      <span class="token key atrule">limits</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&quot;128Mi&quot;</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">&quot;500m&quot;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> wp
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">requests</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&quot;64Mi&quot;</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">&quot;250m&quot;</span>
      <span class="token key atrule">limits</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&quot;128Mi&quot;</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">&quot;500m&quot;</span>
</code></pre></div><h3 id="查看node节点资源使用情况"><a href="#查看node节点资源使用情况" class="header-anchor">#</a> 查看node节点资源使用情况</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl describe pod frontend <span class="token operator">|</span> <span class="token function">grep</span> -A <span class="token number">3</span> Events
Events:
  Type     Reason          Age                From                    Message
  ----     ------          ----               ----                    -------
  Normal   Scheduled       19m                default-scheduler       Successfully assigned default/frontend to <span class="token number">192.168</span>.0.125
  


kubectl describe nodes <span class="token number">192.168</span>.0.125
---------                  ----                                  ------------  ----------  ---------------  -------------  ---
  default                    frontend                              500m <span class="token punctuation">(</span><span class="token number">25</span>%<span class="token punctuation">)</span>    <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">50</span>%<span class="token punctuation">)</span>     128Mi <span class="token punctuation">(</span><span class="token number">3</span>%<span class="token punctuation">)</span>       256Mi <span class="token punctuation">(</span><span class="token number">6</span>%<span class="token punctuation">)</span>     20m
  default                    tomcat-deployment-6bb6864d4f-drcjc    <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>        <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>      <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>           <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>         3h25m
  default                    tomcat-deployment-6bb6864d4f-wmkxx    <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>        <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>      <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>           <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>         3h25m
Allocated resources:
  <span class="token punctuation">(</span>Total limits may be over <span class="token number">100</span> percent, i.e., overcommitted.<span class="token punctuation">)</span>
  Resource           Requests    Limits
  --------           --------    ------
  cpu                500m <span class="token punctuation">(</span><span class="token number">25</span>%<span class="token punctuation">)</span>  <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">50</span>%<span class="token punctuation">)</span>
  memory             128Mi <span class="token punctuation">(</span><span class="token number">3</span>%<span class="token punctuation">)</span>  256Mi <span class="token punctuation">(</span><span class="token number">6</span>%<span class="token punctuation">)</span>
  ephemeral-storage  <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>      <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
  
<span class="token comment"># 因输出的内容太多了,所以我只截了部分可看的内容</span>
</code></pre></div><h1 id="重启策略-restartpolicy"><a href="#重启策略-restartpolicy" class="header-anchor">#</a> <strong>重启策略（restartPolicy）</strong></h1> <ol><li>Always：当容器终止退出后，总是重启容器，默认策略。</li> <li>OnFailure：当容器异常退出（退出状态码非0）时，才重启容器。</li> <li>Never：当容器终止退出，从不重启容器</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> awesomeapps
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
    <span class="token key atrule">image</span><span class="token punctuation">:</span> janedoe/awesomeapp<span class="token punctuation">:</span>v1
    <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always

<span class="token comment">## 一般都是使用默认的Always</span>
</code></pre></div><h1 id="健康检查-probe"><a href="#健康检查-probe" class="header-anchor">#</a> <strong>健康检查（Probe）</strong></h1> <p>官方相关文档地址：https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/</p> <ol><li>在实际生产环境中，想要使得开发的应用程序完全没有bug，在任何时候都运行正常，几乎是不可能的任务。</li> <li>因此，我们需要一套管理系统，来对用户的应用程序执行周期性的健康检查和修复操作。</li> <li>这套管理系统必须运行在应用程序之外，这一点非常重要一一如果它是应用程序的一部分，极有可能会和应用程序一起崩溃。</li> <li>因此，在Kubernetes中，系统和应用程序的健康检查是由Kubelet来完成的。</li></ol> <h2 id="二种健康检查"><a href="#二种健康检查" class="header-anchor">#</a> 二种健康检查</h2> <ol><li>进程级健康检查
<ol><li>最简单的健康检查是进程级的健康检查，即检验容器进程是否存活。</li> <li>这类健康检查的监控粒度是在Kubernetes集群中运行的单一容器。</li> <li>Kubelet会定期通过Docker Daemon获取所有Docker进程的运行情况，如果发现某个Docker容器未正常运行，则重新启动该容器进程。</li> <li>目前，进程级的健康检查都是默认启用的。</li></ol></li> <li>业务级健康检查
<ol><li>在很多实际场景下，仅仅使用进程级健康检查还远远不够。</li> <li>有时，从Docker的角度来看，容器进程依旧在运行</li> <li>但是如果从应用程序的角度来看，代码处于死锁状态，</li> <li>即容器永远都无法正常响应用户的业务为了解决以上问题</li> <li>Kubernetes引人了一个在容器内执行的活性探针的概念，以支持用户自己实现应用业务级的健康检查</li></ol></li></ol> <h2 id="probe有以下两种类型"><a href="#probe有以下两种类型" class="header-anchor">#</a> Probe有以下两种类型</h2> <ol><li>livenessProbe：如果检查失败，将杀死容器，根据Pod的restartPolicy来操作。</li> <li>readinessProbe：如果检查失败，Kubernetes会把Pod从service endpoints中剔除</li></ol> <p><img src="https://gitee.com/linux91/document-img/raw/master/img/J5M50e.png" alt="J5M50e.png"></p> <h2 id="probe支持三种检查方法"><a href="#probe支持三种检查方法" class="header-anchor">#</a> Probe支持三种检查方法</h2> <ol><li>Exec(ExecAction)：在容器内执行指定命令。如果命令退出时返回码为 0 则认为诊断成功。</li> <li>TCPSocket(TCPSocketAction)：对指定端口上的容器的 IP 地址进行 TCP 检查。如果端口打开，则诊断被认为是成功的。</li> <li>HTTPGet(HTTPGetAction)：对指定的端口和路径上的容器的 IP 地址执行 HTTP Get 请求。如果响应的状态码大于等于200 且小于 400，则诊断被认为是成功的。</li></ol> <h2 id="一些简单的参数"><a href="#一些简单的参数" class="header-anchor">#</a> 一些简单的参数</h2> <ol><li>exec  command 的方式探测 例如 ps 一个进程</li> <li>failureThreshold 探测几次失败 才算失败 默认是连续三次</li> <li>periodSeconds 每次的多长时间探测一次  默认10s</li> <li>timeoutSeconds 探测超市的秒数 默认1s</li> <li>initialDelaySeconds  初始化延迟探测，第一次探测的时候，因为主程序未必启动完成</li> <li>tcpSocket 检测端口的探测</li> <li>httpGet http请求探测</li></ol> <h2 id="exec探针检查方式的示例"><a href="#exec探针检查方式的示例" class="header-anchor">#</a> <strong>exec探针检查方式的示例</strong></h2> <h3 id="编写yaml文件"><a href="#编写yaml文件" class="header-anchor">#</a> 编写yaml文件</h3> <p>在yaml配置文件中，您可以看到Pod具有单个Container</p> <ol><li>该periodSeconds字段指定kubelet应每5秒执行一次活跃度探测。</li> <li>该initialDelaySeconds字段告诉kubelet它应该在执行第一次探测之前等待5秒。</li> <li>要执行探测，kubelet将cat /tmp/healthy在Container中执行命令。</li> <li>如果命令成功，则返回0，并且kubelet认为Container是活动且健康的。</li> <li>如果该命令返回非零值，则kubelet会终止Container并重新启动它</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>exec
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> touch /tmp/healthy; sleep 30; rm <span class="token punctuation">-</span>rf /tmp/healthy; sleep 600
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">exec</span><span class="token punctuation">:</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cat
        <span class="token punctuation">-</span> /tmp/healthy
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
</code></pre></div><h3 id="使用yaml文件生成示例"><a href="#使用yaml文件生成示例" class="header-anchor">#</a> 使用yaml文件生成示例</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f exec-liveness.yaml 
pod/liveness-exec created


kubectl get pod
NAME                                 READY   STATUS    RESTARTS   AGE
frontend                             <span class="token number">2</span>/2     Running   <span class="token number">106</span>        16h
liveness-exec                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16s
</code></pre></div><p><strong>再等30秒，确认Container已重新启动，RESTARTS已增加</strong></p> <h1 id="kubernetes中pod创建流程"><a href="#kubernetes中pod创建流程" class="header-anchor">#</a> <strong>kubernetes中pod创建流程</strong></h1> <ol><li>Pod是Kubernetes中最基本的部署调度单元，可以包含container，逻辑上表示某种应用的一个实例。</li> <li>例如一个web站点应用由前端、后端及数据库构建而成，这三个组件将运行在各自的容器中，那么我们可以创建包含三个container的pod</li> <li>以下是创建流程图</li></ol> <p><img src="https://s1.ax1x.com/2020/04/28/J4yRKS.png" alt="J4yRKS.png"></p> <p><img src="https://s1.ax1x.com/2020/04/28/J5JXPe.png" alt="J5JXPe.png"></p> <ol><li>客户端提交创建请求：
<ol><li>可以通过API Server的Restful API，也可以使用kubectl命令行工具。</li> <li>支持的数据类型包括JSON和YAML。</li></ol></li> <li>API Server：处理用户请求，存储Pod数据到etcd。</li> <li>调度器：通过API Server查看未绑定的Pod，尝试为Pod分配主机。</li> <li>过滤主机 (调度预选)：
<ol><li>调度器用一组规则过滤掉不符合要求的主机。</li> <li>比如Pod指定了所需要的资源量，那么可用资源比Pod需要的资源量少的主机会被过滤掉。</li></ol></li> <li>主机打分(调度优选)：
<ol><li>对第一步筛选出的符合要求的主机进行打分，在主机打分阶段，调度器会考虑一些整体优化策略</li> <li>比如把容一个Replication Controller的副本分布到不同的主机上，使用最低负载的主机等。</li></ol></li> <li>选择主机：选择打分最高的主机，进行binding操作，结果存储到etcd中。</li> <li>kubelet根据调度结果执行Pod创建操作：
<ol><li>绑定成功后，scheduler会调用APIServer的API在etcd中创建一个boundpod对象，描述在一个工作节点上绑定运行的所有pod信息。</li> <li>运行在每个工作节点上的kubelet也会定期与etcd同步boundpod信息，一旦发现应该在该工作节点上运行的boundpod对象没有更新，则调用Docker API创建并启动pod内的容器。</li></ol></li></ol> <h1 id="调度约束"><a href="#调度约束" class="header-anchor">#</a> <strong>调度约束</strong></h1> <p>官方相关文档地址：https://kubernetes.io/docs/concepts/configuration/assign-pod-node/</p> <p>可以约束<a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/" target="_blank" rel="noopener noreferrer">Pod<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>只能在特定<a href="https://kubernetes.io/docs/concepts/architecture/nodes/" target="_blank" rel="noopener noreferrer">节点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上运行 ，或者更喜欢在特定节点上运行</p> <ol><li>有几种方法可以做到这一点，推荐的方法都使用 <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer">标签选择器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行选择。</li> <li>通常，此类约束是不必要的，因为调度程序会自动进行合理的放置
<ol><li>例如，将Pod分散到节点上，而不是将Pod放置在可用资源不足的节点上，等等</li></ol></li> <li>但是在某些情况下，您可能需要更多控制一个Pod降落的节点，
<ol><li>例如，以确保Pod最终落在连接了SSD的机器上，或将来自两个不同服务的Pod共同放置在一个可用区域中，这些服务之间的通信量很大</li></ol></li></ol> <h2 id="调度器的工作机制"><a href="#调度器的工作机制" class="header-anchor">#</a> 调度器的工作机制</h2> <ol><li>预备工作
<ol><li>缓存所有的node节点，记录他们的规格：cpu、内存、磁盘空间、gpu显卡数等；</li> <li>缓存所有运行中的pod，按照pod所在的node进行区分，统计每个node上的pod request了多少资源。request是pod的QoS配置。</li> <li>list &amp; watch pod资源，当检查到有新的Pending状态的pod出现，就将它加入到调度队列中。</li> <li>调度器的worker组件从队列中取出pod进行调度。</li></ol></li> <li>调度过程
<ol><li>先将当前所有的node放入队列；</li> <li>执行predicates算法，对队列中的node进行筛选。这里算法检查了一些pod运行的必要条件，包括port不冲突、cpu和内存资源QoS（如果有的话）必须满足、挂载volume（如果有的话）类型必须匹配、nodeSelector规则必须匹配、硬性的affinity规则（下文会提到）必须匹配、node的状态（condition）必须正常，taint_toleration硬规则（下文会提到）等等。</li> <li>执行priorities算法，对队列中剩余的node进行评分，这里有许多评分项，各个项目有各自的权重：整体cpu，内存资源的平衡性、node上是否有存在要求的镜像、同rs的pod是否有调度、node affinity的软规则、taint_toleration软规则（下文会提到）等等。</li> <li>最终评分最高的node会被选出。即代码中suggestedHost, err := sched.schedule(pod)一句（plugin/pkg/scheduler/scheduler.go）的返回值。</li> <li>调度器执行assume方法，该方法在pod调度到node之前，就以“该pod运行在目标node上” 为场景更新调度器缓存中的node 信息，也即预备工作中的1、2两点。这么做是为了让pod在真正调度到node上时，调度器也可以同时做后续其他pod的调度工作。</li> <li>调度器执行bind方法，该方法创建一个Binding资源，apiserver检查到创建该资源时，会主动更新pod的nodeName字段。完成调度</li></ol></li></ol> <h2 id="调度约束的二种机制"><a href="#调度约束的二种机制" class="header-anchor">#</a> <strong>调度约束的二种机制</strong></h2> <ol><li>nodeName用于将Pod调度到指定的Node名称上</li> <li>nodeSelector用于将Pod调度到匹配Label的Node上</li></ol> <h3 id="nodename-强制指定"><a href="#nodename-强制指定" class="header-anchor">#</a> nodeName - 强制指定</h3> <p><strong>nodeName用于将Pod调度到指定的Node名称</strong></p> <p>spec.nodeName用于强制约束将Pod调度到指定的Node节点上，这里说是“调度”，但其实指定了nodeName的Pod会直接跳过Scheduler的调度逻辑，直接写入PodList列表，该匹配规则是强制匹配</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>example
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> 192.168.0.125
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.15</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f pod3.yaml 
pod/pod-example created


kubectl get pod
NAME          READY   STATUS    RESTARTS   AGE
nginx         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m
pod-example   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          22s


kubectl describe pod pod-example
  Type    Reason   Age   From                    Message
  ----    ------   ----  ----                    -------
  Normal  Pulled   31s   kubelet, <span class="token number">192.168</span>.0.125  Container image <span class="token string">&quot;nginx:1.15&quot;</span> already present on machine
  Normal  Created  31s   kubelet, <span class="token number">192.168</span>.0.125  Created container
  Normal  Started  30s   kubelet, <span class="token number">192.168</span>.0.125  Started container
  
<span class="token comment">## 因返回结果过多,所以只截很小一部分</span>
</code></pre></div><h3 id="nodeselector-匹配"><a href="#nodeselector-匹配" class="header-anchor">#</a> nodeSelector - 匹配</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">env_role</span><span class="token punctuation">:</span> dev
    
<span class="token comment">## env_role: dev, 是匹配带有这标签的node机器, 如果带有这标签的node节点有2台, 那么就会在这二台中选下部署</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f pod2.yaml 
pod/nginx created


kubectl get pod
NAME    READY   STATUS    RESTARTS   AGE
nginx   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          115s


kubectl describe pod nginx
 Type    Reason     Age    From                    Message
  ----    ------     ----   ----                    -------
  Normal  Scheduled  2m11s  default-scheduler       Successfully assigned default/nginx to <span class="token number">192.168</span>.0.126
  Normal  Pulled     2m11s  kubelet, <span class="token number">192.168</span>.0.126  Container image <span class="token string">&quot;nginx&quot;</span> already present on machine
  Normal  Created    2m10s  kubelet, <span class="token number">192.168</span>.0.126  Created container
  Normal  Started    2m10s  kubelet, <span class="token number">192.168</span>.0.126  Started container
<span class="token comment">## 因返回结果过多,所以只截很小一部分</span>
</code></pre></div><h1 id="故障排查"><a href="#故障排查" class="header-anchor">#</a> <strong>故障排查</strong></h1> <p><img src="https://s1.ax1x.com/2020/04/28/J5YgsI.png" alt="J5YgsI.png"></p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl describe TYPE/NAME
kubectl logs TYPE/NAME <span class="token punctuation">[</span>-c CONTAINER<span class="token punctuation">]</span>
kubectl <span class="token builtin class-name">exec</span> POD <span class="token punctuation">[</span>-c CONTAINER<span class="token punctuation">]</span> --COMMAND <span class="token punctuation">[</span>args<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Container/Kubernetes/5. Kubernetes之yaml文件详解使用.html" class="prev">
        5. Kubernetes之yaml文件详解使用
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d65bef42.js" defer></script><script src="/assets/js/2.2249178e.js" defer></script><script src="/assets/js/12.0d8f43df.js" defer></script>
  </body>
</html>
